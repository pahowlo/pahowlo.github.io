var t,i,n,s,e,r,o,h,l,a,u,c,f,v,d,p,w,m,g,y=Object.defineProperty,M=t=>{throw TypeError(t)},b=(t,i,n)=>((t,i,n)=>i in t?y(t,i,{enumerable:1,configurable:1,writable:1,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n),x=(t,i,n)=>i.has(t)||M("Cannot "+n),k=(t,i,n)=>(x(t,i,"read from private field"),n?n.call(t):i.get(t)),C=(t,i,n)=>i.has(t)?M("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,n),T=(t,i,n,s)=>(x(t,i,"write to private field"),s?s.call(t,n):i.set(t,n),n),S=(t,i,n)=>(x(t,i,"access private method"),n);function P(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)}).observe(document,{childList:1,subtree:1})}function i(t){if(t.ep)return;t.ep=1;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?i.credentials="include":"anonymous"===t.crossOrigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();var _=Array.isArray,E=[].indexOf,O=Array.from,A=Object.defineProperty,R=Object.getOwnPropertyDescriptor,W=Object.getOwnPropertyDescriptors,F=Object.prototype,D=Array.prototype,j=Object.getPrototypeOf,I=Object.isExtensible;function B(t){return t()}function L(t){for(var i=0;i<t.length;i++)t[i]()}const q=256,N=1024,z=2048,Z=4096,G=8192,H=16384,K=32768,U=1<<19,X=1<<21,Y=1<<23,$=Symbol("$state"),V=new class extends Error{constructor(){super(...arguments),b(this,"name","StaleReactionError"),b(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}},J=Symbol();function Q(t){return t===this.v}function tt(t){return i=t,n=this.v,!(i!=i?n==n:i!==n||null!==i&&"object"==typeof i||"function"==typeof i);var i,n}let it=0,nt=null;function st(t){nt=t}function et(t,i=0,n){nt={p:nt,c:null,e:null,s:t,x:null,l:it&&!i?{s:null,u:null,$:[]}:null}}function rt(t){var i=nt,n=i.e;if(null!==n)for(var s of(i.e=null,n))Kt(s);return nt=i.p,{}}function ot(){return!it||null!==nt&&null===nt.l}const ht=new WeakMap;function lt(t,i){for(;null!==i;){if(128&i.f)try{return void i.b.error(t)}catch(n){t=n}i=i.parent}throw t instanceof Error&&at(t),t}function at(t){const i=ht.get(t);i&&(A(t,"message",{value:i.message}),A(t,"stack",{value:i.stack}))}let ut=[];function ct(){var t=ut;ut=[],L(t)}function ft(t){var i=2050,n=null!==si&&2&si.f?si:null;return null===oi||null!==n&&0!==(n.f&q)?i|=q:oi.f|=U,{ctx:nt,deps:null,effects:null,equals:Q,f:i,fn:t,reactions:null,rv:0,v:J,wv:0,parent:null!=n?n:oi,ac:null}}function vt(t){var i=t.effects;if(null!==i){t.effects=null;for(var n=0;n<i.length;n+=1)$t(i[n])}}function dt(t){var i,n=oi;hi(function(t){for(var i=t.parent;null!==i;){if(!(2&i.f))return i;i=i.parent}return null}(t));try{vt(t),i=Mi(t)}finally{hi(n)}return i}function pt(t){var i=dt(t);t.equals(i)||(t.v=i,t.wv=mi()),ii||(null!==gt?gt.set(t,t.v):_i(t,!wi&&0===(t.f&q)||null===t.deps?N:Z))}const wt=new Set;let mt=null,gt=null,yt=new Set,Mt=[];function bt(){const t=Mt.shift();Mt.length>0&&queueMicrotask(bt),t()}let xt=[],kt=null,Ct=0;t=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,e=new WeakMap,r=new WeakMap,o=new WeakMap,h=new WeakMap,l=new WeakMap,a=new WeakMap,u=new WeakMap,c=new WeakMap,f=new WeakSet,v=function(t){var i;t.f^=N;for(var n=t.first;null!==n;){var s=n.f,e=!!(96&s);if(!(e&&0!==(s&N)||0!==(s&G)||this.skipped_effects.has(n))&&null!==n.fn){e?n.f^=N:0===(s&N)&&(4&s?k(this,l).push(n):4194304&s?((null==(i=n.b)?void 0:i.pending)?k(this,o):k(this,r)).push(n):gi(n)&&(16&n.f&&k(this,a).push(n),ki(n)));var h=n.first;if(null!==h){n=h;continue}}var u=n.parent;for(n=n.next;null===n&&null!==u;)n=u.next,u=u.parent}},d=function(t){for(const i of t)(0!==(i.f&z)?k(this,u):k(this,c)).push(i),_i(i,N);t.length=0},p=function(){if(!k(this,e))for(const t of k(this,i))t();k(this,i).clear()};let Tt=class w{constructor(){C(this,f),b(this,"current",new Map),C(this,t,new Map),C(this,i,new Set),C(this,n,0),C(this,s,null),C(this,e,0),C(this,r,[]),C(this,o,[]),C(this,h,[]),C(this,l,[]),C(this,a,[]),C(this,u,[]),C(this,c,[]),b(this,"skipped_effects",new Set)}process(i){var e;xt=[];var u=null;if(wt.size>1){u=new Map,gt=new Map;for(const[t,i]of this.current)u.set(t,{v:t.v,wv:t.wv}),t.v=i;for(const i of wt)if(i!==this)for(const[n,s]of k(i,t))u.has(n)||(u.set(n,{v:n.v,wv:n.wv}),n.v=s)}for(const t of i)S(this,f,v).call(this,t);if(0===k(this,r).length&&0===k(this,n)){S(this,f,p).call(this);var c=k(this,h),w=k(this,l);T(this,h,[]),T(this,l,[]),T(this,a,[]),mt=null,Pt(c),Pt(w),null===mt?mt=this:wt.delete(this),null==(e=k(this,s))||e.resolve()}else S(this,f,d).call(this,k(this,h)),S(this,f,d).call(this,k(this,l)),S(this,f,d).call(this,k(this,a));if(u){for(const[t,{v:i,wv:n}]of u)t.wv>n||(t.v=i);gt=null}for(const t of k(this,r))ki(t);for(const t of k(this,o))ki(t);T(this,r,[]),T(this,o,[])}capture(i,n){k(this,t).has(i)||k(this,t).set(i,n),this.current.set(i,i.v)}activate(){mt=this}deactivate(){mt=null;for(const t of yt)if(yt.delete(t),t(),null!==mt)break}neuter(){T(this,e,1)}flush(){xt.length>0?function(){var t=Qt;Ct=1;try{var i=0;for(ti(1);xt.length>0;){var n=Tt.ensure();i++>1e3&&St(),n.process(xt),Et.clear()}}finally{Ct=0,ti(t),kt=null}}():S(this,f,p).call(this),mt===this&&(0===k(this,n)&&wt.delete(this),this.deactivate())}increment(){T(this,n,k(this,n)+1)}decrement(){if(T(this,n,k(this,n)-1),0===k(this,n)){for(const t of k(this,u))_i(t,z),_t(t);for(const t of k(this,c))_i(t,Z),_t(t);T(this,h,[]),T(this,l,[]),this.flush()}else this.deactivate()}add_callback(t){k(this,i).add(t)}settled(){var t,i,n;return(null!=(t=k(this,s))?t:T(this,s,{promise:new Promise((t,s)=>{i=t,n=s}),resolve:i,reject:n})).promise}static ensure(){if(null===mt){const t=mt=new w;wt.add(mt),w.enqueue(()=>{mt===t&&t.flush()})}return mt}static enqueue(t){0===Mt.length&&queueMicrotask(bt),Mt.unshift(t)}};function St(){try{!function(){throw Error("https://svelte.dev/e/effect_update_depth_exceeded")}()}catch(t){lt(t,kt)}}function Pt(t){var i=t.length;if(0!==i){for(var n=0;i>n;){var s=t[n++];if(!(24576&s.f)&&gi(s)){var e=mt?mt.current.size:0;if(ki(s),null===s.deps&&null===s.first&&null===s.nodes_start&&(null===s.teardown&&null===s.ac?Vt(s):s.fn=null),null!==mt&&mt.current.size>e&&1048576&s.f)break}}for(;i>n;)_t(t[n++])}}function _t(t){for(var i=kt=t;null!==i.parent;){var n=(i=i.parent).f;if(Ct&&i===oi&&16&n)return;if(96&n){if(0===(n&N))return;i.f^=N}}xt.push(i)}const Et=new Map;function Ot(t,i){return{f:0,v:t,reactions:null,equals:Q,rv:0,wv:0}}function At(t,i){const n=Ot(t);var s;return s=n,null!==si&&(null===li?li=[s]:li.push(s)),n}function Rt(t,i=0,n=1){var s,e;const r=Ot(t);return i||(r.equals=tt),it&&n&&null!==nt&&null!==nt.l&&(null!=(e=(s=nt.l).s)?e:s.s=[]).push(r),r}function Wt(t,i,n=0){return null!==si&&(!ei||!!(131072&si.f))&&ot()&&4325394&si.f&&!(null==li?void 0:li.includes(t))&&function(){throw Error("https://svelte.dev/e/state_unsafe_mutation")}(),function(t,i){if(!t.equals(i)){var n=t.v;ii?Et.set(t,i):Et.set(t,n),t.v=i,Tt.ensure().capture(t,n),2&t.f&&(0!==(t.f&z)&&dt(t),_i(t,0===(t.f&q)?N:Z)),t.wv=mi(),Dt(t,z),!ot()||null===oi||0===(oi.f&N)||96&oi.f||(null===ci?function(t){ci=t}([t]):ci.push(t))}return i}(t,n?jt(i):i)}function Ft(t){Wt(t,t.v+1)}function Dt(t,i){var n=t.reactions;if(null!==n)for(var s=ot(),e=n.length,r=0;e>r;r++){var o=n[r],h=o.f;if(s||o!==oi){var l=0===(h&z);l&&_i(o,i),2&h?Dt(o,Z):l&&_t(o)}}}function jt(t){if("object"!=typeof t||null===t||$ in t)return t;const i=j(t);if(i!==F&&i!==D)return t;var n=new Map,s=_(t),e=At(0),r=di,o=t=>{if(di===r)return t();var i=si,n=di;ri(null),pi(r);var s=t();return ri(i),pi(n),s};return s&&n.set("length",At(t.length)),new Proxy(t,{defineProperty(t,i,s){"value"in s&&0!=s.configurable&&0!=s.enumerable&&0!=s.writable||function(){throw Error("https://svelte.dev/e/state_descriptors_fixed")}();var e=n.get(i);return void 0===e?e=o(()=>{var t=At(s.value);return n.set(i,t),t}):Wt(e,s.value,1),1},deleteProperty(t,i){var s=n.get(i);if(void 0===s){if(i in t){const t=o(()=>At(J));n.set(i,t),Ft(e)}}else Wt(s,J),Ft(e);return 1},get(i,s,e){var r;if(s===$)return t;var h=n.get(s),l=s in i;if(void 0!==h||l&&!(null==(r=R(i,s))?void 0:r.writable)||(h=o(()=>At(jt(l?i[s]:J))),n.set(s,h)),void 0!==h){var a=Ci(h);return a===J?void 0:a}return Reflect.get(i,s,e)},getOwnPropertyDescriptor(t,i){var s=Reflect.getOwnPropertyDescriptor(t,i);if(s&&"value"in s){var e=n.get(i);e&&(s.value=Ci(e))}else if(void 0===s){var r=n.get(i),o=null==r?void 0:r.v;if(void 0!==r&&o!==J)return{enumerable:1,configurable:1,value:o,writable:1}}return s},has(t,i){var s;if(i===$)return 1;var e=n.get(i),r=void 0!==e&&e.v!==J||Reflect.has(t,i);return void 0===e&&(null===oi||r&&!(null==(s=R(t,i))?void 0:s.writable))||(void 0===e&&(e=o(()=>At(r?jt(t[i]):J)),n.set(i,e)),Ci(e)!==J)?r:0},set(t,i,r,h){var l,a=n.get(i),u=i in t;if(s&&"length"===i)for(var c=r;c<a.v;c+=1){var f=n.get(c+"");void 0!==f?Wt(f,J):c in t&&(f=o(()=>At(J)),n.set(c+"",f))}void 0===a?u&&!(null==(l=R(t,i))?void 0:l.writable)||(Wt(a=o(()=>At(void 0)),jt(r)),n.set(i,a)):(u=a.v!==J,Wt(a,o(()=>jt(r))));var v=Reflect.getOwnPropertyDescriptor(t,i);if((null==v?void 0:v.set)&&v.set.call(h,r),!u){if(s&&"string"==typeof i){var d=n.get("length"),p=+i;Number.isInteger(p)&&p>=d.v&&Wt(d,p+1)}Ft(e)}return 1},ownKeys(t){Ci(e);var i=Reflect.ownKeys(t).filter(t=>{var i=n.get(t);return void 0===i||i.v!==J});for(var[s,r]of n)r.v===J||s in t||i.push(s);return i},setPrototypeOf(){!function(){throw Error("https://svelte.dev/e/state_prototype_fixed")}()}})}var It,Bt,Lt,qt;function Nt(t){return Lt.call(t)}function zt(t){return qt.call(t)}function Zt(t){null===oi&&null===si&&function(){throw Error("https://svelte.dev/e/effect_orphan")}(),null!==si&&0!==(si.f&q)&&null===oi&&function(){throw Error("https://svelte.dev/e/effect_in_unowned_derived")}(),ii&&function(){throw Error("https://svelte.dev/e/effect_in_teardown")}()}function Gt(t,i,n,s=1){var e,r=oi;null!==r&&0!==(r.f&G)&&(t|=G);var o={ctx:nt,deps:null,nodes_start:null,nodes_end:null,f:t|z,first:null,fn:i,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{ki(o),o.f|=K}catch(l){throw $t(o),l}else null!==i&&_t(o);if((!n||null!==o.deps||null!==o.first||null!==o.nodes_start||null!==o.teardown||0!==(o.f&U))&&s&&(null!==r&&function(t,i){var n=i.last;null===n?i.last=i.first=t:(n.next=t,t.prev=n,i.last=t)}(o,r),null!==si&&2&si.f&&!(64&t))){var h=si;(null!=(e=h.effects)?e:h.effects=[]).push(o)}return o}function Ht(t){var i;Zt();var n=oi.f;if(si||!(32&n)||0!==(n&K))return Kt(t);var s=nt;(null!=(i=s.e)?i:s.e=[]).push(t)}function Kt(t){return Gt(1048580,t,0)}function Ut(t){Tt.ensure();const i=Gt(64,t,1);return(t={})=>new Promise(n=>{t.outro?function(t,i){var n=[];Jt(t,n,1),function(t,i){var n=t.length;if(n>0){var s=()=>--n||i();for(var e of t)e.out(s)}else i()}(n,()=>{$t(t),i&&i()})}(i,()=>{$t(i),n(void 0)}):($t(i),n(void 0))})}function Xt(t){var i=t.teardown;if(null!==i){const t=ii,n=si;ni(1),ri(null);try{i.call(null)}finally{ni(t),ri(n)}}}function Yt(t,i=0){var n,s=t.first;for(t.first=t.last=null;null!==s;){null==(n=s.ac)||n.abort(V);var e=s.next;64&s.f?s.parent=null:$t(s,i),s=e}}function $t(t,i=1){var n=0;(i||262144&t.f)&&null!==t.nodes_start&&null!==t.nodes_end&&(function(t,i){for(;null!==t;){var n=t===i?null:zt(t);t.remove(),t=n}}(t.nodes_start,t.nodes_end),n=1),Yt(t,i&&!n),xi(t,0),_i(t,H);var s=t.transitions;if(null!==s)for(const r of s)r.stop();Xt(t);var e=t.parent;null!==e&&null!==e.first&&Vt(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function Vt(t){var i=t.parent,n=t.prev,s=t.next;null!==n&&(n.next=s),null!==s&&(s.prev=n),null!==i&&(i.first===t&&(i.first=s),i.last===t&&(i.last=n))}function Jt(t,i,n){if(0===(t.f&G)){if(t.f^=G,null!==t.transitions)for(const s of t.transitions)(s.is_global||n)&&i.push(s);for(var s=t.first;null!==s;){var e=s.next;Jt(s,i,65536&s.f||32&s.f?n:0),s=e}}}let Qt=0;function ti(t){Qt=t}let ii=0;function ni(t){ii=t}let si=null,ei=0;function ri(t){si=t}let oi=null;function hi(t){oi=t}let li=null,ai=null,ui=0,ci=null,fi=1,vi=0,di=vi;function pi(t){di=t}let wi=0;function mi(){return++fi}function gi(t){var i,n,s=t.f;if(0!==(s&z))return 1;if(0!==(s&Z)){var e=t.deps,r=0!==(s&q);if(null!==e){var o,h,l=!!(512&s),a=r&&null!==oi&&!wi,u=e.length;if((l||a)&&(null===oi||0===(oi.f&H))){var c=t,f=c.parent;for(o=0;u>o;o++)h=e[o],!l&&(null==(i=null==h?void 0:h.reactions)?void 0:i.includes(c))||(null!=(n=h.reactions)?n:h.reactions=[]).push(c);l&&(c.f^=512),a&&null!==f&&0===(f.f&q)&&(c.f^=q)}for(o=0;u>o;o++)if(gi(h=e[o])&&pt(h),h.wv>t.wv)return 1}r&&(null===oi||wi)||_i(t,N)}return 0}function yi(t,i,n=1){var s=t.reactions;if(null!==s&&!(null==li?void 0:li.includes(t)))for(var e=0;e<s.length;e++){var r=s[e];2&r.f?yi(r,i,0):i===r&&(n?_i(r,z):0!==(r.f&N)&&_i(r,Z),_t(r))}}function Mi(t){var i,n,s=ai,e=ui,r=ci,o=si,h=wi,l=li,a=nt,u=ei,c=di,f=t.f;ai=null,ui=0,ci=null,wi=0!==(f&q)&&(ei||!Qt||null===si),si=96&f?null:t,li=null,st(t.ctx),ei=0,di=++vi,null!==t.ac&&(t.ac.abort(V),t.ac=null);try{t.f|=X;var v=(0,t.fn)(),d=t.deps;if(null!==ai){var p;if(xi(t,ui),null!==d&&ui>0)for(d.length=ui+ai.length,p=0;p<ai.length;p++)d[ui+p]=ai[p];else t.deps=d=ai;if(!wi||2&f&&null!==t.reactions)for(p=ui;p<d.length;p++)(null!=(n=(i=d[p]).reactions)?n:i.reactions=[]).push(t)}else null!==d&&ui<d.length&&(xi(t,ui),d.length=ui);if(ot()&&null!==ci&&!ei&&null!==d&&!(6146&t.f))for(p=0;p<ci.length;p++)yi(ci[p],t);return null!==o&&o!==t&&(vi++,null!==ci&&(null===r?r=ci:r.push(...ci))),0!==(t.f&Y)&&(t.f^=Y),v}catch(w){return function(t){var i=oi;if(null===i)return si.f|=Y,t;if(0===(i.f&K)){if(!(128&i.f))throw!i.parent&&t instanceof Error&&at(t),t;i.b.error(t)}else lt(t,i)}(w)}finally{t.f^=X,ai=s,ui=e,ci=r,si=o,wi=h,li=l,st(a),ei=u,di=c}}function bi(t,i){let n=i.reactions;if(null!==n){var s=E.call(n,t);if(-1!==s){var e=n.length-1;0===e?n=i.reactions=null:(n[s]=n[e],n.pop())}}null===n&&2&i.f&&(null===ai||!ai.includes(i))&&(_i(i,Z),768&i.f||(i.f^=512),vt(i),xi(i,0))}function xi(t,i){var n=t.deps;if(null!==n)for(var s=i;s<n.length;s++)bi(t,n[s])}function ki(t){var i=t.f;if(0===(i&H)){_i(t,N);var n=oi,s=Qt;oi=t,Qt=1;try{16&i?function(t){for(var i=t.first;null!==i;){var n=i.next;!(32&i.f)&&$t(i),i=n}}(t):Yt(t),Xt(t);var e=Mi(t);t.teardown="function"==typeof e?e:null,t.wv=fi}finally{Qt=s,oi=n}}}function Ci(t){var i,n=!!(2&t.f);if(null===si||ei){if(n&&null===t.deps&&null===t.effects){var s=t,e=s.parent;null!==e&&0===(e.f&q)&&(s.f^=q)}}else if((null===oi||0===(oi.f&H))&&!(null==li?void 0:li.includes(t))){var r=si.deps;if(0!==(si.f&X))t.rv<vi&&(t.rv=vi,null===ai&&null!==r&&r[ui]===t?ui++:null===ai?ai=[t]:wi&&ai.includes(t)||ai.push(t));else{(null!=(i=si.deps)?i:si.deps=[]).push(t);var o=t.reactions;null===o?t.reactions=[si]:o.includes(si)||o.push(si)}}if(ii){if(Et.has(t))return Et.get(t);if(n){var h=(s=t).v;return(0===(s.f&N)&&null!==s.reactions||Ti(s))&&(h=dt(s)),Et.set(s,h),h}}else if(n){if(s=t,null==gt?void 0:gt.has(s))return gt.get(s);gi(s)&&pt(s)}if(0!==(t.f&Y))throw t.v;return t.v}function Ti(t){if(t.v===J)return 1;if(null===t.deps)return 0;for(const i of t.deps){if(Et.has(i))return 1;if(2&i.f&&Ti(i))return 1}return 0}function Si(t){var i=ei;try{return ei=1,t()}finally{ei=i}}const Pi=-7169;function _i(t,i){t.f=t.f&Pi|i}function Ei(t,i=new Set){if(!("object"!=typeof t||null===t||t instanceof EventTarget||i.has(t))){i.add(t),t instanceof Date&&t.getTime();for(let e in t)try{Ei(t[e],i)}catch(n){}const s=j(t);if(s!==Object.prototype&&s!==Array.prototype&&s!==Map.prototype&&s!==Set.prototype&&s!==Date.prototype){const i=W(s);for(let s in i){const e=i[s].get;if(e)try{e.call(t)}catch(n){}}}}}const Oi=["touchstart","touchmove"];function Ai(t){return Oi.includes(t)}const Ri=new Set,Wi=new Set;function Fi(t){var i,n=this,s=n.ownerDocument,e=t.type,r=(null==(i=t.composedPath)?void 0:i.call(t))||[],o=r[0]||t.target,h=0,l=t.t;if(l){var a=r.indexOf(l);if(-1!==a&&(n===document||n===window))return void(t.t=n);var u=r.indexOf(n);if(-1===u)return;a>u||(h=a)}if((o=r[h]||t.target)!==n){A(t,"currentTarget",{configurable:1,get:()=>o||s});var c=si,f=oi;ri(null),hi(null);try{for(var v,d=[];null!==o;){var p=o.assignedSlot||o.parentNode||o.host||null;try{var w=o["__"+e];if(null!=w&&(!o.disabled||t.target===o))if(_(w)){var[m,...g]=w;m.call(o,t,...g)}else w.call(o,t)}catch(y){v?d.push(y):v=y}if(t.cancelBubble||p===n||null===p)break;o=p}if(v){for(let t of d)queueMicrotask(()=>{throw t});throw v}}finally{t.t=n,delete t.currentTarget,ri(c),hi(f)}}}function Di(t,i){var n,s=!!(2&i),e=!t.startsWith("<!>");return()=>{var i,r;void 0===n&&(i=e?t:"<!>"+t,(r=document.createElement("template")).innerHTML=i.replaceAll("<!>","\x3c!----\x3e"),n=Nt(n=r.content));var o,h,l,a=s||Bt?document.importNode(n,1):n.cloneNode(1);return o=a,h=a,null===(l=oi).nodes_start&&(l.nodes_start=o,l.nodes_end=h),a}}const ji=new Map;let Ii=new WeakMap;function Bi(t,i){return t===i||(null==t?void 0:t[$])===i}function Li(t,i){if(t.l.s)for(const n of t.l.s)Ci(n);i()}"undefined"!=typeof window&&(null!=(g=(m=null!=(w=window.__svelte)?w:window.__svelte={}).v)?g:m.v=new Set).add("5"),it=1;class qi{constructor(t){b(this,"prevFrequency"),b(this,"prevTime"),b(this,"alpha",.025),this.prevFrequency=t,this.prevTime=performance.now()}get(){return this.prevFrequency}getPrevTime(){return this.prevTime}update(){const t=performance.now(),i=1e3/(t-this.prevTime||1);this.prevFrequency=this.prevFrequency*(1-this.alpha)+this.alpha*i,this.prevTime=t}}var Ni,zi="undefined"!=typeof Float32Array?Float32Array:Array,Zi=Math.random;function Gi(){var t=new zi(3);return zi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Hi(t){var i=t[0],n=t[1],s=t[2];return Math.sqrt(i*i+n*n+s*s)}function Ki(t,i,n){var s=new zi(3);return s[0]=t,s[1]=i,s[2]=n,s}function Ui(t,i){return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function Xi(t,i,n){return t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function Yi(t,i,n){return t[0]=i[0]-n[0],t[1]=i[1]-n[1],t[2]=i[2]-n[2],t}function $i(t,i,n){return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t}function Vi(t,i,n,s){return t[0]=i[0]+n[0]*s,t[1]=i[1]+n[1]*s,t[2]=i[2]+n[2]*s,t}function Ji(t,i){var n=i[0],s=i[1],e=i[2],r=n*n+s*s+e*e;return r>0&&(r=1/Math.sqrt(r)),t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t}function Qi(t,i){i=void 0===i?1:i;var n=2*Zi()*Math.PI,s=2*Zi()-1,e=Math.sqrt(1-s*s)*i;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t[2]=s*i,t}function tn(t,i){var n=new zi(2);return n[0]=t,n[1]=i,n}Gi(),Ni=new zi(2),zi!=Float32Array&&(Ni[0]=0,Ni[1]=0);class nn{constructor(t){b(this,"canvas"),b(this,"positionOnCanvas"),b(this,"isPressed",0),b(this,"isMouseOver",1),this.canvas=t,this.canvas.tabIndex=0,this.setupListeners(t)}isMousePressed(){return this.isPressed&&this.isMouseOver}isMouseFocused(){return this.isMouseOver}getPositionOnCanvas(){if(this.isMouseFocused()&&this.positionOnCanvas)return this.positionOnCanvas}setupListeners(t){t.addEventListener("focus",()=>{this.isMouseOver=1}),t.addEventListener("mouseenter",()=>{this.isMouseOver=1}),t.addEventListener("mouseover",()=>{this.isMouseOver=1}),t.addEventListener("mouseleave",()=>{this.isMouseOver=0,this.isPressed=0,this.positionOnCanvas=void 0}),t.addEventListener("mousemove",t=>{this.isMouseOver=1;const i=tn(t.clientX,t.clientY);this.positionOnCanvas=i}),t.addEventListener("mousedown",()=>{this.isPressed=1}),t.addEventListener("mouseup",()=>{this.isPressed=0})}}function sn(t,i){const n=i[0]-t[0],s=i[1]-t[1],e=Math.max(Math.abs(n),Math.abs(s));return[n/e,s/e]}class en{constructor(t){b(this,"canvas"),b(this,"CLOSING_RADIUS",10),b(this,"polygonOnCanvas",[]),b(this,"_state",null),b(this,"_eTag",0),this.canvas=t,this.canvas.tabIndex=0,this.setupListeners(t)}get state(){return this.i}set state(t){switch(this.i=t,this.o++,t){case"closed":{const t=function(t,i=10){const n=t.length;if(3>n)return;const s=[];let e=[-1/0,-1/0];for(let r=0;n>r;r++){const o=r===n-1?0:r+1,h=t[r],l=t[o];if(1.414*i>=Math.abs(h[0]-l[0])+Math.abs(h[1]-l[1]))continue;const a=sn(h,l);e[0]===a[0]&&e[1]===a[1]||(e=a,s.push(h))}return 3>s.length?void 0:s}(this.polygonOnCanvas);if(t)return void(this.polygonOnCanvas=t);this.i="failed";break}}}getState(){return{state:this.state,eTag:this.o}}getPolygonOnCanvas(){return this.polygonOnCanvas}setupListeners(t){let i=0;t.addEventListener("click",t=>{if(!i){i=1;try{const i=tn(t.clientX,t.clientY);switch(this.state){case null:case"failed":case"closed":this.polygonOnCanvas=[i],this.state="drawing";break;case"drawing":{const t=this.polygonOnCanvas[0];if(Math.abs(i[0]-t[0])+Math.abs(i[1]-t[1])<=this.CLOSING_RADIUS){this.state="closed";break}this.polygonOnCanvas.push(i);break}default:throw Error("Unexpected polygon state: ".concat(this.state))}}finally{i=0}}}),t.addEventListener("dblclick",()=>{switch(this.state){case null:break;case"failed":case"closed":this.polygonOnCanvas=[],this.state=null;break;case"drawing":this.state="closed";break;default:throw Error("Unexpected polygon state: ".concat(this.state))}})}}class rn{constructor(t,i,n,s){b(this,"start"),b(this,"end"),b(this,"width"),b(this,"height"),this.start={x:t,y:i},this.end={x:t+n,y:i+s},this.width=n,this.height=s}equals(t){return this.start.x===t.start.x&&this.start.y===t.start.y&&this.width===t.width&&this.height===t.height}}class on{constructor(t,i,n=.15){b(this,"canvasBox"),b(this,"paddingRatio"),b(this,"maxDepth"),b(this,"halfDepth"),b(this,"polygon"),b(this,"centroids"),this.canvasBox=t,this.paddingRatio=n,this.maxDepth=i,this.halfDepth=i/2,this.polygon=this.defaultPolygon(),this.centroids=[]}defaultPolygon(){const t=Math.min(this.canvasBox.width*this.paddingRatio,this.canvasBox.height*this.paddingRatio);return[Ki(this.canvasBox.start.x+t,this.canvasBox.start.y+t,this.halfDepth),Ki(this.canvasBox.end.x-t,this.canvasBox.start.y+t,this.halfDepth),Ki(this.canvasBox.end.x-t,this.canvasBox.end.y-t,this.halfDepth),Ki(this.canvasBox.start.x+t,this.canvasBox.end.y-t,this.halfDepth)]}getPolygon(){return this.polygon}setPolygon(t){this.polygon=t.map(t=>Ki(t[0]+this.canvasBox.start.x,t[1]+this.canvasBox.start.y,this.halfDepth))}resetPolygon(){this.polygon=this.defaultPolygon()}getCentroids(){return this.centroids}addCentroid(t){const i=Ki(t[0]+this.canvasBox.start.x,t[1]+this.canvasBox.start.y,this.halfDepth);this.centroids.push(i)}clearCentroids(){this.centroids.length=0}isOutside(t){const i=t[2];return i>this.maxDepth||0>i||!function(t,i){if(3>i.length)return 0;let n=0;const s=t[0],e=t[1];for(let r=0,o=i.length-1;r<i.length;o=r++){const t=i[r][0],h=i[r][1],l=i[o][0],a=i[o][1],u=a-h;if(0!==u){if(e>=h==a>e&&e!==a){const i=(l-t)*(e-h)/u+t;if(s===i)return 0;i>s&&(n=!n)}}else if(s>=t==l>s&&h===e)return 0}return n}(t,this.polygon)}resize(t){if(this.canvasBox.equals(t))return;const i=t.width===this.canvasBox.width?1:t.width/this.canvasBox.width,n=t.height===this.canvasBox.height?1:t.height/this.canvasBox.height;for(const s of this.polygon)s[0]=(s[0]-this.canvasBox.start.x)*i+t.start.x,s[1]=(s[1]-this.canvasBox.start.y)*n+t.start.y;for(const s of this.centroids)s[0]=(s[0]-this.canvasBox.start.x)*i+t.start.x,s[1]=(s[1]-this.canvasBox.start.y)*n+t.start.y;this.canvasBox=t}}const hn={clearCanvasIfResized:1,boids:{lineWidth:.1,size:3},flightZone:{polygonColor:"#888888"},debug:{flightZone:{polygonColor:"#888888",centroidsColor:"#0000ff"},centerOwMassColor:"#ffff00",maxHeightColor:"#ff0000"}};class ln{constructor(t,i,n={}){b(this,"window"),b(this,"canvas"),b(this,"renderingContext"),b(this,"config"),b(this,"screenBox"),b(this,"canvasBox"),b(this,"maxHeight"),b(this,"devicePixelRatio"),b(this,"screenHasTopLeft",0),b(this,"patternCache",{}),this.window=t,this.canvas=i;const s=i.getContext("2d");if(!s)throw Error("Canvas context not available");this.renderingContext=s,this.config={...hn,...n},this.screenBox=this.getScreenBox(),this.canvasBox=this.getCanvasBox(),this.devicePixelRatio=this.window.devicePixelRatio||1,this.maxHeight=this.getMaxHeight(),this.scaleCanvas()}getMaxHeight(){return this.screenHasTopLeft?this.screenBox.end.y-20:Math.max(this.canvasBox.end.y,this.screenBox.end.y)-20}checkResize(){this.screenBox=this.getScreenBox();const t=this.window.devicePixelRatio||1,i=this.getCanvasBox();return this.canvasBox.equals(i)&&this.devicePixelRatio===t?0:(this.config.clearCanvasIfResized&&this.clearCanvas(),this.devicePixelRatio=t,this.canvasBox=i,this.maxHeight=this.getMaxHeight(),this.scaleCanvas(),1)}getScreenBox(){let t=0,i=0;return"left"in this.window.screen&&"top"in this.window.screen&&"number"==typeof this.window.screen.left&&"number"==typeof this.window.screen.top?(this.screenHasTopLeft=1,t=this.window.screen.left,i=this.window.screen.top):this.screenHasTopLeft=0,new rn(t,i,this.window.screen.width,this.window.screen.height)}getCanvasBox(){const t=this.canvas.getBoundingClientRect();return new rn(this.window.screenX+(this.window.outerWidth-this.window.innerWidth)+t.left,this.window.screenY+(this.window.outerHeight-this.window.innerHeight)+t.top,t.width,t.height)}scaleCanvas(){const t=this.renderingContext,i=this.canvas.clientWidth,n=this.canvas.clientHeight;this.canvas.width=i*this.devicePixelRatio,this.canvas.height=n*this.devicePixelRatio,t.scale(this.devicePixelRatio,this.devicePixelRatio)}clearCanvas(){const t=this.renderingContext;t.canvas.width=t.canvas.width,t.scale(this.devicePixelRatio,this.devicePixelRatio)}drawStats(t,i,n){const s=this.renderingContext;s.save(),s.font="10px monospace",s.fillStyle="#888888",s.fillText("Boids: ".concat(t),16,24),s.fillText("TPS:   ".concat(Math.round(i)," ~ ").concat(n),16,40),s.restore()}drawHeight(t){const i=this.renderingContext;i.save();const n=t-this.canvasBox.start.y;i.strokeStyle=this.config.debug.maxHeightColor,i.lineWidth=1,i.beginPath(),i.moveTo(0,n),i.lineTo(this.canvasBox.width,n),i.stroke(),i.restore()}drawCenterOwMass(t){const i=this.renderingContext;i.save();const n=t[0]-this.canvasBox.start.x,s=t[1]-this.canvasBox.start.y;i.lineWidth=1,i.strokeStyle=this.config.debug.centerOwMassColor,i.setLineDash([]),i.beginPath(),i.moveTo(n-5,s-5),i.lineTo(n+5,s+5),i.moveTo(n+5,s-5),i.lineTo(n-5,s+5),i.stroke(),i.restore()}drawFlightZone(t,i,n){if(!n)return;const s=this.canvasBox.start.x,e=this.canvasBox.start.y,r=t.getPolygon(),o=t.getCentroids(),h=(n?this.config.debug.flightZone.polygonColor:this.config.flightZone.polygonColor)+"0d",l=this.renderingContext;l.save(),l.fillStyle=h,l.beginPath(),l.moveTo(r[0][0]-s,r[0][1]-e);for(let a=1;a<r.length;a++)l.lineTo(r[a][0]-s,r[a][1]-e);l.closePath(),l.fill("evenodd"),l.restore(),l.save(),l.strokeStyle=this.config.debug.flightZone.centroidsColor;for(const a of o){const t=a[0]-s,n=a[1]-e,r=10;l.setLineDash([]),l.beginPath(),l.moveTo(t-r,n),l.lineTo(t+r,n),l.moveTo(t,n-r),l.lineTo(t,n+r),l.stroke(),l.setLineDash([4,6]),l.beginPath(),l.arc(t,n,i,0,2*Math.PI),l.stroke()}l.restore()}drawDraftPolygon(t,i,n,s,e=1){const r=this.renderingContext;r.save();const o=n||"#888888";if(null!=s){const t=s/500*e%2;r.globalAlpha=t>1?2-t:t}r.lineWidth=1,r.strokeStyle=o;let h=t[0][0]-0,l=t[0][1]-0;r.beginPath(),r.arc(h,l,10,0,2*Math.PI),r.stroke(),r.beginPath(),r.moveTo(h-5,l),r.lineTo(h+5,l),r.moveTo(h,l-5),r.lineTo(h,l+5),r.stroke();let a=this.patternCache.DraftPolygonFillStyle;a||(a=function(t,i=8){const n=document.createElement("canvas");n.width=n.height=i;const s=n.getContext("2d");if(!s)throw Error("Canvas context not available");s.strokeStyle=t,s.lineWidth=1,s.beginPath(),s.moveTo(i,0),s.lineTo(0,i),s.stroke();const e=s.createPattern(n,"repeat");if(!e)throw Error("Failed to create pattern");return e}(o+"33",8),this.patternCache.DraftPolygonFillStyle=a),r.fillStyle=a,r.setLineDash([4,4]),r.beginPath(),r.moveTo(h,l);for(let u=1;u<t.length;u++)h=t[u][0]-0,l=t[u][1]-0,r.lineTo(h,l);i&&(r.closePath(),r.fill("evenodd")),r.stroke(),r.setLineDash([]),r.beginPath(),r.moveTo(h,l);for(let u=0;u<t.length;u++)h=t[u][0]-0,l=t[u][1]-0,r.moveTo(h-5,l),r.lineTo(h+5,l),r.moveTo(h,l-5),r.lineTo(h,l+5);r.stroke(),r.restore()}drawBoid(t,i){const n=t.getPosition(),s=t.getVelocity(),e=this.canvasBox.start.x,r=this.canvasBox.start.y,o=1.2-Math.max(.2,Math.min(1.2,n[2]/i)),h=this.config.boids.size+2*o-1,l=this.renderingContext;l.save(),l.lineWidth=this.config.boids.lineWidth,l.strokeStyle="hsl(10, 10%, ".concat(60*o+30,"%)"),l.beginPath(),l.translate(n[0]-e,n[1]-r),l.rotate(Math.atan2(s[1],s[0])),l.scale(h,h),l.moveTo(-.5,.3),l.lineTo(1,0),l.lineTo(-.5,-.3),l.moveTo(-.5,.3),l.lineTo(-.5,-.3),l.stroke(),l.restore()}}function an(t,i){if(i>=t.length)return t.slice();const n=[];for(let s=0;i>s;s++)n[s]=t[s];for(let s=i;s<t.length;s++){const e=Math.floor(Math.random()*(s+1));i>e&&(n[e]=t[s])}return n}class un{constructor(t,i){b(this,"cellSize"),b(this,"cellRadius"),b(this,"centerOwMass",Ki(500,500,100)),b(this,"centerOwMassAlpha"),b(this,"grid",new Map),b(this,"itemCellKeys",new Map),this.cellSize=Ki(t.x,t.y,0),this.cellRadius=Math.ceil(Math.sqrt((t.x*t.x+t.y*t.y)/2)),this.centerOwMassAlpha=2/(i+1)}set maxItemCount(t){this.centerOwMassAlpha=2/(t+1)}getCellKey(t){return"".concat(Math.floor(t[0]/this.cellSize[0]),",").concat(Math.floor(t[1]/this.cellSize[1]))}remove(t){const i=this.itemCellKeys.get(t);i&&(this.removeFromGrid(t,i),this.itemCellKeys.delete(t))}update(t){const i=t.getPosition(),n=this.getCellKey(i),s=this.itemCellKeys.get(t);if(s===n)return;s&&this.removeFromGrid(t,s);const e=this.grid.get(n);e?e.push(t):this.grid.set(n,[t]),this.itemCellKeys.set(t,n),$i(this.centerOwMass,this.centerOwMass,1-this.centerOwMassAlpha);const r=Vi(Gi(),i,t.getVelocity(),2);Vi(this.centerOwMass,this.centerOwMass,r,this.centerOwMassAlpha)}clear(){this.grid.clear(),this.itemCellKeys.clear()}getRandomCellCoords(){const t=Array.from(this.grid.keys());if(0===t.length)return;const i=Math.floor(Math.random()*t.length),[n,s]=t[i].split(",").map(Number);return{startX:n*this.cellSize[0],startY:s*this.cellSize[1],width:this.cellSize[0],height:this.cellSize[1]}}getNeighbors(t,i){const n=this.getCellKey(t.getPosition()),s=[];let e=i.limitCount||100,r=Math.max(0,i.min);if(0==r){const i=this.grid.get(n);if(i)for(const n of i)if(n!==t&&(s.push(n),e--,0>=e))return s;r++}const[o,h]=n.split(",").map(Number);for(let l=r;l<=i.max;l++){const t=[];for(const{dx:i,dy:n}of this.diamondSpiralIterator(l)){const s=this.grid.get("".concat(o+i,",").concat(h+n));s&&t.push(...s)}if(t.length>=e)return s.push(...an(t,e)),s;s.push(...t),e-=t.length}return s}removeFromGrid(t,i){const n=this.grid.get(i);if(!n)return;const s=n.indexOf(t);-1!==s&&(1!=n.length?(n[s]=n[n.length-1],n.pop()):this.grid.delete(i))}*diamondSpiralIterator(t){let i=t,n=0;if(yield{dx:i,dy:n},0!==t){for(;i>0;)i--,n++,yield{dx:i,dy:n};for(;i>-t;)i--,n--,yield{dx:i,dy:n};for(;0>i;)i++,n--,yield{dx:i,dy:n};for(;t>i;)i++,n++,yield{dx:i,dy:n}}}}const cn={minSpeed:1,maxSpeed:5,maxTurnAngleDeg:140,acceleration:{backToFlightZone:1.2,stayCloseToCenterOwfMass:.1,followCentroids:1.6,pullUpTerrain:1.8,cohesion:.4,alignment:1,separation:1.8}};class fn{constructor(t,i,n={}){b(this,"displayId"),b(this,"position"),b(this,"velocity"),b(this,"acceleration"),b(this,"config"),b(this,"lastPositionInside"),b(this,"isOutside",0),b(this,"backToFlightZone"),b(this,"followCentroids"),this.displayId=t,this.config={...n,...cn};const s=2*Math.random()*Math.PI;this.position=i,this.velocity=Ki(.5*Math.cos(s),.5*Math.sin(s),Math.random()-.5),$i(this.velocity,this.velocity,this.config.maxSpeed),this.acceleration=Gi()}getPosition(){return this.position}getVelocity(){return this.velocity}getConfig(){return this.config}update(t,i,n,s,e,r,o,h,l,a){var u;let c=this.config.maxTurnAngleDeg,f=this.config.maxSpeed;const v=Gi();this.position[1]<r||(v[1]=-this.config.acceleration.pullUpTerrain,c+=20,f+=1);const d=e.getPolygon();if(!this.backToFlightZone){const t=this.isOutside;if(this.isOutside=e.isOutside(this.position),this.isOutside){const i=Gi();if(t)this.lastPositionInside&&e.isOutside(this.lastPositionInside)&&(this.lastPositionInside=void 0),Yi(i,null!=(u=this.lastPositionInside)?u:d[Math.floor(l*d.length)],this.position);else{const t=function(t,i){let n=1/0,s=Gi();const e=t.length;if(0===e)throw Error("Polygon must have at least one vertex");for(let r=0;e>r;r++){const o=t[r],h=t[r!==e-1?r+1:0],l=[h[0]-o[0],h[1]-o[1]],a=[-l[1],l[0]],u=l[0]*a[1]-l[1]*a[0];if(1e-6>u)continue;const c=i[0]-o[0],f=i[1]-o[1],v=(c*a[1]-f*a[0])/u,d=Ki(o[0]+v*l[0]-i[0],o[1]+v*l[1]-i[1],0),p=Math.abs(d[0])+Math.abs(d[1]);n>p&&(n=p,s=d)}return s}(d,this.position);Ui(i,t)}Ji(i,i),this.backToFlightZone={direction:i,remainingTicks:10}}else this.lastPositionInside=(p=this.position,(w=new zi(3))[0]=p[0],w[1]=p[1],w[2]=p[2],w)}var p,w;this.backToFlightZone&&(Vi(v,v,this.backToFlightZone.direction,this.config.acceleration.backToFlightZone),this.backToFlightZone.remainingTicks--,this.backToFlightZone.remainingTicks>0||(this.backToFlightZone=void 0));const m=e.getCentroids();if(!this.followCentroids&&m.length>0){const t=Gi();for(const i of m){const n=Yi(Gi(),i,this.position),s=Math.abs(n[0])+Math.abs(n[1]);o>s&&($i(n,n,(o-s)/s),Xi(t,t,n))}Ji(t,t),this.followCentroids={direction:t,remainingTicks:5}}this.followCentroids&&(Vi(v,v,this.followCentroids.direction,this.config.acceleration.followCentroids),this.followCentroids.remainingTicks--,this.followCentroids.remainingTicks>0||(this.followCentroids=void 0));const g=Yi(Gi(),s,this.position);Ji(g,g),Vi(v,v,g,this.config.acceleration.stayCloseToCenterOwfMass),Xi(v,v,this.cohesionAcceleration(t)),Xi(v,v,this.alignmentAcceleration(t,h)),Xi(v,v,this.separationAcceleration(i,n,h)),function(t,i,n,s){const e=Ji(Gi(),i),r=Ji(Gi(),n),o=s*Math.PI/180,h=(a=r,u=(l=e)[0],c=l[1],f=l[2],v=a[0],d=a[1],p=a[2],m=(w=Math.sqrt((u*u+c*c+f*f)*(v*v+d*d+p*p)))&&function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]}(l,a)/w,Math.acos(Math.min(Math.max(m,-1),1)));var l,a,u,c,f,v,d,p,w,m;h>o?(function(t,i,n,s){var e=i[0],r=i[1],o=i[2];t[0]=e+s*(n[0]-e),t[1]=r+s*(n[1]-r),t[2]=o+s*(n[2]-o)}(t,e,r,(o+20)/h),Ji(t,t),$i(t,t,Hi(n))):Ui(t,n)}(this.acceleration,this.velocity,v,c),this.isOutside||Xi(this.acceleration,this.acceleration,a);const y=Gi();Xi(y,this.velocity,this.acceleration);const M=Hi(y);.1>M||(this.velocity=y,M>f?$i(this.velocity,this.velocity,f/M):M<this.config.minSpeed&&$i(this.velocity,this.velocity,this.config.minSpeed/M)),this.position=Xi(this.position,this.position,this.velocity)}alignmentAcceleration(t,i){const n=Gi();for(const s of t)i<Math.abs(s.getPosition()[2]-this.position[2])||Xi(n,n,s.getVelocity());return Ji(n,n),$i(n,n,this.config.acceleration.alignment),n}cohesionAcceleration(t){const i=Gi();for(const n of t)Xi(i,i,Yi(Gi(),n.getPosition(),this.position));return Ji(i,i),$i(i,i,this.config.acceleration.cohesion),i}separationAcceleration(t,i,n){const s=Math.max(i,n),e=Gi();for(const r of t){const t=Yi(Gi(),this.position,r.getPosition());if(Math.abs(t[2])>n)continue;let i=Hi(t);i>1e-6||(i=10,Qi(t,i)),Vi(e,e,t,s/i-1)}return Ji(e,e),$i(e,e,this.config.acceleration.separation),e}}const vn={gravity:.05,maxDepth:250,visibleDistance:100,visibleDepth:60,grid:{cellSize:{x:10,y:10},neighborDistance:{min:1,max:6,limitCount:30},closeNeighborDistance:{min:0,max:0,limitCount:10}}};class dn{constructor(t,i={}){b(this,"simBox"),b(this,"config"),b(this,"maxBoidCount",0),b(this,"boidConfig",{}),b(this,"boids",[]),b(this,"spatialGrid"),b(this,"randomSeed",{value:1,remainingTicks:0}),b(this,"isRunning",0),b(this,"nextDisplayId",0),this.simBox=t,this.config={...vn,...i},this.spatialGrid=new un(this.config.grid.cellSize,this.maxBoidCount)}refreshRandomSeed(){this.randomSeed.remainingTicks--,this.randomSeed.remainingTicks>0||(this.randomSeed.value=Math.random(),this.randomSeed.remainingTicks=Math.floor(121*Math.random()))}getConfig(){return this.config}getCenterOwMass(){return this.spatialGrid.centerOwMass}resize(t,i){this.simBox=t,i&&(this.config.maxDepth=i)}start(t,i){t>this.maxBoidCount&&(this.maxBoidCount=t),this.boidConfig=i;for(let n=0;t>n;n++)this.spawnBoid(Math.random()*this.config.maxDepth);this.isRunning=1}boidCount(){return this.boids.length}addBoidsIfMissing(t){const i=this.maxBoidCount-this.boids.length;if(i>0){for(let n=0;Math.min(t,i)>n;n++)this.spawnBoid(this.config.maxDepth,1);return 1}return 0}removeBoids(t){if(this.boids.length<=t)return this.boids=[],void this.spatialGrid.clear();for(let i=0;t>i;i++){const t=this.boids.pop();t&&this.spatialGrid.remove(t)}}update(t,i){if(!this.isRunning)return;this.spatialGrid.maxItemCount=this.maxBoidCount,this.refreshRandomSeed();const n=.5>this.randomSeed.value?0:1,s=.25>this.randomSeed.value%.5?-1:1,e=Gi();e[n]=s*this.config.gravity;for(const r of this.boids){const n=this.spatialGrid.getNeighbors(r,this.config.grid.neighborDistance),s=this.spatialGrid.getNeighbors(r,this.config.grid.closeNeighborDistance);r.update(n,s,this.spatialGrid.cellRadius,this.spatialGrid.centerOwMass,t,i,this.config.visibleDistance,this.config.visibleDepth,this.randomSeed.value,e),this.spatialGrid.update(r)}}spawnBoid(t,i){let n;i&&(n=this.spatialGrid.getRandomCellCoords());const{startX:s,startY:e,width:r,height:o}=n||{startX:this.simBox.start.x-100,startY:this.simBox.start.y-20,width:this.simBox.width+100,height:this.simBox.height},h=Ki(s+r*(1.2*Math.random()-.1),e+o*(1.2*Math.random()-.1),t),l=new fn(this.nextDisplayId,h,this.boidConfig);this.nextDisplayId++,this.boids.push(l),this.spatialGrid.update(l)}stop(){this.isRunning=0,this.boids=[],this.maxBoidCount=0}}class pn{constructor(t,i,n={}){b(this,"renderer"),b(this,"flightZone"),b(this,"simulation"),b(this,"inputs"),b(this,"TARGET_TPS",30),b(this,"TARGET_TICK_TIME"),b(this,"tpsEstimator"),b(this,"debug",0),b(this,"isRunning",0),b(this,"simulationLoopId"),b(this,"renderingLoopId"),b(this,"renderingTasks",new Map),this.renderer=new ln(t,i,n),this.simulation=new dn(this.renderer.screenBox),this.flightZone=new on(this.renderer.canvasBox,this.simulation.getConfig().maxDepth),this.inputs={mouseStatus:new nn(i),polygonDrawer:new en(i)},this.TARGET_TICK_TIME=1e3/this.TARGET_TPS,this.tpsEstimator=new qi(this.TARGET_TPS)}start(t,i,n={}){this.debug=i,this.simulation.boidConfig=n,this.simulation.maxBoidCount=t,this.isRunning?this.simulation.boidConfig=n:(this.isRunning=1,this.simulation.start(Math.floor(.7*t),n),this.simulationLoop(),this.renderingLoop())}async simulationLoop(){if(!this.isRunning)return;const t=this.tpsEstimator.getPrevTime(),i=this.tpsEstimator.get()-this.TARGET_TPS;if(i>0){this.simulation.addBoidsIfMissing(100);const i=this.TARGET_TICK_TIME-(performance.now()-t);i>0&&await new Promise(t=>setTimeout(t,i))}else i>-8||this.simulation.removeBoids(5);const n=this.renderer.maxHeight;this.simulation.update(this.flightZone,n),this.tpsEstimator.update(),this.simulationLoopId=requestAnimationFrame(this.simulationLoop.bind(this))}async renderingLoop(){if(!this.isRunning)return;const t=this.renderer.checkResize();this.flightZone.resize(this.renderer.canvasBox),t&&this.simulation.resize(this.renderer.screenBox),this.flightZone.clearCentroids();const i=this.inputs.mouseStatus.getPositionOnCanvas();i&&this.flightZone.addCentroid(i);const n=this.tpsEstimator.get(),s=this.renderer.maxHeight;this.renderer.clearCanvas(),this.renderer.drawFlightZone(this.flightZone,this.simulation.getConfig().visibleDistance,this.debug),this.simulation.boids.forEach(t=>{this.renderer.drawBoid(t,this.simulation.getConfig().maxDepth)}),this.debug&&(this.renderer.drawHeight(s),this.renderer.drawCenterOwMass(this.simulation.getCenterOwMass()),this.renderer.drawStats(this.simulation.boidCount(),n,this.TARGET_TPS)),this.refreshRenderingTasks(),this.renderingLoopId=requestAnimationFrame(this.renderingLoop.bind(this))}refreshRenderingTasks(){var t;const{state:i,eTag:n}=this.inputs.polygonDrawer.getState();if(n!==(null==(t=this.renderingTasks.get("draftPolygon"))?void 0:t.eTag)){const t=this.inputs.polygonDrawer.getPolygonOnCanvas();let s;switch(i){case null:this.renderingTasks.set("draftPolygon",{eTag:n}),this.flightZone.resetPolygon();break;case"drawing":this.renderingTasks.set("draftPolygon",{eTag:n,render:()=>this.renderer.drawDraftPolygon(t,0)});break;case"failed":s=performance.now()+1510,this.renderingTasks.set("draftPolygon",{eTag:n,endTime:s,render:()=>this.renderer.drawDraftPolygon(t,0,"#ff0000",s-performance.now(),3)});break;case"closed":s=performance.now()+3010,this.renderingTasks.set("draftPolygon",{eTag:n,endTime:s,render:()=>this.renderer.drawDraftPolygon(t,1,void 0,s-performance.now()),endCallback:()=>{this.flightZone.setPolygon(t)}})}}this.renderingTasks.forEach((t,i)=>{var n;if(t.render)return t.endTime&&performance.now()>=t.endTime?(null==(n=t.endCallback)||n.call(t),void this.renderingTasks.set(i,{eTag:t.eTag})):void t.render()})}stop(){this.simulationLoopId&&(cancelAnimationFrame(this.simulationLoopId),this.simulationLoopId=void 0),this.renderingLoopId&&(cancelAnimationFrame(this.renderingLoopId),this.renderingLoopId=void 0),this.renderer.clearCanvas(),this.simulation.stop(),this.isRunning=0}}var wn=Di('<main class="svelte-uxr442"><canvas class="svelte-uxr442"></canvas></main>');!function(t,{target:i,anchor:n,props:s={},events:e,context:r,intro:o=1}){!function(){if(void 0===It){It=window,Bt=/Firefox/.test(navigator.userAgent);var t=Element.prototype,i=Node.prototype,n=Text.prototype;Lt=R(i,"firstChild").get,qt=R(i,"nextSibling").get,I(t)&&(t.h=void 0,t.M=void 0,t.k=null,t.C=void 0,t.T=void 0),I(n)&&(n.S=void 0)}}();var h=new Set,l=t=>{for(var n=0;n<t.length;n++){var s=t[n];if(!h.has(s)){h.add(s);var e=Ai(s);i.addEventListener(s,Fi,{passive:e});var r=ji.get(s);void 0===r?(document.addEventListener(s,Fi,{passive:e}),ji.set(s,1)):ji.set(s,r+1)}}};l(O(Ri)),Wi.add(l);var a=void 0,u=Ut(()=>{var o=null!=n?n:i.appendChild(function(t=""){return document.createTextNode(t)}());return function(t,i=1){Gt(32,t,1,i)}(()=>{r&&(et({}),nt.c=r),e&&(s.$$events=e),a=t(o,s)||{},r&&rt()}),()=>{var t;for(var s of h){i.removeEventListener(s,Fi);var e=ji.get(s);0===--e?(document.removeEventListener(s,Fi),ji.delete(s)):ji.set(s,e)}Wi.delete(l),o!==n&&(null==(t=o.parentNode)||t.removeChild(o))}});Ii.set(a,u)}(function(t,i){let n;et(i,0);let s=Rt(null),e=0;var r,o,h,l;r=()=>{n=new URLSearchParams(window.location.search),n.has("debug")&&(e=1),Ci(s)&&new pn(window,Ci(s)).start(5200,e,{})},null===nt&&function(){throw Error("https://svelte.dev/e/lifecycle_outside_component")}(),it&&null!==nt.l?(o=nt,l=o.l,null!=(h=l.u)?h:l.u={a:[],b:[],m:[]}).m.push(r):Ht(()=>{const t=Si(r);if("function"==typeof t)return t}),function(t=0){const i=nt,n=i.l.u;if(!n)return;let s=()=>function(t){if("object"==typeof t&&t&&!(t instanceof EventTarget))if($ in t)Ei(t);else if(!Array.isArray(t))for(let i in t){const n=t[i];"object"==typeof n&&n&&$ in n&&Ei(n)}}(i.s);if(t){let t=0,n={};const e=ft(()=>{let s=0;const e=i.s;for(const t in e)e[t]!==n[t]&&(n[t]=e[t],s=1);return s&&t++,t});s=()=>Ci(e)}var e;n.b.length&&(e=()=>{Li(i,s),L(n.b)},Zt(),Gt(1048584,e,1)),Ht(()=>{const t=Si(()=>n.m.map(B));return()=>{for(const i of t)"function"==typeof i&&i()}}),n.a.length&&Ht(()=>{Li(i,s),L(n.a)})}();var a,u,c=wn();(function(t={},i,n){var s;s=()=>{var s,e;return function(t,i=0){Gt(8|i,t,1)}(()=>{s=e,e=[],Si(()=>{t!==n(...e)&&(i(t,...e),s&&Bi(n(...s),t)&&i(null,...s))})}),()=>{var s;s=()=>{e&&Bi(n(...e),t)&&i(null,...e)},0===ut.length&&queueMicrotask(ct),ut.push(s)}},Gt(4,s,0)})(Nt(c),t=>Wt(s,t),()=>Ci(s)),u=c,null!==(a=t)&&a.before(u),rt()},{target:document.getElementById("app")});export{P as __vite_legacy_guard};
