var t,i,n,s,e,r,o,h,l,u,a,c,f,v,d,p,w,m,y,g=Object.defineProperty,M=t=>{throw TypeError(t)},b=(t,i,n)=>((t,i,n)=>i in t?g(t,i,{enumerable:1,configurable:1,writable:1,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n),x=(t,i,n)=>i.has(t)||M("Cannot "+n),C=(t,i,n)=>(x(t,i,"read from private field"),n?n.call(t):i.get(t)),k=(t,i,n)=>i.has(t)?M("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,n),S=(t,i,n,s)=>(x(t,i,"write to private field"),s?s.call(t,n):i.set(t,n),n),T=(t,i,n)=>(x(t,i,"access private method"),n);function _(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)}).observe(document,{childList:1,subtree:1})}function i(t){if(t.ep)return;t.ep=1;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?i.credentials="include":"anonymous"===t.crossOrigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();var E=Array.isArray,P=[].indexOf,A=Array.from,O=Object.defineProperty,R=Object.getOwnPropertyDescriptor,W=Object.getOwnPropertyDescriptors,F=Object.prototype,j=Array.prototype,D=Object.getPrototypeOf,B=Object.isExtensible;function I(t){return t()}function q(t){for(var i=0;i<t.length;i++)t[i]()}const L=256,z=1024,N=2048,H=4096,Z=8192,K=16384,G=32768,X=1<<19,Y=1<<21,U=1<<23,$=Symbol("$state"),V=new class extends Error{constructor(){super(...arguments),b(this,"name","StaleReactionError"),b(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}},J=Symbol();function Q(t){return t===this.v}function tt(t){return i=t,n=this.v,!(i!=i?n==n:i!==n||null!==i&&"object"==typeof i||"function"==typeof i);var i,n}let it=0,nt=null;function st(t){nt=t}function et(t,i=0,n){nt={p:nt,c:null,e:null,s:t,x:null,l:it&&!i?{s:null,u:null,$:[]}:null}}function rt(t){var i=nt,n=i.e;if(null!==n)for(var s of(i.e=null,n))Yt(s);return nt=i.p,{}}function ot(){return!it||null!==nt&&null===nt.l}const ht=new WeakMap;function lt(t,i){for(;null!==i;){if(128&i.f)try{return void i.b.error(t)}catch(n){t=n}i=i.parent}throw t instanceof Error&&ut(t),t}function ut(t){const i=ht.get(t);i&&(O(t,"message",{value:i.message}),O(t,"stack",{value:i.stack}))}let at=[];function ct(){var t=at;at=[],q(t)}function ft(t){var i=2050,n=null!==ri&&2&ri.f?ri:null;return null===li||null!==n&&0!==(n.f&L)?i|=L:li.f|=X,{ctx:nt,deps:null,effects:null,equals:Q,f:i,fn:t,reactions:null,rv:0,v:J,wv:0,parent:null!=n?n:li,ac:null}}function vt(t){var i=t.effects;if(null!==i){t.effects=null;for(var n=0;n<i.length;n+=1)Jt(i[n])}}function dt(t){var i,n=li;ui(function(t){for(var i=t.parent;null!==i;){if(!(2&i.f))return i;i=i.parent}return null}(t));try{vt(t),i=xi(t)}finally{ui(n)}return i}function pt(t){var i=dt(t);t.equals(i)||(t.v=i,t.wv=gi()),si||(null!==yt?yt.set(t,t.v):Ai(t,!yi&&0===(t.f&L)||null===t.deps?z:H))}const wt=new Set;let mt=null,yt=null,gt=new Set,Mt=[];function bt(){const t=Mt.shift();Mt.length>0&&queueMicrotask(bt),t()}let xt=[],Ct=null,kt=0;t=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,e=new WeakMap,r=new WeakMap,o=new WeakMap,h=new WeakMap,l=new WeakMap,u=new WeakMap,a=new WeakMap,c=new WeakMap,f=new WeakSet,v=function(t){var i;t.f^=z;for(var n=t.first;null!==n;){var s=n.f,e=!!(96&s);if(!(e&&0!==(s&z)||0!==(s&Z)||this.skipped_effects.has(n))&&null!==n.fn){e?n.f^=z:4&s?C(this,l).push(n):0===(s&z)&&(4194304&s?((null==(i=n.b)?void 0:i.pending)?C(this,o):C(this,r)).push(n):Mi(n)&&(16&n.f&&C(this,u).push(n),Si(n)));var h=n.first;if(null!==h){n=h;continue}}var a=n.parent;for(n=n.next;null===n&&null!==a;)n=a.next,a=a.parent}},d=function(t){for(const i of t)(0!==(i.f&N)?C(this,a):C(this,c)).push(i),Ai(i,z);t.length=0},p=function(){if(!C(this,e))for(const t of C(this,i))t();C(this,i).clear()};let St=class w{constructor(){k(this,f),b(this,"current",new Map),k(this,t,new Map),k(this,i,new Set),k(this,n,0),k(this,s,null),k(this,e,0),k(this,r,[]),k(this,o,[]),k(this,h,[]),k(this,l,[]),k(this,u,[]),k(this,a,[]),k(this,c,[]),b(this,"skipped_effects",new Set)}process(i){var e;xt=[];var a=null;if(wt.size>1){a=new Map,yt=new Map;for(const[t,i]of this.current)a.set(t,{v:t.v,wv:t.wv}),t.v=i;for(const i of wt)if(i!==this)for(const[n,s]of C(i,t))a.has(n)||(a.set(n,{v:n.v,wv:n.wv}),n.v=s)}for(const t of i)T(this,f,v).call(this,t);if(0===C(this,r).length&&0===C(this,n)){T(this,f,p).call(this);var c=C(this,h),w=C(this,l);S(this,h,[]),S(this,l,[]),S(this,u,[]),mt=null,Et(c),Et(w),null===mt?mt=this:wt.delete(this),null==(e=C(this,s))||e.resolve()}else T(this,f,d).call(this,C(this,h)),T(this,f,d).call(this,C(this,l)),T(this,f,d).call(this,C(this,u));if(a){for(const[t,{v:i,wv:n}]of a)t.wv>n||(t.v=i);yt=null}for(const t of C(this,r))Si(t);for(const t of C(this,o))Si(t);S(this,r,[]),S(this,o,[])}capture(i,n){C(this,t).has(i)||C(this,t).set(i,n),this.current.set(i,i.v)}activate(){mt=this}deactivate(){mt=null;for(const t of gt)if(gt.delete(t),t(),null!==mt)break}neuter(){S(this,e,1)}flush(){xt.length>0?function(){var t=ii;kt=1;try{var i=0;for(ni(1);xt.length>0;){var n=St.ensure();i++>1e3&&Tt(),n.process(xt),At.clear()}}finally{kt=0,ni(t),Ct=null}}():T(this,f,p).call(this),mt===this&&(0===C(this,n)&&wt.delete(this),this.deactivate())}increment(){S(this,n,C(this,n)+1)}decrement(){if(S(this,n,C(this,n)-1),0===C(this,n)){for(const t of C(this,a))Ai(t,N),Pt(t);for(const t of C(this,c))Ai(t,H),Pt(t);S(this,h,[]),S(this,l,[]),this.flush()}else this.deactivate()}add_callback(t){C(this,i).add(t)}settled(){var t,i,n;return(null!=(t=C(this,s))?t:S(this,s,{promise:new Promise((t,s)=>{i=t,n=s}),resolve:i,reject:n})).promise}static ensure(){if(null===mt){const t=mt=new w;wt.add(mt),w.enqueue(()=>{mt===t&&t.flush()})}return mt}static enqueue(t){0===Mt.length&&queueMicrotask(bt),Mt.unshift(t)}};function Tt(){try{!function(){throw Error("https://svelte.dev/e/effect_update_depth_exceeded")}()}catch(t){lt(t,Ct)}}let _t=null;function Et(t){var i=t.length;if(0!==i){for(var n=0;i>n;){var s=t[n++];if(!(24576&s.f)&&Mi(s)&&(_t=[],Si(s),null===s.deps&&null===s.first&&null===s.nodes_start&&(null===s.teardown&&null===s.ac?Qt(s):s.fn=null),_t.length>0)){At.clear();for(const t of _t)Si(t);_t=[]}}_t=null}}function Pt(t){for(var i=Ct=t;null!==i.parent;){var n=(i=i.parent).f;if(kt&&i===li&&16&n)return;if(96&n){if(0===(n&z))return;i.f^=z}}xt.push(i)}const At=new Map;function Ot(t,i){return{f:0,v:t,reactions:null,equals:Q,rv:0,wv:0}}function Rt(t,i){const n=Ot(t);var s;return s=n,null!==ri&&(null===ai?ai=[s]:ai.push(s)),n}function Wt(t,i=0,n=1){var s,e;const r=Ot(t);return i||(r.equals=tt),it&&n&&null!==nt&&null!==nt.l&&(null!=(e=(s=nt.l).s)?e:s.s=[]).push(r),r}function Ft(t,i,n=0){return null!==ri&&(!oi||!!(131072&ri.f))&&ot()&&4325394&ri.f&&!(null==ai?void 0:ai.includes(t))&&function(){throw Error("https://svelte.dev/e/state_unsafe_mutation")}(),function(t,i){if(!t.equals(i)){var n=t.v;si?At.set(t,i):At.set(t,n),t.v=i,St.ensure().capture(t,n),2&t.f&&(0!==(t.f&N)&&dt(t),Ai(t,0===(t.f&L)?z:H)),t.wv=gi(),Dt(t,N),!ot()||null===li||0===(li.f&z)||96&li.f||(null===vi?function(t){vi=t}([t]):vi.push(t))}return i}(t,n?Bt(i):i)}function jt(t){Ft(t,t.v+1)}function Dt(t,i){var n=t.reactions;if(null!==n)for(var s=ot(),e=n.length,r=0;e>r;r++){var o=n[r],h=o.f;if(s||o!==li){var l=0===(h&N);l&&Ai(o,i),2&h?Dt(o,H):l&&(16&h&&null!==_t&&_t.push(o),Pt(o))}}}function Bt(t){if("object"!=typeof t||null===t||$ in t)return t;const i=D(t);if(i!==F&&i!==j)return t;var n=new Map,s=E(t),e=Rt(0),r=wi,o=t=>{if(wi===r)return t();var i=ri,n=wi;hi(null),mi(r);var s=t();return hi(i),mi(n),s};return s&&n.set("length",Rt(t.length)),new Proxy(t,{defineProperty(t,i,s){"value"in s&&0!=s.configurable&&0!=s.enumerable&&0!=s.writable||function(){throw Error("https://svelte.dev/e/state_descriptors_fixed")}();var e=n.get(i);return void 0===e?e=o(()=>{var t=Rt(s.value);return n.set(i,t),t}):Ft(e,s.value,1),1},deleteProperty(t,i){var s=n.get(i);if(void 0===s){if(i in t){const t=o(()=>Rt(J));n.set(i,t),jt(e)}}else Ft(s,J),jt(e);return 1},get(i,s,e){var r;if(s===$)return t;var h=n.get(s),l=s in i;if(void 0!==h||l&&!(null==(r=R(i,s))?void 0:r.writable)||(h=o(()=>Rt(Bt(l?i[s]:J))),n.set(s,h)),void 0!==h){var u=Ti(h);return u===J?void 0:u}return Reflect.get(i,s,e)},getOwnPropertyDescriptor(t,i){var s=Reflect.getOwnPropertyDescriptor(t,i);if(s&&"value"in s){var e=n.get(i);e&&(s.value=Ti(e))}else if(void 0===s){var r=n.get(i),o=null==r?void 0:r.v;if(void 0!==r&&o!==J)return{enumerable:1,configurable:1,value:o,writable:1}}return s},has(t,i){var s;if(i===$)return 1;var e=n.get(i),r=void 0!==e&&e.v!==J||Reflect.has(t,i);return void 0===e&&(null===li||r&&!(null==(s=R(t,i))?void 0:s.writable))||(void 0===e&&(e=o(()=>Rt(r?Bt(t[i]):J)),n.set(i,e)),Ti(e)!==J)?r:0},set(t,i,r,h){var l,u=n.get(i),a=i in t;if(s&&"length"===i)for(var c=r;c<u.v;c+=1){var f=n.get(c+"");void 0!==f?Ft(f,J):c in t&&(f=o(()=>Rt(J)),n.set(c+"",f))}void 0===u?a&&!(null==(l=R(t,i))?void 0:l.writable)||(Ft(u=o(()=>Rt(void 0)),Bt(r)),n.set(i,u)):(a=u.v!==J,Ft(u,o(()=>Bt(r))));var v=Reflect.getOwnPropertyDescriptor(t,i);if((null==v?void 0:v.set)&&v.set.call(h,r),!a){if(s&&"string"==typeof i){var d=n.get("length"),p=+i;Number.isInteger(p)&&p>=d.v&&Ft(d,p+1)}jt(e)}return 1},ownKeys(t){Ti(e);var i=Reflect.ownKeys(t).filter(t=>{var i=n.get(t);return void 0===i||i.v!==J});for(var[s,r]of n)r.v===J||s in t||i.push(s);return i},setPrototypeOf(){!function(){throw Error("https://svelte.dev/e/state_prototype_fixed")}()}})}var It,qt,Lt,zt;function Nt(t){return Lt.call(t)}function Ht(t){return zt.call(t)}function Zt(t){var i=ri,n=li;hi(null),ui(null);try{return t()}finally{hi(i),ui(n)}}function Kt(t){null===li&&null===ri&&function(){throw Error("https://svelte.dev/e/effect_orphan")}(),null!==ri&&0!==(ri.f&L)&&null===li&&function(){throw Error("https://svelte.dev/e/effect_in_unowned_derived")}(),si&&function(){throw Error("https://svelte.dev/e/effect_in_teardown")}()}function Gt(t,i,n,s=1){var e,r=li;null!==r&&0!==(r.f&Z)&&(t|=Z);var o={ctx:nt,deps:null,nodes_start:null,nodes_end:null,f:t|N,first:null,fn:i,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{Si(o),o.f|=G}catch(l){throw Jt(o),l}else null!==i&&Pt(o);if((!n||null!==o.deps||null!==o.first||null!==o.nodes_start||null!==o.teardown||0!==(o.f&X))&&s&&(null!==r&&function(t,i){var n=i.last;null===n?i.last=i.first=t:(n.next=t,t.prev=n,i.last=t)}(o,r),null!==ri&&2&ri.f&&!(64&t))){var h=ri;(null!=(e=h.effects)?e:h.effects=[]).push(o)}return o}function Xt(t){var i;Kt();var n=li.f;if(ri||!(32&n)||0!==(n&G))return Yt(t);var s=nt;(null!=(i=s.e)?i:s.e=[]).push(t)}function Yt(t){return Gt(1048580,t,0)}function Ut(t){St.ensure();const i=Gt(64,t,1);return(t={})=>new Promise(n=>{t.outro?function(t,i){var n=[];ti(t,n,1),function(t,i){var n=t.length;if(n>0){var s=()=>--n||i();for(var e of t)e.out(s)}else i()}(n,()=>{Jt(t),i&&i()})}(i,()=>{Jt(i),n(void 0)}):(Jt(i),n(void 0))})}function $t(t){var i=t.teardown;if(null!==i){const t=si,n=ri;ei(1),hi(null);try{i.call(null)}finally{ei(t),hi(n)}}}function Vt(t,i=0){var n=t.first;for(t.first=t.last=null;null!==n;){const t=n.ac;null!==t&&Zt(()=>{t.abort(V)});var s=n.next;64&n.f?n.parent=null:Jt(n,i),n=s}}function Jt(t,i=1){var n=0;(i||262144&t.f)&&null!==t.nodes_start&&null!==t.nodes_end&&(function(t,i){for(;null!==t;){var n=t===i?null:Ht(t);t.remove(),t=n}}(t.nodes_start,t.nodes_end),n=1),Vt(t,i&&!n),ki(t,0),Ai(t,K);var s=t.transitions;if(null!==s)for(const r of s)r.stop();$t(t);var e=t.parent;null!==e&&null!==e.first&&Qt(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function Qt(t){var i=t.parent,n=t.prev,s=t.next;null!==n&&(n.next=s),null!==s&&(s.prev=n),null!==i&&(i.first===t&&(i.first=s),i.last===t&&(i.last=n))}function ti(t,i,n){if(0===(t.f&Z)){if(t.f^=Z,null!==t.transitions)for(const s of t.transitions)(s.is_global||n)&&i.push(s);for(var s=t.first;null!==s;){var e=s.next;ti(s,i,65536&s.f||32&s.f?n:0),s=e}}}let ii=0;function ni(t){ii=t}let si=0;function ei(t){si=t}let ri=null,oi=0;function hi(t){ri=t}let li=null;function ui(t){li=t}let ai=null,ci=null,fi=0,vi=null,di=1,pi=0,wi=pi;function mi(t){wi=t}let yi=0;function gi(){return++di}function Mi(t){var i,n,s=t.f;if(0!==(s&N))return 1;if(0!==(s&H)){var e=t.deps,r=0!==(s&L);if(null!==e){var o,h,l=!!(512&s),u=r&&null!==li&&!yi,a=e.length;if((l||u)&&(null===li||0===(li.f&K))){var c=t,f=c.parent;for(o=0;a>o;o++)h=e[o],!l&&(null==(i=null==h?void 0:h.reactions)?void 0:i.includes(c))||(null!=(n=h.reactions)?n:h.reactions=[]).push(c);l&&(c.f^=512),u&&null!==f&&0===(f.f&L)&&(c.f^=L)}for(o=0;a>o;o++)if(Mi(h=e[o])&&pt(h),h.wv>t.wv)return 1}r&&(null===li||yi)||Ai(t,z)}return 0}function bi(t,i,n=1){var s=t.reactions;if(null!==s&&!(null==ai?void 0:ai.includes(t)))for(var e=0;e<s.length;e++){var r=s[e];2&r.f?bi(r,i,0):i===r&&(n?Ai(r,N):0!==(r.f&z)&&Ai(r,H),Pt(r))}}function xi(t){var i,n,s=ci,e=fi,r=vi,o=ri,h=yi,l=ai,u=nt,a=oi,c=wi,f=t.f;ci=null,fi=0,vi=null,yi=0!==(f&L)&&(oi||!ii||null===ri),ri=96&f?null:t,ai=null,st(t.ctx),oi=0,wi=++pi,null!==t.ac&&(Zt(()=>{t.ac.abort(V)}),t.ac=null);try{t.f|=Y;var v=(0,t.fn)(),d=t.deps;if(null!==ci){var p;if(ki(t,fi),null!==d&&fi>0)for(d.length=fi+ci.length,p=0;p<ci.length;p++)d[fi+p]=ci[p];else t.deps=d=ci;if(!yi||2&f&&null!==t.reactions)for(p=fi;p<d.length;p++)(null!=(n=(i=d[p]).reactions)?n:i.reactions=[]).push(t)}else null!==d&&fi<d.length&&(ki(t,fi),d.length=fi);if(ot()&&null!==vi&&!oi&&null!==d&&!(6146&t.f))for(p=0;p<vi.length;p++)bi(vi[p],t);return null!==o&&o!==t&&(pi++,null!==vi&&(null===r?r=vi:r.push(...vi))),0!==(t.f&U)&&(t.f^=U),v}catch(w){return function(t){var i=li;if(null===i)return ri.f|=U,t;if(0===(i.f&G)){if(!(128&i.f))throw!i.parent&&t instanceof Error&&ut(t),t;i.b.error(t)}else lt(t,i)}(w)}finally{t.f^=Y,ci=s,fi=e,vi=r,ri=o,yi=h,ai=l,st(u),oi=a,wi=c}}function Ci(t,i){let n=i.reactions;if(null!==n){var s=P.call(n,t);if(-1!==s){var e=n.length-1;0===e?n=i.reactions=null:(n[s]=n[e],n.pop())}}null===n&&2&i.f&&(null===ci||!ci.includes(i))&&(Ai(i,H),768&i.f||(i.f^=512),vt(i),ki(i,0))}function ki(t,i){var n=t.deps;if(null!==n)for(var s=i;s<n.length;s++)Ci(t,n[s])}function Si(t){var i=t.f;if(0===(i&K)){Ai(t,z);var n=li,s=ii;li=t,ii=1;try{16&i?function(t){for(var i=t.first;null!==i;){var n=i.next;!(32&i.f)&&Jt(i),i=n}}(t):Vt(t),$t(t);var e=xi(t);t.teardown="function"==typeof e?e:null,t.wv=di}finally{ii=s,li=n}}}function Ti(t){var i,n=!!(2&t.f);if(null===ri||oi){if(n&&null===t.deps&&null===t.effects){var s=t,e=s.parent;null!==e&&0===(e.f&L)&&(s.f^=L)}}else if((null===li||0===(li.f&K))&&!(null==ai?void 0:ai.includes(t))){var r=ri.deps;if(0!==(ri.f&Y))t.rv<pi&&(t.rv=pi,null===ci&&null!==r&&r[fi]===t?fi++:null===ci?ci=[t]:yi&&ci.includes(t)||ci.push(t));else{(null!=(i=ri.deps)?i:ri.deps=[]).push(t);var o=t.reactions;null===o?t.reactions=[ri]:o.includes(ri)||o.push(ri)}}if(si){if(At.has(t))return At.get(t);if(n){var h=(s=t).v;return(0===(s.f&z)&&null!==s.reactions||_i(s))&&(h=dt(s)),At.set(s,h),h}}else if(n){if(s=t,null==yt?void 0:yt.has(s))return yt.get(s);Mi(s)&&pt(s)}if(0!==(t.f&U))throw t.v;return t.v}function _i(t){if(t.v===J)return 1;if(null===t.deps)return 0;for(const i of t.deps){if(At.has(i))return 1;if(2&i.f&&_i(i))return 1}return 0}function Ei(t){var i=oi;try{return oi=1,t()}finally{oi=i}}const Pi=-7169;function Ai(t,i){t.f=t.f&Pi|i}function Oi(t,i=new Set){if(!("object"!=typeof t||null===t||t instanceof EventTarget||i.has(t))){i.add(t),t instanceof Date&&t.getTime();for(let e in t)try{Oi(t[e],i)}catch(n){}const s=D(t);if(s!==Object.prototype&&s!==Array.prototype&&s!==Map.prototype&&s!==Set.prototype&&s!==Date.prototype){const i=W(s);for(let s in i){const e=i[s].get;if(e)try{e.call(t)}catch(n){}}}}}const Ri=["touchstart","touchmove"];function Wi(t){return Ri.includes(t)}const Fi=new Set,ji=new Set;let Di=null;function Bi(t){var i,n=this,s=n.ownerDocument,e=t.type,r=(null==(i=t.composedPath)?void 0:i.call(t))||[],o=r[0]||t.target;Di=t;var h=0,l=Di===t&&t.t;if(l){var u=r.indexOf(l);if(-1!==u&&(n===document||n===window))return void(t.t=n);var a=r.indexOf(n);if(-1===a)return;u>a||(h=u)}if((o=r[h]||t.target)!==n){O(t,"currentTarget",{configurable:1,get:()=>o||s});var c=ri,f=li;hi(null),ui(null);try{for(var v,d=[];null!==o;){var p=o.assignedSlot||o.parentNode||o.host||null;try{var w=o["__"+e];if(null!=w&&(!o.disabled||t.target===o))if(E(w)){var[m,...y]=w;m.call(o,t,...y)}else w.call(o,t)}catch(g){v?d.push(g):v=g}if(t.cancelBubble||p===n||null===p)break;o=p}if(v){for(let t of d)queueMicrotask(()=>{throw t});throw v}}finally{t.t=n,delete t.currentTarget,hi(c),ui(f)}}}function Ii(t,i){var n,s=!!(2&i),e=!t.startsWith("<!>");return()=>{var i,r;void 0===n&&(i=e?t:"<!>"+t,(r=document.createElement("template")).innerHTML=i.replaceAll("<!>","\x3c!----\x3e"),n=Nt(n=r.content));var o,h,l,u=s||qt?document.importNode(n,1):n.cloneNode(1);return o=u,h=u,null===(l=li).nodes_start&&(l.nodes_start=o,l.nodes_end=h),u}}const qi=new Map;let Li=new WeakMap;function zi(t,i){return t===i||(null==t?void 0:t[$])===i}function Ni(t,i){if(t.l.s)for(const n of t.l.s)Ti(n);i()}"undefined"!=typeof window&&(null!=(y=(m=null!=(w=window.__svelte)?w:window.__svelte={}).v)?y:m.v=new Set).add("5"),it=1;class Hi{constructor(t){b(this,"prevFrequency"),b(this,"prevTime"),b(this,"alpha",.025),this.prevFrequency=t,this.prevTime=performance.now()}get(){return this.prevFrequency}getPrevTime(){return this.prevTime}update(){const t=performance.now(),i=1e3/(t-this.prevTime||1);this.prevFrequency=this.prevFrequency*(1-this.alpha)+this.alpha*i,this.prevTime=t}}var Zi,Ki="undefined"!=typeof Float32Array?Float32Array:Array,Gi=Math.random;function Xi(){var t=new Ki(3);return Ki!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Yi(t){var i=t[0],n=t[1],s=t[2];return Math.sqrt(i*i+n*n+s*s)}function Ui(t,i,n){var s=new Ki(3);return s[0]=t,s[1]=i,s[2]=n,s}function $i(t,i){return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function Vi(t,i,n){return t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function Ji(t,i,n){return t[0]=i[0]-n[0],t[1]=i[1]-n[1],t[2]=i[2]-n[2],t}function Qi(t,i,n){return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t}function tn(t,i,n,s){return t[0]=i[0]+n[0]*s,t[1]=i[1]+n[1]*s,t[2]=i[2]+n[2]*s,t}function nn(t,i){var n=i[0],s=i[1],e=i[2],r=n*n+s*s+e*e;return r>0&&(r=1/Math.sqrt(r)),t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t}function sn(t,i){i=void 0===i?1:i;var n=2*Gi()*Math.PI,s=2*Gi()-1,e=Math.sqrt(1-s*s)*i;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t[2]=s*i,t}Xi(),Zi=new Ki(2),Ki!=Float32Array&&(Zi[0]=0,Zi[1]=0);class en{constructor(t){b(this,"canvas"),b(this,"positionOnCanvas"),b(this,"isPressed",0),b(this,"isMouseOver",1),this.canvas=t,this.canvas.tabIndex=0,this.setupListeners(t)}isMousePressed(){return this.isPressed&&this.isMouseOver}isMouseFocused(){return this.isMouseOver}getPositionOnCanvas(){if(this.isMouseFocused()&&this.positionOnCanvas)return this.positionOnCanvas}setupListeners(t){t.addEventListener("focus",()=>{this.isMouseOver=1}),t.addEventListener("mouseenter",()=>{this.isMouseOver=1}),t.addEventListener("mouseover",()=>{this.isMouseOver=1}),t.addEventListener("mouseleave",()=>{this.isMouseOver=0,this.isPressed=0,this.positionOnCanvas=void 0}),t.addEventListener("mousemove",t=>{this.isMouseOver=1;const i=(n=t.clientX,s=t.clientY,(e=new Ki(2))[0]=n,e[1]=s,e);var n,s,e;this.positionOnCanvas=i}),t.addEventListener("mousedown",()=>{this.isPressed=1}),t.addEventListener("mouseup",()=>{this.isPressed=0})}}class rn{constructor(t,i,n,s){b(this,"start"),b(this,"end"),b(this,"width"),b(this,"height"),this.start={x:t,y:i},this.end={x:t+n,y:i+s},this.width=n,this.height=s}equals(t){return this.start.x===t.start.x&&this.start.y===t.start.y&&this.width===t.width&&this.height===t.height}}class on{constructor(t,i,n=.15){b(this,"canvasBox"),b(this,"paddingRatio"),b(this,"maxDepth"),b(this,"halfDepth"),b(this,"polygon"),b(this,"centroids"),this.canvasBox=t,this.paddingRatio=n,this.maxDepth=i,this.halfDepth=i/2,this.polygon=this.defaultPolygon(),this.centroids=[]}defaultPolygon(){const t=Math.min(this.canvasBox.width*this.paddingRatio,this.canvasBox.height*this.paddingRatio);return[Ui(this.canvasBox.start.x+t,this.canvasBox.start.y+t,this.halfDepth),Ui(this.canvasBox.end.x-t,this.canvasBox.start.y+t,this.halfDepth),Ui(this.canvasBox.end.x-t,this.canvasBox.end.y-t,this.halfDepth),Ui(this.canvasBox.start.x+t,this.canvasBox.end.y-t,this.halfDepth)]}getPolygon(){return this.polygon}setPolygon(t){this.polygon=t.map(t=>Ui(t[0]+this.canvasBox.start.x,t[1]+this.canvasBox.start.y,this.halfDepth))}resetPolygon(){this.polygon=this.defaultPolygon()}getCentroids(){return this.centroids}addCentroid(t){const i=Ui(t[0]+this.canvasBox.start.x,t[1]+this.canvasBox.start.y,this.halfDepth);this.centroids.push(i)}clearCentroids(){this.centroids.length=0}isOutside(t){const i=t[2];return i>this.maxDepth||0>i||!function(t,i){if(3>i.length)return 0;let n=0;const s=t[0],e=t[1];for(let r=0,o=i.length-1;r<i.length;o=r++){const t=i[r][0],h=i[r][1],l=i[o][0],u=i[o][1],a=u-h;if(0!==a){if(e>=h==u>e&&e!==u){const i=(l-t)*(e-h)/a+t;if(s===i)return 0;i>s&&(n=!n)}}else if(s>=t==l>s&&h===e)return 0}return n}(t,this.polygon)}resize(t){if(this.canvasBox.equals(t))return;const i=t.width===this.canvasBox.width?1:t.width/this.canvasBox.width,n=t.height===this.canvasBox.height?1:t.height/this.canvasBox.height;for(const s of this.polygon)s[0]=(s[0]-this.canvasBox.start.x)*i+t.start.x,s[1]=(s[1]-this.canvasBox.start.y)*n+t.start.y;for(const s of this.centroids)s[0]=(s[0]-this.canvasBox.start.x)*i+t.start.x,s[1]=(s[1]-this.canvasBox.start.y)*n+t.start.y;this.canvasBox=t}}const hn={clearCanvasIfResized:1,boids:{lineWidth:.1,sizeScreenHeightRatio:.003},flightZone:{polygonColor:"#888888"},debug:{flightZone:{polygonColor:"#888888",centroidsColor:"#0000ff"},centerOwMassColor:"#ffff00",maxHeightColor:"#ff0000"}};class ln{constructor(t,i,n={}){b(this,"window"),b(this,"canvas"),b(this,"renderingContext"),b(this,"config"),b(this,"screenBox"),b(this,"canvasBox"),b(this,"maxHeight"),b(this,"devicePixelRatio"),b(this,"screenHasTopLeft",0),b(this,"patternCache",{}),this.window=t,this.canvas=i;const s=i.getContext("2d");if(!s)throw Error("Canvas context not available");this.renderingContext=s,this.config={...hn,...n},this.screenBox=this.getScreenBox(),this.canvasBox=this.getCanvasBox(),this.devicePixelRatio=this.window.devicePixelRatio||1,this.maxHeight=this.getMaxHeight(),this.scaleCanvas()}getMaxHeight(){return this.screenHasTopLeft?this.screenBox.end.y-20:Math.max(this.canvasBox.end.y,this.screenBox.end.y)-20}checkResize(){this.screenBox=this.getScreenBox();const t=this.window.devicePixelRatio||1,i=this.getCanvasBox();return this.canvasBox.equals(i)&&this.devicePixelRatio===t?0:(this.config.clearCanvasIfResized&&this.clearCanvas(),this.devicePixelRatio=t,this.canvasBox=i,this.maxHeight=this.getMaxHeight(),this.scaleCanvas(),1)}getScreenBox(){let t=0,i=0;return"left"in this.window.screen&&"top"in this.window.screen&&"number"==typeof this.window.screen.left&&"number"==typeof this.window.screen.top?(this.screenHasTopLeft=1,t=this.window.screen.left,i=this.window.screen.top):this.screenHasTopLeft=0,new rn(t,i,this.window.screen.width,this.window.screen.height)}getCanvasBox(){const t=this.canvas.getBoundingClientRect();return new rn(this.window.screenX+(this.window.outerWidth-this.window.innerWidth)+t.left,this.window.screenY+(this.window.outerHeight-this.window.innerHeight)+t.top,t.width,t.height)}scaleCanvas(){const t=this.renderingContext,i=this.canvas.clientWidth,n=this.canvas.clientHeight;this.canvas.width=i*this.devicePixelRatio,this.canvas.height=n*this.devicePixelRatio,t.scale(this.devicePixelRatio,this.devicePixelRatio)}clearCanvas(){const t=this.renderingContext;t.canvas.width=t.canvas.width,t.scale(this.devicePixelRatio,this.devicePixelRatio)}drawStats(t,i,n){const s=this.renderingContext;s.save(),s.font="10px monospace",s.fillStyle="#888888",s.fillText("Boids: ".concat(t),16,24),s.fillText("TPS:   ".concat(Math.round(i)," ~ ").concat(n),16,40),s.restore()}drawHeight(t){const i=this.renderingContext;i.save();const n=t-this.canvasBox.start.y;i.strokeStyle=this.config.debug.maxHeightColor,i.lineWidth=1,i.beginPath(),i.moveTo(0,n),i.lineTo(this.canvasBox.width,n),i.stroke(),i.restore()}drawCenterOwMass(t){const i=this.renderingContext;i.save();const n=t[0]-this.canvasBox.start.x,s=t[1]-this.canvasBox.start.y;i.lineWidth=1,i.strokeStyle=this.config.debug.centerOwMassColor,i.setLineDash([]),i.beginPath(),i.moveTo(n-5,s-5),i.lineTo(n+5,s+5),i.moveTo(n+5,s-5),i.lineTo(n-5,s+5),i.stroke(),i.restore()}drawFlightZone(t,i,n){if(!n)return;const s=this.canvasBox.start.x,e=this.canvasBox.start.y,r=t.getPolygon(),o=t.getCentroids(),h=(n?this.config.debug.flightZone.polygonColor:this.config.flightZone.polygonColor)+"0d",l=this.renderingContext;l.save(),l.fillStyle=h,l.beginPath(),l.moveTo(r[0][0]-s,r[0][1]-e);for(let u=1;u<r.length;u++)l.lineTo(r[u][0]-s,r[u][1]-e);l.closePath(),l.fill("evenodd"),l.restore(),l.save(),l.strokeStyle=this.config.debug.flightZone.centroidsColor;for(const u of o){const t=u[0]-s,n=u[1]-e,r=10;l.setLineDash([]),l.beginPath(),l.moveTo(t-r,n),l.lineTo(t+r,n),l.moveTo(t,n-r),l.lineTo(t,n+r),l.stroke(),l.setLineDash([4,6]),l.beginPath(),l.arc(t,n,i,0,2*Math.PI),l.stroke()}l.restore()}drawDraftPolygon(t,i,n,s,e=1){if(0===t.length)return;const r=this.renderingContext;r.save();const o=n||"#888888";if(null!=s){const t=s/500*e%2;r.globalAlpha=t>1?2-t:t}r.lineWidth=1,r.strokeStyle=o;let h=t[0][0]-0,l=t[0][1]-0;r.beginPath(),r.arc(h,l,10,0,2*Math.PI),r.stroke(),r.beginPath(),r.moveTo(h-5,l),r.lineTo(h+5,l),r.moveTo(h,l-5),r.lineTo(h,l+5),r.stroke();let u=this.patternCache.DraftPolygonFillStyle;u||(u=function(t,i=8){const n=document.createElement("canvas");n.width=n.height=i;const s=n.getContext("2d");if(!s)throw Error("Canvas context not available");s.strokeStyle=t,s.lineWidth=1,s.beginPath(),s.moveTo(i,0),s.lineTo(0,i),s.stroke();const e=s.createPattern(n,"repeat");if(!e)throw Error("Failed to create pattern");return e}(o+"33",8),this.patternCache.DraftPolygonFillStyle=u),r.fillStyle=u,r.setLineDash([4,4]),r.beginPath(),r.moveTo(h,l);for(let a=1;a<t.length;a++)h=t[a][0]-0,l=t[a][1]-0,r.lineTo(h,l);i&&(r.closePath(),r.fill("evenodd")),r.stroke(),r.setLineDash([]),r.beginPath(),r.moveTo(h,l);for(let a=1;a<t.length;a++)h=t[a][0]-0,l=t[a][1]-0,r.moveTo(h-5,l),r.lineTo(h+5,l),r.moveTo(h,l-5),r.lineTo(h,l+5);r.stroke(),r.restore()}drawBoid(t,i){const n=t.getPosition(),s=t.getVelocity(),e=this.canvasBox.start.x,r=this.canvasBox.start.y,o=1.2-Math.max(.2,Math.min(1.2,n[2]/i)),h=this.config.boids.sizeScreenHeightRatio*this.screenBox.height+2*o-1,l=this.renderingContext;l.save(),l.lineWidth=this.config.boids.lineWidth,l.strokeStyle="hsl(10, 10%, ".concat(80*o+20,"%)"),l.beginPath(),l.translate(n[0]-e,n[1]-r),l.rotate(Math.atan2(s[1],s[0])),l.scale(h,h),l.moveTo(-.5,.3),l.lineTo(1,0),l.lineTo(-.5,-.3),l.moveTo(-.5,.3),l.lineTo(-.5,-.3),l.stroke(),l.restore()}}function un(t,i){if(i>=t.length)return t.slice();const n=[];for(let s=0;i>s;s++)n[s]=t[s];for(let s=i;s<t.length;s++){const e=Math.floor(Math.random()*(s+1));i>e&&(n[e]=t[s])}return n}class an{constructor(t,i){b(this,"cellSize"),b(this,"cellRadius"),b(this,"centerOwMass",Ui(500,500,100)),b(this,"centerOwMassAlpha"),b(this,"grid",new Map),b(this,"itemCellKeys",new Map),this.cellSize=Ui(t.x,t.y,0),this.cellRadius=Math.ceil(Math.sqrt((t.x*t.x+t.y*t.y)/2)),this.centerOwMassAlpha=2/(i+1)}setMaxItemCount(t){this.centerOwMassAlpha=2/(t+1)}getCellKey(t){return"".concat(Math.floor(t[0]/this.cellSize[0]),",").concat(Math.floor(t[1]/this.cellSize[1]))}remove(t){const i=this.itemCellKeys.get(t);i&&(this.removeFromGrid(t,i),this.itemCellKeys.delete(t))}update(t){const i=t.getPosition(),n=this.getCellKey(i),s=this.itemCellKeys.get(t);if(s===n)return;s&&this.removeFromGrid(t,s);const e=this.grid.get(n);e?e.push(t):this.grid.set(n,[t]),this.itemCellKeys.set(t,n),Qi(this.centerOwMass,this.centerOwMass,1-this.centerOwMassAlpha);const r=tn(Xi(),i,t.getVelocity(),2);tn(this.centerOwMass,this.centerOwMass,r,this.centerOwMassAlpha)}clear(){this.grid.clear(),this.itemCellKeys.clear()}getRandomCellCoords(){const t=Array.from(this.grid.keys());if(0===t.length)return;const i=Math.floor(Math.random()*t.length),[n,s]=t[i].split(",").map(Number);return{startX:n*this.cellSize[0],startY:s*this.cellSize[1],width:this.cellSize[0],height:this.cellSize[1]}}getNeighbors(t,i){const n=this.getCellKey(t.getPosition()),s=[];let e=i.limitCount||100,r=Math.max(0,i.min);if(0==r){const i=this.grid.get(n);if(i)for(const n of i)if(n!==t&&(s.push(n),e--,0>=e))return s;r++}const[o,h]=n.split(",").map(Number);for(let l=r;l<=i.max;l++){const t=[];for(const{dx:i,dy:n}of this.diamondSpiralIterator(l)){const s=this.grid.get("".concat(o+i,",").concat(h+n));s&&t.push(...s)}if(t.length>=e)return s.push(...un(t,e)),s;s.push(...t),e-=t.length}return s}removeFromGrid(t,i){const n=this.grid.get(i);if(!n)return;const s=n.indexOf(t);-1!==s&&(1!=n.length?(n[s]=n[n.length-1],n.pop()):this.grid.delete(i))}*diamondSpiralIterator(t){let i=t,n=0;if(yield{dx:i,dy:n},0!==t){for(;i>0;)i--,n++,yield{dx:i,dy:n};for(;i>-t;)i--,n--,yield{dx:i,dy:n};for(;0>i;)i++,n--,yield{dx:i,dy:n};for(;t>i;)i++,n++,yield{dx:i,dy:n}}}}const cn={minSpeed:1,maxSpeed:4,maxTurnAngleDeg:140,acceleration:{backToFlightZone:.6,stayCloseToCenterOwfMass:.1,followCentroids:-2,pullUpTerrain:1.8,cohesion:.4,alignment:1,separation:1.8}};class fn{constructor(t,i,n={}){b(this,"displayId"),b(this,"position"),b(this,"velocity"),b(this,"acceleration"),b(this,"config"),b(this,"lastPositionInside"),b(this,"isOutside",0),b(this,"backToFlightZone"),b(this,"followCentroids"),this.displayId=t,this.config={...n,...cn};const s=2*Math.random()*Math.PI;this.position=i,this.velocity=Ui(.5*Math.cos(s),.5*Math.sin(s),Math.random()-.5),Qi(this.velocity,this.velocity,this.config.maxSpeed),this.acceleration=Xi()}getPosition(){return this.position}getVelocity(){return this.velocity}getConfig(){return this.config}update(t,i,n,s,e,r,o,h,l,u){var a;let c=this.config.maxTurnAngleDeg,f=this.config.maxSpeed;const v=Xi();this.position[1]<r||(v[1]=-this.config.acceleration.pullUpTerrain,c+=20,f+=1);const d=e.getPolygon();if(!this.backToFlightZone){const t=this.isOutside;if(this.isOutside=e.isOutside(this.position),this.isOutside){const i=Xi();if(t)this.lastPositionInside&&e.isOutside(this.lastPositionInside)&&(this.lastPositionInside=void 0),Ji(i,null!=(a=this.lastPositionInside)?a:d[Math.floor(l*d.length)],this.position);else{const t=function(t,i){let n=1/0,s=Xi();const e=t.length;if(0===e)throw Error("Polygon must have at least one vertex");for(let r=0;e>r;r++){const o=t[r],h=t[r!==e-1?r+1:0],l=[h[0]-o[0],h[1]-o[1]],u=[-l[1],l[0]],a=l[0]*u[1]-l[1]*u[0];if(1e-6>a)continue;const c=i[0]-o[0],f=i[1]-o[1],v=(c*u[1]-f*u[0])/a,d=Ui(o[0]+v*l[0]-i[0],o[1]+v*l[1]-i[1],0),p=Math.abs(d[0])+Math.abs(d[1]);n>p&&(n=p,s=d)}return s}(d,this.position);$i(i,t)}nn(i,i),this.backToFlightZone={direction:i,remainingTicks:10}}else this.lastPositionInside=(p=this.position,(w=new Ki(3))[0]=p[0],w[1]=p[1],w[2]=p[2],w)}var p,w;this.backToFlightZone&&(tn(v,v,this.backToFlightZone.direction,this.config.acceleration.backToFlightZone),this.backToFlightZone.remainingTicks--,this.backToFlightZone.remainingTicks>0||(this.backToFlightZone=void 0));const m=e.getCentroids();if(!this.followCentroids&&m.length>0){const t=Xi();for(const i of m){const n=Ji(Xi(),i,this.position);n[2]=0;const s=Math.abs(n[0])+Math.abs(n[1]);o>s&&(Qi(n,n,(o-s)/s),Vi(t,t,n))}nn(t,t),this.followCentroids={direction:t,remainingTicks:5}}this.followCentroids&&(tn(v,v,this.followCentroids.direction,this.config.acceleration.followCentroids),this.followCentroids.remainingTicks--,this.followCentroids.remainingTicks>0||(this.followCentroids=void 0));const y=Ji(Xi(),s,this.position);nn(y,y),tn(v,v,y,this.config.acceleration.stayCloseToCenterOwfMass),Vi(v,v,this.cohesionAcceleration(t)),Vi(v,v,this.alignmentAcceleration(t,h)),Vi(v,v,this.separationAcceleration(i,n,h)),function(t,i,n,s){const e=nn(Xi(),i),r=nn(Xi(),n),o=s*Math.PI/180,h=(u=r,a=(l=e)[0],c=l[1],f=l[2],v=u[0],d=u[1],p=u[2],m=(w=Math.sqrt((a*a+c*c+f*f)*(v*v+d*d+p*p)))&&function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]}(l,u)/w,Math.acos(Math.min(Math.max(m,-1),1)));var l,u,a,c,f,v,d,p,w,m;h>o?(function(t,i,n,s){var e=i[0],r=i[1],o=i[2];t[0]=e+s*(n[0]-e),t[1]=r+s*(n[1]-r),t[2]=o+s*(n[2]-o)}(t,e,r,(o+20)/h),nn(t,t),Qi(t,t,Yi(n))):$i(t,n)}(this.acceleration,this.velocity,v,c),this.isOutside||Vi(this.acceleration,this.acceleration,u);const g=Xi();Vi(g,this.velocity,this.acceleration);const M=Yi(g);.1>M||(this.velocity=g,M>f?Qi(this.velocity,this.velocity,f/M):M<this.config.minSpeed&&Qi(this.velocity,this.velocity,this.config.minSpeed/M)),this.position=Vi(this.position,this.position,this.velocity)}alignmentAcceleration(t,i){const n=Xi();for(const s of t)i<Math.abs(s.getPosition()[2]-this.position[2])||Vi(n,n,s.getVelocity());return nn(n,n),Qi(n,n,this.config.acceleration.alignment),n}cohesionAcceleration(t){const i=Xi();for(const n of t)Vi(i,i,Ji(Xi(),n.getPosition(),this.position));return nn(i,i),Qi(i,i,this.config.acceleration.cohesion),i}separationAcceleration(t,i,n){const s=Math.max(i,n),e=Xi();for(const r of t){const t=Ji(Xi(),this.position,r.getPosition());if(Math.abs(t[2])>n)continue;let i=Yi(t);i>1e-6||(i=10,sn(t,i)),tn(e,e,t,s/i-1)}return nn(e,e),Qi(e,e,this.config.acceleration.separation),e}}const vn={gravity:.05,maxDepth:250,visibleDistance:100,visibleDepth:30,grid:{cellSize:{x:10,y:10},neighborDistance:{min:1,max:6,limitCount:30},closeNeighborDistance:{min:0,max:0,limitCount:10}}};class dn{constructor(t,i={}){b(this,"simBox"),b(this,"config"),b(this,"maxBoidCount",0),b(this,"boidConfig",{}),b(this,"boids",[]),b(this,"spatialGrid"),b(this,"randomSeed",{value:1,remainingTicks:0}),b(this,"isRunning",0),b(this,"nextDisplayId",0),this.simBox=t,this.config={...vn,...i},this.spatialGrid=new an(this.config.grid.cellSize,this.maxBoidCount)}refreshRandomSeed(){this.randomSeed.remainingTicks--,this.randomSeed.remainingTicks>0||(this.randomSeed.value=Math.random(),this.randomSeed.remainingTicks=Math.floor(121*Math.random()))}getConfig(){return this.config}getCenterOwMass(){return this.spatialGrid.centerOwMass}resize(t,i){this.simBox=t,i&&(this.config.maxDepth=i)}start(t,i){t>this.maxBoidCount&&(this.maxBoidCount=t),this.boidConfig=i;for(let n=0;t>n;n++)this.spawnBoid(Math.random()*this.config.maxDepth);this.isRunning=1}boidCount(){return this.boids.length}addBoidsIfMissing(t){const i=this.maxBoidCount-this.boids.length;if(i>0){for(let n=0;Math.min(t,i)>n;n++)this.spawnBoid(this.config.maxDepth,1);return 1}return 0}removeBoids(t){if(this.boids.length<=t)return this.boids=[],void this.spatialGrid.clear();for(let i=0;t>i;i++){const t=this.boids.pop();t&&this.spatialGrid.remove(t)}}update(t,i){if(!this.isRunning)return;this.spatialGrid.setMaxItemCount(this.maxBoidCount),this.refreshRandomSeed();const n=.5>this.randomSeed.value?0:1,s=.25>this.randomSeed.value%.5?-1:1,e=Xi();e[n]=s*this.config.gravity;for(const r of this.boids){const n=this.spatialGrid.getNeighbors(r,this.config.grid.neighborDistance),s=this.spatialGrid.getNeighbors(r,this.config.grid.closeNeighborDistance);r.update(n,s,this.spatialGrid.cellRadius,this.spatialGrid.centerOwMass,t,i,this.config.visibleDistance,this.config.visibleDepth,this.randomSeed.value,e),this.spatialGrid.update(r)}}spawnBoid(t,i){let n;i&&(n=this.spatialGrid.getRandomCellCoords());const{startX:s,startY:e,width:r,height:o}=n||{startX:this.simBox.start.x-100,startY:this.simBox.start.y-20,width:this.simBox.width+100,height:this.simBox.height},h=Ui(s+r*(1.2*Math.random()-.1),e+o*(1.2*Math.random()-.1),t),l=new fn(this.nextDisplayId,h,this.boidConfig);this.nextDisplayId++,this.boids.push(l),this.spatialGrid.update(l)}stop(){this.isRunning=0,this.boids=[],this.maxBoidCount=0}}class pn{constructor(t,i,n={}){b(this,"renderer"),b(this,"flightZone"),b(this,"simulation"),b(this,"inputs"),b(this,"TARGET_TPS",30),b(this,"TARGET_TICK_TIME"),b(this,"tpsEstimator"),b(this,"debug",0),b(this,"isRunning",0),b(this,"simulationLoopId"),b(this,"renderingLoopId"),b(this,"renderingTasks",new Map),this.renderer=new ln(t,i,n),this.simulation=new dn(this.renderer.screenBox),this.flightZone=new on(this.renderer.canvasBox,this.simulation.getConfig().maxDepth),this.inputs={mouseStatus:new en(i)},this.TARGET_TICK_TIME=1e3/this.TARGET_TPS,this.tpsEstimator=new Hi(this.TARGET_TPS)}start(t,i,n={}){this.debug=i,this.simulation.boidConfig=n,this.simulation.maxBoidCount=t,this.isRunning?this.simulation.boidConfig=n:(this.isRunning=1,this.simulation.start(Math.floor(.7*t),n),this.simulationLoop(),this.renderingLoop())}async simulationLoop(){if(!this.isRunning)return;const t=this.tpsEstimator.getPrevTime(),i=this.tpsEstimator.get()-this.TARGET_TPS;if(i>0){this.simulation.addBoidsIfMissing(100);const i=this.TARGET_TICK_TIME-(performance.now()-t);i>0&&await new Promise(t=>setTimeout(t,i))}else i>-8||this.simulation.removeBoids(5);const n=this.renderer.maxHeight;this.simulation.update(this.flightZone,n),this.tpsEstimator.update(),this.simulationLoopId=requestAnimationFrame(this.simulationLoop.bind(this))}async renderingLoop(){if(!this.isRunning)return;const t=this.renderer.checkResize();this.flightZone.resize(this.renderer.canvasBox),t&&this.simulation.resize(this.renderer.screenBox),this.flightZone.clearCentroids();const i=this.inputs.mouseStatus.getPositionOnCanvas();i&&this.flightZone.addCentroid(i);const n=this.tpsEstimator.get(),s=this.renderer.maxHeight;this.renderer.clearCanvas(),this.renderer.drawFlightZone(this.flightZone,this.simulation.getConfig().visibleDistance,this.debug),this.simulation.boids.forEach(t=>{this.renderer.drawBoid(t,this.simulation.getConfig().maxDepth)}),this.debug&&(this.renderer.drawHeight(s),this.renderer.drawCenterOwMass(this.simulation.getCenterOwMass()),this.renderer.drawStats(this.simulation.boidCount(),n,this.TARGET_TPS)),this.refreshRenderingTasks(),this.renderingLoopId=requestAnimationFrame(this.renderingLoop.bind(this))}refreshRenderingTasks(){this.renderingTasks.forEach((t,i)=>{var n;if(t.render)return t.endTime&&performance.now()>=t.endTime?(null==(n=t.endCallback)||n.call(t),void this.renderingTasks.set(i,{eTag:t.eTag})):void t.render()})}stop(){this.simulationLoopId&&(cancelAnimationFrame(this.simulationLoopId),this.simulationLoopId=void 0),this.renderingLoopId&&(cancelAnimationFrame(this.renderingLoopId),this.renderingLoopId=void 0),this.renderer.clearCanvas(),this.simulation.stop(),this.isRunning=0}}var wn=Ii('<main class="svelte-uxr442"><canvas class="svelte-uxr442"></canvas></main>');!function(t,{target:i,anchor:n,props:s={},events:e,context:r,intro:o=1}){!function(){if(void 0===It){It=window,qt=/Firefox/.test(navigator.userAgent);var t=Element.prototype,i=Node.prototype,n=Text.prototype;Lt=R(i,"firstChild").get,zt=R(i,"nextSibling").get,B(t)&&(t.i=void 0,t.o=void 0,t.h=null,t.M=void 0,t.C=void 0),B(n)&&(n.k=void 0)}}();var h=new Set,l=t=>{for(var n=0;n<t.length;n++){var s=t[n];if(!h.has(s)){h.add(s);var e=Wi(s);i.addEventListener(s,Bi,{passive:e});var r=qi.get(s);void 0===r?(document.addEventListener(s,Bi,{passive:e}),qi.set(s,1)):qi.set(s,r+1)}}};l(A(Fi)),ji.add(l);var u=void 0,a=Ut(()=>{var o=null!=n?n:i.appendChild(function(t=""){return document.createTextNode(t)}());return function(t,i=1){Gt(32,t,1,i)}(()=>{r&&(et({}),nt.c=r),e&&(s.$$events=e),u=t(o,s)||{},r&&rt()}),()=>{var t;for(var s of h){i.removeEventListener(s,Bi);var e=qi.get(s);0===--e?(document.removeEventListener(s,Bi),qi.delete(s)):qi.set(s,e)}ji.delete(l),o!==n&&(null==(t=o.parentNode)||t.removeChild(o))}});Li.set(u,a)}(function(t,i){let n;et(i,0);let s=Wt(null),e=0;var r,o,h,l;r=()=>{n=new URLSearchParams(window.location.search),n.has("debug")&&(e=1),Ti(s)&&new pn(window,Ti(s)).start(5200,e,{})},null===nt&&function(){throw Error("https://svelte.dev/e/lifecycle_outside_component")}(),it&&null!==nt.l?(o=nt,l=o.l,null!=(h=l.u)?h:l.u={a:[],b:[],m:[]}).m.push(r):Xt(()=>{const t=Ei(r);if("function"==typeof t)return t}),function(t=0){const i=nt,n=i.l.u;if(!n)return;let s=()=>function(t){if("object"==typeof t&&t&&!(t instanceof EventTarget))if($ in t)Oi(t);else if(!Array.isArray(t))for(let i in t){const n=t[i];"object"==typeof n&&n&&$ in n&&Oi(n)}}(i.s);if(t){let t=0,n={};const e=ft(()=>{let s=0;const e=i.s;for(const t in e)e[t]!==n[t]&&(n[t]=e[t],s=1);return s&&t++,t});s=()=>Ti(e)}var e;n.b.length&&(e=()=>{Ni(i,s),q(n.b)},Kt(),Gt(1048584,e,1)),Xt(()=>{const t=Ei(()=>n.m.map(I));return()=>{for(const i of t)"function"==typeof i&&i()}}),n.a.length&&Xt(()=>{Ni(i,s),q(n.a)})}();var u,a,c=wn();(function(t={},i,n){var s;s=()=>{var s,e;return function(t,i=0){Gt(8|i,t,1)}(()=>{s=e,e=[],Ei(()=>{t!==n(...e)&&(i(t,...e),s&&zi(n(...s),t)&&i(null,...s))})}),()=>{var s;s=()=>{e&&zi(n(...e),t)&&i(null,...e)},0===at.length&&queueMicrotask(ct),at.push(s)}},Gt(4,s,0)})(Nt(c),t=>Ft(s,t),()=>Ti(s)),a=c,null!==(u=t)&&u.before(a),rt()},{target:document.getElementById("app")});export{_ as __vite_legacy_guard};
