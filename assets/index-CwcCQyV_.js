!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&n(t)}).observe(document,{childList:1,subtree:1})}function n(t){if(t.ep)return;t.ep=1;const n=function(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?n.credentials="include":"anonymous"===t.crossOrigin?n.credentials="omit":n.credentials="same-origin",n}(t);fetch(t.href,n)}}();var t=Array.isArray,n=[].indexOf,i=Array.from,s=Object.defineProperty,r=Object.getOwnPropertyDescriptor,e=Object.getOwnPropertyDescriptors,o=Object.prototype,l=Array.prototype,u=Object.getPrototypeOf,h=Object.isExtensible;function a(t){return t()}function f(t){for(var n=0;n<t.length;n++)t[n]()}const c=256,v=1024,d=2048,p=4096,m=8192,w=16384,y=32768,g=1<<19,M=1<<21,b=1<<23,x=Symbol("$state"),_=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"},S=Symbol();function C(t){return t===this.v}function T(t){return n=t,i=this.v,!(n!=n?i==i:n!==i||null!==n&&"object"==typeof n||"function"==typeof n);var n,i}let P=0,k=null;function E(t){k=t}function A(t,n=0,i){k={p:k,c:null,e:null,s:t,x:null,l:P&&!n?{s:null,u:null,$:[]}:null}}function F(t){var n=k,i=n.e;if(null!==i)for(var s of(n.e=null,i))yt(s);return k=n.p,{}}function R(){return!P||null!==k&&null===k.l}const O=new WeakMap;function j(t,n){for(;null!==n;){if(128&n.f)try{return void n.b.error(t)}catch(i){t=i}n=n.parent}throw t instanceof Error&&B(t),t}function B(t){const n=O.get(t);n&&(s(t,"message",{value:n.message}),s(t,"stack",{value:n.stack}))}let D=[];function q(){var t=D;D=[],f(t)}function z(t){var n=2050,i=null!==Et&&2&Et.f?Et:null;return null===Rt||null!==i&&0!==(i.f&c)?n|=c:Rt.f|=g,{ctx:k,deps:null,effects:null,equals:C,f:n,fn:t,reactions:null,rv:0,v:S,wv:0,parent:i??Rt,ac:null}}function I(t){var n=t.effects;if(null!==n){t.effects=null;for(var i=0;i<n.length;i+=1)xt(n[i])}}function L(t){var n,i=Rt;Ot(function(t){for(var n=t.parent;null!==n;){if(!(2&n.f))return n;n=n.parent}return null}(t));try{I(t),n=Kt(t)}finally{Ot(i)}return n}function $(t){var n=L(t);t.equals(n)||(t.v=n,t.wv=Zt()),Pt||(null!==G?G.set(t,t.v):tn(t,!Nt&&0===(t.f&c)||null===t.deps?v:p))}const N=new Set;let Z=null,G=null,H=new Set,K=[];function W(){const t=K.shift();K.length>0&&queueMicrotask(W),t()}let U=[],V=null,J=0;class Q{current=new Map;#t=new Map;#n=new Set;#i=0;#s=null;#r=0;#e=[];#o=[];#l=[];#u=[];#h=[];#a=[];#f=[];skipped_effects=new Set;process(t){U=[];var n=null;if(N.size>1){n=new Map,G=new Map;for(const[t,i]of this.current)n.set(t,{v:t.v,wv:t.wv}),t.v=i;for(const t of N)if(t!==this)for(const[i,s]of t.#t)n.has(i)||(n.set(i,{v:i.v,wv:i.wv}),i.v=s)}for(const r of t)this.#c(r);if(0===this.#e.length&&0===this.#i){this.#v();var i=this.#l,s=this.#u;this.#l=[],this.#u=[],this.#h=[],Z=null,Y(i),Y(s),null===Z?Z=this:N.delete(this),this.#s?.resolve()}else this.#d(this.#l),this.#d(this.#u),this.#d(this.#h);if(n){for(const[t,{v:i,wv:s}]of n)t.wv>s||(t.v=i);G=null}for(const r of this.#e)Vt(r);for(const r of this.#o)Vt(r);this.#e=[],this.#o=[]}#c(t){t.f^=v;for(var n=t.first;null!==n;){var i=n.f,s=!!(96&i);if(!(s&&0!==(i&v)||0!==(i&m)||this.skipped_effects.has(n))&&null!==n.fn){s?n.f^=v:0===(i&v)&&(4&i?this.#u.push(n):4194304&i?(n.b?.pending?this.#o:this.#e).push(n):Gt(n)&&(16&n.f&&this.#h.push(n),Vt(n)));var r=n.first;if(null!==r){n=r;continue}}var e=n.parent;for(n=n.next;null===n&&null!==e;)n=e.next,e=e.parent}}#d(t){for(const n of t)(0!==(n.f&d)?this.#a:this.#f).push(n),tn(n,v);t.length=0}capture(t,n){this.#t.has(t)||this.#t.set(t,n),this.current.set(t,t.v)}activate(){Z=this}deactivate(){Z=null;for(const t of H)if(H.delete(t),t(),null!==Z)break}neuter(){this.#r=1}flush(){U.length>0?function(){var t=Ct;J=1;try{var n=0;for(Tt(1);U.length>0;){var i=Q.ensure();n++>1e3&&X(),i.process(U),nt.clear()}}finally{J=0,Tt(t),V=null}}():this.#v(),Z===this&&(0===this.#i&&N.delete(this),this.deactivate())}#v(){if(!this.#r)for(const t of this.#n)t();this.#n.clear()}increment(){this.#i+=1}decrement(){if(this.#i-=1,0===this.#i){for(const t of this.#a)tn(t,d),tt(t);for(const t of this.#f)tn(t,p),tt(t);this.#l=[],this.#u=[],this.flush()}else this.deactivate()}add_callback(t){this.#n.add(t)}settled(){return(this.#s??={promise:new Promise((i,s)=>{t=i,n=s}),resolve:t,reject:n}).promise;var t,n}static ensure(){if(null===Z){const t=Z=new Q;N.add(Z),Q.enqueue(()=>{Z===t&&t.flush()})}return Z}static enqueue(t){0===K.length&&queueMicrotask(W),K.unshift(t)}}function X(){try{!function(){throw Error("https://svelte.dev/e/effect_update_depth_exceeded")}()}catch(t){j(t,V)}}function Y(t){var n=t.length;if(0!==n){for(var i=0;n>i;){var s=t[i++];if(!(24576&s.f)&&Gt(s)){var r=Z?Z.current.size:0;if(Vt(s),null===s.deps&&null===s.first&&null===s.nodes_start&&(null===s.teardown&&null===s.ac?_t(s):s.fn=null),null!==Z&&Z.current.size>r&&1048576&s.f)break}}for(;n>i;)tt(t[i++])}}function tt(t){for(var n=V=t;null!==n.parent;){var i=(n=n.parent).f;if(J&&n===Rt&&16&i)return;if(96&i){if(0===(i&v))return;n.f^=v}}U.push(n)}const nt=new Map;function it(t,n){return{f:0,v:t,reactions:null,equals:C,rv:0,wv:0}}function st(t,n){const i=it(t);var s;return s=i,null!==Et&&(null===jt?jt=[s]:jt.push(s)),i}function rt(t,n=0,i=1){const s=it(t);return n||(s.equals=T),P&&i&&null!==k&&null!==k.l&&(k.l.s??=[]).push(s),s}function et(t,n,i=0){return null!==Et&&(!At||!!(131072&Et.f))&&R()&&4325394&Et.f&&!jt?.includes(t)&&function(){throw Error("https://svelte.dev/e/state_unsafe_mutation")}(),function(t,n){if(!t.equals(n)){var i=t.v;Pt?nt.set(t,n):nt.set(t,i),t.v=n,Q.ensure().capture(t,i),2&t.f&&(0!==(t.f&d)&&L(t),tn(t,0===(t.f&c)?v:p)),t.wv=Zt(),lt(t,d),!R()||null===Rt||0===(Rt.f&v)||96&Rt.f||(null===qt?function(t){qt=t}([t]):qt.push(t))}return n}(t,i?ut(n):n)}function ot(t){et(t,t.v+1)}function lt(t,n){var i=t.reactions;if(null!==i)for(var s=R(),r=i.length,e=0;r>e;e++){var o=i[e],l=o.f;if(s||o!==Rt){var u=0===(l&d);u&&tn(o,n),2&l?lt(o,p):u&&tt(o)}}}function ut(n){if("object"!=typeof n||null===n||x in n)return n;const i=u(n);if(i!==o&&i!==l)return n;var s=new Map,e=t(n),h=st(0),a=Lt,f=t=>{if(Lt===a)return t();var n=Et,i=Lt;Ft(null),$t(a);var s=t();return Ft(n),$t(i),s};return e&&s.set("length",st(n.length)),new Proxy(n,{defineProperty(t,n,i){"value"in i&&0!=i.configurable&&0!=i.enumerable&&0!=i.writable||function(){throw Error("https://svelte.dev/e/state_descriptors_fixed")}();var r=s.get(n);return void 0===r?r=f(()=>{var t=st(i.value);return s.set(n,t),t}):et(r,i.value,1),1},deleteProperty(t,n){var i=s.get(n);if(void 0===i){if(n in t){const t=f(()=>st(S));s.set(n,t),ot(h)}}else et(i,S),ot(h);return 1},get(t,i,e){if(i===x)return n;var o=s.get(i),l=i in t;if(void 0!==o||l&&!r(t,i)?.writable||(o=f(()=>st(ut(l?t[i]:S))),s.set(i,o)),void 0!==o){var u=Jt(o);return u===S?void 0:u}return Reflect.get(t,i,e)},getOwnPropertyDescriptor(t,n){var i=Reflect.getOwnPropertyDescriptor(t,n);if(i&&"value"in i){var r=s.get(n);r&&(i.value=Jt(r))}else if(void 0===i){var e=s.get(n),o=e?.v;if(void 0!==e&&o!==S)return{enumerable:1,configurable:1,value:o,writable:1}}return i},has(t,n){if(n===x)return 1;var i=s.get(n),e=void 0!==i&&i.v!==S||Reflect.has(t,n);return void 0===i&&(null===Rt||e&&!r(t,n)?.writable)||(void 0===i&&(i=f(()=>st(e?ut(t[n]):S)),s.set(n,i)),Jt(i)!==S)?e:0},set(t,n,i,o){var l=s.get(n),u=n in t;if(e&&"length"===n)for(var a=i;a<l.v;a+=1){var c=s.get(a+"");void 0!==c?et(c,S):a in t&&(c=f(()=>st(S)),s.set(a+"",c))}void 0===l?u&&!r(t,n)?.writable||(et(l=f(()=>st(void 0)),ut(i)),s.set(n,l)):(u=l.v!==S,et(l,f(()=>ut(i))));var v=Reflect.getOwnPropertyDescriptor(t,n);if(v?.set&&v.set.call(o,i),!u){if(e&&"string"==typeof n){var d=s.get("length"),p=+n;Number.isInteger(p)&&p>=d.v&&et(d,p+1)}ot(h)}return 1},ownKeys(t){Jt(h);var n=Reflect.ownKeys(t).filter(t=>{var n=s.get(t);return void 0===n||n.v!==S});for(var[i,r]of s)r.v===S||i in t||n.push(i);return n},setPrototypeOf(){!function(){throw Error("https://svelte.dev/e/state_prototype_fixed")}()}})}var ht,at,ft,ct;function vt(t){return ft.call(t)}function dt(t){return ct.call(t)}function pt(t){null===Rt&&null===Et&&function(){throw Error("https://svelte.dev/e/effect_orphan")}(),null!==Et&&0!==(Et.f&c)&&null===Rt&&function(){throw Error("https://svelte.dev/e/effect_in_unowned_derived")}(),Pt&&function(){throw Error("https://svelte.dev/e/effect_in_teardown")}()}function mt(t,n,i,s=1){var r=Rt;null!==r&&0!==(r.f&m)&&(t|=m);var e={ctx:k,deps:null,nodes_start:null,nodes_end:null,f:t|d,first:null,fn:n,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(i)try{Vt(e),e.f|=y}catch(l){throw xt(e),l}else null!==n&&tt(e);if((!i||null!==e.deps||null!==e.first||null!==e.nodes_start||null!==e.teardown||0!==(e.f&g))&&s&&(null!==r&&function(t,n){var i=n.last;null===i?n.last=n.first=t:(i.next=t,t.prev=i,n.last=t)}(e,r),null!==Et&&2&Et.f&&!(64&t))){var o=Et;(o.effects??=[]).push(e)}return e}function wt(t){pt();var n=Rt.f;if(Et||!(32&n)||0!==(n&y))return yt(t);var i=k;(i.e??=[]).push(t)}function yt(t){return mt(1048580,t,0)}function gt(t){Q.ensure();const n=mt(64,t,1);return(t={})=>new Promise(i=>{t.outro?function(t,n){var i=[];St(t,i,1),function(t,n){var i=t.length;if(i>0){var s=()=>--i||n();for(var r of t)r.out(s)}else n()}(i,()=>{xt(t),n&&n()})}(n,()=>{xt(n),i(void 0)}):(xt(n),i(void 0))})}function Mt(t){var n=t.teardown;if(null!==n){const t=Pt,i=Et;kt(1),Ft(null);try{n.call(null)}finally{kt(t),Ft(i)}}}function bt(t,n=0){var i=t.first;for(t.first=t.last=null;null!==i;){i.ac?.abort(_);var s=i.next;64&i.f?i.parent=null:xt(i,n),i=s}}function xt(t,n=1){var i=0;(n||262144&t.f)&&null!==t.nodes_start&&null!==t.nodes_end&&(function(t,n){for(;null!==t;){var i=t===n?null:dt(t);t.remove(),t=i}}(t.nodes_start,t.nodes_end),i=1),bt(t,n&&!i),Ut(t,0),tn(t,w);var s=t.transitions;if(null!==s)for(const e of s)e.stop();Mt(t);var r=t.parent;null!==r&&null!==r.first&&_t(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function _t(t){var n=t.parent,i=t.prev,s=t.next;null!==i&&(i.next=s),null!==s&&(s.prev=i),null!==n&&(n.first===t&&(n.first=s),n.last===t&&(n.last=i))}function St(t,n,i){if(0===(t.f&m)){if(t.f^=m,null!==t.transitions)for(const s of t.transitions)(s.is_global||i)&&n.push(s);for(var s=t.first;null!==s;){var r=s.next;St(s,n,65536&s.f||32&s.f?i:0),s=r}}}let Ct=0;function Tt(t){Ct=t}let Pt=0;function kt(t){Pt=t}let Et=null,At=0;function Ft(t){Et=t}let Rt=null;function Ot(t){Rt=t}let jt=null,Bt=null,Dt=0,qt=null,zt=1,It=0,Lt=It;function $t(t){Lt=t}let Nt=0;function Zt(){return++zt}function Gt(t){var n=t.f;if(0!==(n&d))return 1;if(0!==(n&p)){var i=t.deps,s=0!==(n&c);if(null!==i){var r,e,o=!!(512&n),l=s&&null!==Rt&&!Nt,u=i.length;if((o||l)&&(null===Rt||0===(Rt.f&w))){var h=t,a=h.parent;for(r=0;u>r;r++)e=i[r],!o&&e?.reactions?.includes(h)||(e.reactions??=[]).push(h);o&&(h.f^=512),l&&null!==a&&0===(a.f&c)&&(h.f^=c)}for(r=0;u>r;r++)if(Gt(e=i[r])&&$(e),e.wv>t.wv)return 1}s&&(null===Rt||Nt)||tn(t,v)}return 0}function Ht(t,n,i=1){var s=t.reactions;if(null!==s&&!jt?.includes(t))for(var r=0;r<s.length;r++){var e=s[r];2&e.f?Ht(e,n,0):n===e&&(i?tn(e,d):0!==(e.f&v)&&tn(e,p),tt(e))}}function Kt(t){var n=Bt,i=Dt,s=qt,r=Et,e=Nt,o=jt,l=k,u=At,h=Lt,a=t.f;Bt=null,Dt=0,qt=null,Nt=0!==(a&c)&&(At||!Ct||null===Et),Et=96&a?null:t,jt=null,E(t.ctx),At=0,Lt=++It,null!==t.ac&&(t.ac.abort(_),t.ac=null);try{t.f|=M;var f=(0,t.fn)(),v=t.deps;if(null!==Bt){var d;if(Ut(t,Dt),null!==v&&Dt>0)for(v.length=Dt+Bt.length,d=0;d<Bt.length;d++)v[Dt+d]=Bt[d];else t.deps=v=Bt;if(!Nt||2&a&&null!==t.reactions)for(d=Dt;d<v.length;d++)(v[d].reactions??=[]).push(t)}else null!==v&&Dt<v.length&&(Ut(t,Dt),v.length=Dt);if(R()&&null!==qt&&!At&&null!==v&&!(6146&t.f))for(d=0;d<qt.length;d++)Ht(qt[d],t);return null!==r&&r!==t&&(It++,null!==qt&&(null===s?s=qt:s.push(...qt))),0!==(t.f&b)&&(t.f^=b),f}catch(p){return function(t){var n=Rt;if(null===n)return Et.f|=b,t;if(0===(n.f&y)){if(!(128&n.f))throw!n.parent&&t instanceof Error&&B(t),t;n.b.error(t)}else j(t,n)}(p)}finally{t.f^=M,Bt=n,Dt=i,qt=s,Et=r,Nt=e,jt=o,E(l),At=u,Lt=h}}function Wt(t,i){let s=i.reactions;if(null!==s){var r=n.call(s,t);if(-1!==r){var e=s.length-1;0===e?s=i.reactions=null:(s[r]=s[e],s.pop())}}null===s&&2&i.f&&(null===Bt||!Bt.includes(i))&&(tn(i,p),768&i.f||(i.f^=512),I(i),Ut(i,0))}function Ut(t,n){var i=t.deps;if(null!==i)for(var s=n;s<i.length;s++)Wt(t,i[s])}function Vt(t){var n=t.f;if(0===(n&w)){tn(t,v);var i=Rt,s=Ct;Rt=t,Ct=1;try{16&n?function(t){for(var n=t.first;null!==n;){var i=n.next;!(32&n.f)&&xt(n),n=i}}(t):bt(t),Mt(t);var r=Kt(t);t.teardown="function"==typeof r?r:null,t.wv=zt}finally{Ct=s,Rt=i}}}function Jt(t){var n=!!(2&t.f);if(null===Et||At){if(n&&null===t.deps&&null===t.effects){var i=t,s=i.parent;null!==s&&0===(s.f&c)&&(i.f^=c)}}else if((null===Rt||0===(Rt.f&w))&&!jt?.includes(t)){var r=Et.deps;if(0!==(Et.f&M))t.rv<It&&(t.rv=It,null===Bt&&null!==r&&r[Dt]===t?Dt++:null===Bt?Bt=[t]:Nt&&Bt.includes(t)||Bt.push(t));else{(Et.deps??=[]).push(t);var e=t.reactions;null===e?t.reactions=[Et]:e.includes(Et)||e.push(Et)}}if(Pt){if(nt.has(t))return nt.get(t);if(n){var o=(i=t).v;return(0===(i.f&v)&&null!==i.reactions||Qt(i))&&(o=L(i)),nt.set(i,o),o}}else if(n){if(i=t,G?.has(i))return G.get(i);Gt(i)&&$(i)}if(0!==(t.f&b))throw t.v;return t.v}function Qt(t){if(t.v===S)return 1;if(null===t.deps)return 0;for(const n of t.deps){if(nt.has(n))return 1;if(2&n.f&&Qt(n))return 1}return 0}function Xt(t){var n=At;try{return At=1,t()}finally{At=n}}const Yt=-7169;function tn(t,n){t.f=t.f&Yt|n}function nn(t,n=new Set){if(!("object"!=typeof t||null===t||t instanceof EventTarget||n.has(t))){n.add(t),t instanceof Date&&t.getTime();for(let r in t)try{nn(t[r],n)}catch(i){}const s=u(t);if(s!==Object.prototype&&s!==Array.prototype&&s!==Map.prototype&&s!==Set.prototype&&s!==Date.prototype){const n=e(s);for(let s in n){const r=n[s].get;if(r)try{r.call(t)}catch(i){}}}}}const sn=["touchstart","touchmove"];function rn(t){return sn.includes(t)}const en=new Set,on=new Set;function ln(n){var i=this,r=i.ownerDocument,e=n.type,o=n.composedPath?.()||[],l=o[0]||n.target,u=0,h=n.t;if(h){var a=o.indexOf(h);if(-1!==a&&(i===document||i===window))return void(n.t=i);var f=o.indexOf(i);if(-1===f)return;a>f||(u=a)}if((l=o[u]||n.target)!==i){s(n,"currentTarget",{configurable:1,get:()=>l||r});var c=Et,v=Rt;Ft(null),Ot(null);try{for(var d,p=[];null!==l;){var m=l.assignedSlot||l.parentNode||l.host||null;try{var w=l["__"+e];if(null!=w&&(!l.disabled||n.target===l))if(t(w)){var[y,...g]=w;y.call(l,n,...g)}else w.call(l,n)}catch(M){d?p.push(M):d=M}if(n.cancelBubble||m===i||null===m)break;l=m}if(d){for(let t of p)queueMicrotask(()=>{throw t});throw d}}finally{n.t=i,delete n.currentTarget,Ft(c),Ot(v)}}}function un(t,n){var i,s=!!(2&n),r=!t.startsWith("<!>");return()=>{var n,e;void 0===i&&(n=r?t:"<!>"+t,(e=document.createElement("template")).innerHTML=n.replaceAll("<!>","\x3c!----\x3e"),i=vt(i=e.content));var o,l,u,h=s||at?document.importNode(i,1):i.cloneNode(1);return o=h,l=h,null===(u=Rt).nodes_start&&(u.nodes_start=o,u.nodes_end=l),h}}const hn=new Map;let an=new WeakMap;function fn(t,n){return t===n||t?.[x]===n}function cn(t,n){if(t.l.s)for(const i of t.l.s)Jt(i);n()}"undefined"!=typeof window&&((window.__svelte??={}).v??=new Set).add("5"),P=1;class vn{previousFps;lastFrameTime;alpha=.065;constructor(t=60){this.previousFps=t,this.lastFrameTime=performance.now()}getFps(){return this.previousFps}getLastFrameTime(){return this.lastFrameTime}update(){const t=performance.now(),n=1e3/(t-this.lastFrameTime||1);this.previousFps=this.previousFps*(1-this.alpha)+this.alpha*n,this.lastFrameTime=t}}var dn="undefined"!=typeof Float32Array?Float32Array:Array;function pn(){var t=new dn(3);return dn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function mn(t){var n=t[0],i=t[1],s=t[2];return Math.hypot(n,i,s)}function wn(t,n,i){var s=new dn(3);return s[0]=t,s[1]=n,s[2]=i,s}function yn(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function gn(t,n,i){return t[0]=n[0]-i[0],t[1]=n[1]-i[1],t[2]=n[2]-i[2],t}function Mn(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t}function bn(t,n,i,s){return t[0]=n[0]+i[0]*s,t[1]=n[1]+i[1]*s,t[2]=n[2]+i[2]*s,t}function xn(t,n){var i=n[0],s=n[1],r=n[2],e=i*i+s*s+r*r;return e>0&&(e=1/Math.sqrt(e)),t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)}),pn();class _n{canvas;positionOnCanvas;isPressed=0;isMouseOver=1;constructor(t){this.canvas=t,this.canvas.tabIndex=0,this.setupListeners(t)}isMousePressed(){return this.isPressed&&this.isMouseOver}isMouseFocused(){return this.isMouseOver}getPositionOnCanvas(){if(this.isMouseFocused()&&this.positionOnCanvas)return this.positionOnCanvas}setupListeners(t){t.addEventListener("focus",()=>{this.isMouseOver=1}),t.addEventListener("mouseenter",()=>{this.isMouseOver=1}),t.addEventListener("mouseover",()=>{this.isMouseOver=1}),t.addEventListener("mouseleave",()=>{this.isMouseOver=0,this.isPressed=0,this.positionOnCanvas=void 0}),t.addEventListener("mousemove",t=>{this.isMouseOver=1;const n=wn(t.clientX,t.clientY,50);this.positionOnCanvas=n}),t.addEventListener("mousedown",()=>{this.isPressed=1}),t.addEventListener("mouseup",()=>{this.isPressed=0})}}class Sn{start;end;width;height;constructor(t,n,i,s){this.start={x:t,y:n},this.end={x:t+i,y:n+s},this.width=i,this.height=s}equals(t){return this.start.x===t.start.x&&this.start.y===t.start.y&&this.width===t.width&&this.height===t.height}}class Cn{canvasBox;paddingRatio;maxDepth;polygon;centroids;constructor(t,n,i=.1){this.canvasBox=t,this.paddingRatio=i,this.maxDepth=n,this.polygon=this.defaultPolygon(),this.centroids=[]}defaultPolygon(){const t=this.maxDepth/2,n=Math.min(this.canvasBox.width*this.paddingRatio,this.canvasBox.height*this.paddingRatio);return[wn(this.canvasBox.start.x+n,this.canvasBox.start.y+n,t),wn(this.canvasBox.end.x-n,this.canvasBox.start.y+n,t),wn(this.canvasBox.end.x-n,this.canvasBox.end.y-n,t),wn(this.canvasBox.start.x+n,this.canvasBox.end.y-n,t)]}getPolygon(){return this.polygon}resetPolygon(){this.polygon=this.defaultPolygon()}getCentroids(){return this.centroids}addCentroid(t){const n=(i=t,(s=new dn(3))[0]=i[0],s[1]=i[1],s[2]=i[2],s);var i,s;n[0]+=this.canvasBox.start.x,n[1]+=this.canvasBox.start.y,n[2]=Math.max(0,Math.min(this.maxDepth,n[2])),this.centroids.push(n)}clearCentroids(){this.centroids.length=0}isOutside(t){const n=t[2];return n>this.maxDepth||0>n||!function(t,n){if(3>n.length)return 0;let i=0;const s=t[0],r=t[1];for(let e=0,o=n.length-1;e<n.length;o=e++){const t=n[e][0],l=n[e][1],u=n[o][0],h=n[o][1];r>=l==h>r&&(u-t)*(r-l)/(h-l)+t>s&&(i=!i)}return i}(t,this.polygon)}resize(t){if(this.canvasBox.equals(t))return;const n=t.width===this.canvasBox.width?1:t.width/this.canvasBox.width,i=t.height===this.canvasBox.height?1:t.height/this.canvasBox.height;for(const s of this.polygon)s[0]=(s[0]-this.canvasBox.start.x)*n+t.start.x,s[1]=(s[1]-this.canvasBox.start.y)*i+t.start.y;for(const s of this.centroids)s[0]=(s[0]-this.canvasBox.start.x)*n+t.start.x,s[1]=(s[1]-this.canvasBox.start.y)*i+t.start.y;this.canvasBox=t}}const Tn={clearCanvasIfResized:1,boids:{lineWidth:.1,size:3},debug:{flightZone:{polygonColor:"#00ff00",centroidsColor:"#0000ff"}}};class Pn{window;canvas;renderingContext;config;screenBox;canvasBox;maxHeight;devicePixelRatio;screenHasTopLeft=0;boidPath=function(){const t=new Path2D;return t.moveTo(-.5,.3),t.lineTo(1,0),t.lineTo(-.5,-.3),t.moveTo(-.5,.3),t.lineTo(-.5,-.3),t.moveTo(1,0),t.lineTo(-.5,0),t}();constructor(t,n,i={}){this.window=t,this.canvas=n;const s=n.getContext("2d");if(!s)throw Error("Canvas context not available");this.renderingContext=s,this.config={...Tn,...i},this.screenBox=this.getScreenBox(),this.canvasBox=this.getCanvasBox(),this.devicePixelRatio=this.window.devicePixelRatio||1,this.maxHeight=this.getMaxHeight(),this.scaleCanvas()}getMaxHeight(){return this.screenHasTopLeft?this.screenBox.end.y-20:Math.max(this.canvasBox.end.y,this.screenBox.end.y)-20}checkResize(){this.screenBox=this.getScreenBox();const t=this.window.devicePixelRatio||1,n=this.getCanvasBox();return this.canvasBox.equals(n)&&this.devicePixelRatio===t?0:(this.config.clearCanvasIfResized&&this.clearCanvas(),this.devicePixelRatio=t,this.canvasBox=n,this.maxHeight=this.getMaxHeight(),this.scaleCanvas(),1)}getScreenBox(){let t=0,n=0;return"left"in this.window.screen&&"top"in this.window.screen&&"number"==typeof this.window.screen.left&&"number"==typeof this.window.screen.top?(this.screenHasTopLeft=1,t=this.window.screen.left,n=this.window.screen.top):this.screenHasTopLeft=0,new Sn(t,n,this.window.screen.width,this.window.screen.height)}getCanvasBox(){const t=this.canvas.getBoundingClientRect();return new Sn(this.window.screenX+(this.window.outerWidth-this.window.innerWidth)+t.left,this.window.screenY+(this.window.outerHeight-this.window.innerHeight)+t.top,t.width,t.height)}scaleCanvas(){const t=this.renderingContext,n=this.canvas.clientWidth,i=this.canvas.clientHeight;this.canvas.width=n*this.devicePixelRatio,this.canvas.height=i*this.devicePixelRatio,t.scale(this.devicePixelRatio,this.devicePixelRatio)}clearCanvas(){const t=this.renderingContext;t.canvas.width=t.canvas.width,t.scale(this.devicePixelRatio,this.devicePixelRatio)}drawStats(t,n,i){const s=this.renderingContext;s.save(),s.font="10px monospace",s.fillStyle="#888888",s.fillText("Boids: "+t,16,24),s.fillText(`FPS:   ${Math.round(n)} ~ ${i}`,16,40),s.restore()}drawHeight(t){const n=this.renderingContext;n.save();const i=t-this.canvasBox.start.y;n.strokeStyle="#ff0000",n.lineWidth=1,n.beginPath(),n.moveTo(0,i),n.lineTo(this.canvasBox.width,i),n.stroke(),n.restore()}drawFlightZone(t,n){const i=this.canvasBox.start.x,s=this.canvasBox.start.y,r=t.getPolygon(),e=t.getCentroids(),o=this.renderingContext;o.save(),o.strokeStyle=this.config.debug.flightZone.polygonColor,o.lineWidth=1,o.setLineDash([4,6]),o.beginPath(),o.moveTo(r[0][0]-i,r[0][1]-s);for(let l=1;l<r.length;l++)o.lineTo(r[l][0]-i,r[l][1]-s);o.closePath(),o.stroke(),o.strokeStyle=this.config.debug.flightZone.centroidsColor;for(const l of e){const t=l[0]-i,r=l[1]-s,e=10;o.beginPath(),o.moveTo(t-e,r),o.lineTo(t+e,r),o.moveTo(t,r-e),o.lineTo(t,r+e),o.stroke(),o.beginPath(),o.setLineDash([4,6]),o.arc(t,r,n,0,2*Math.PI),o.stroke()}o.restore()}drawDraftPolygon(t,n){const i=n?t.length:t.length-1,s=this.renderingContext;s.save(),s.strokeStyle="#666666",s.globalAlpha=.5,s.lineWidth=1,s.setLineDash([4,6]),s.beginPath();let r=t[0][0]-0,e=t[0][1]-0;n||s.arc(r,e,10,0,2*Math.PI),s.moveTo(r,e);for(let o=1;i>o;o++)r=t[o][0]-0,e=t[o][1]-0,s.arc(r,e,10,0,2*Math.PI),s.lineTo(r,e);s.closePath(),s.stroke(),s.restore()}drawBoid(t,n){const i=t.getPosition(),s=t.getVelocity(),r=this.canvasBox.start.x,e=this.canvasBox.start.y,o=Math.min(1.125,Math.max(-.125,i[2]/n));let l=this.config.boids.size;0>o?l+=8*-o:o>1&&(l-=8*(o-1));const u=this.renderingContext;u.save(),u.translate(i[0]-r,i[1]-e),u.rotate(Math.atan2(s[1],s[0])),u.scale(l,l),u.strokeStyle=`hsl(10, 10%, ${Math.max(10,90-80*o)}%)`,u.lineWidth=this.config.boids.lineWidth,u.stroke(this.boidPath),u.restore()}}function kn(t,n){if(n>=t.length)return t.slice();const i=[];for(let s=0;n>s;s++)i[s]=t[s];for(let s=n;s<t.length;s++){const r=Math.floor(Math.random()*(s+1));n>r&&(i[r]=t[s])}return i}class En{cellSize;cellRadius;grid;prevCellKeys=new Map;constructor(t){this.cellSize=wn(t.x,t.y,0),this.cellRadius=Math.ceil(Math.sqrt((t.x*t.x+t.y*t.y)/2)),this.grid=new Map}getCellKey(t){return`${Math.floor(t[0]/this.cellSize[0])},${Math.floor(t[1]/this.cellSize[1])}`}remove(t){const n=this.prevCellKeys.get(t);n&&(this.removeFromGrid(t,n),this.prevCellKeys.delete(t))}update(t){const n=t.getPosition(),i=this.getCellKey(n),s=this.prevCellKeys.get(t);if(s===i)return;s&&this.removeFromGrid(t,s);const r=this.grid.get(i);r?r.push(t):this.grid.set(i,[t]),this.prevCellKeys.set(t,i)}clear(){this.grid.clear(),this.prevCellKeys.clear()}getNeighbors(t,n){const i=this.getCellKey(t.getPosition()),s=n.limitCount??1e3,r=[];let e=0,o=Math.max(0,n.min);if(0==o){const n=this.grid.get(i);if(n)for(const i of n)if(i!==t&&(r.push(i),e++,e>=s))return r;o++}const[l,u]=i.split(",").map(Number);for(let h=o;h<=n.max;h++){const t=[];for(const{dx:n,dy:i}of this.diamondSpiralIterator(h)){const s=this.grid.get(`${l+n},${u+i}`);s&&t.push(...s)}if(e+t.length>=s){const n=s-e;return r.push(...kn(t,n)),r}r.push(...t),e+=t.length}return r}removeFromGrid(t,n){const i=this.grid.get(n);if(!i)return;const s=i.indexOf(t);-1!==s&&(1!=i.length?(i[s]=i[i.length-1],i.pop()):this.grid.delete(n))}*diamondSpiralIterator(t){let n=t,i=0;for(yield{dx:n,dy:i};n>0;)n--,i++,yield{dx:n,dy:i};for(;n>-t;)n--,i--,yield{dx:n,dy:i};for(;0>n;)n++,i--,yield{dx:n,dy:i};for(;t>n;)n++,i++,yield{dx:n,dy:i}}}const An={minSpeed:1,maxSpeed:6,maxTurnAngleDeg:120,acceleration:{backToFlightZone:.6,followCentroids:.6,pullUpTerrain:1.8,cohesion:.6,alignment:1,separation:1.2,gravity:.05}};class Fn{displayId;position;velocity;acceleration;config;backToFlightZone;followCentroids;constructor(t,n,i={}){this.displayId=t,this.config={...i,...An};const s=2*Math.random()*Math.PI;this.position=n,this.velocity=wn(Math.cos(s)*this.config.maxSpeed,Math.sin(s)*this.config.maxSpeed,0),this.acceleration=pn()}getPosition(){return this.position}getVelocity(){return this.velocity}getConfig(){return this.config}update(t,n,i,s,r,e){let o=this.config.maxTurnAngleDeg,l=this.config.maxSpeed;const u=pn();this.position[1]<r||(u[1]=-this.config.acceleration.pullUpTerrain,o+=20,l+=1);const h=s.getPolygon();if(!this.backToFlightZone&&s.isOutside(this.position)){const t=pn();for(const n of h)yn(t,t,gn(pn(),n,this.position));xn(t,t),this.backToFlightZone={direction:t,remainingTicks:30}}this.backToFlightZone&&(bn(u,u,this.backToFlightZone.direction,this.config.acceleration.backToFlightZone),this.backToFlightZone.remainingTicks--,this.backToFlightZone.remainingTicks>0||(this.backToFlightZone=void 0));const a=s.getCentroids();if(!this.followCentroids&&a.length>0){const t=pn();for(const n of a){const i=gn(pn(),n,this.position),s=Math.abs(i[0])+Math.abs(i[1]),r=e-s;r>0&&(Mn(i,i,r/s),yn(t,t,i))}xn(t,t),this.followCentroids={direction:t,remainingTicks:5}}this.followCentroids&&(bn(u,u,this.followCentroids.direction,this.config.acceleration.followCentroids),this.followCentroids.remainingTicks--,this.followCentroids.remainingTicks>0||(this.followCentroids=void 0)),yn(u,u,this.cohesionAcceleration(t)),yn(u,u,this.alignmentAcceleration(t)),yn(u,u,this.separationAcceleration(n,i)),function(t,n,i,s){const r=xn(pn(),n),e=xn(pn(),i),o=s*Math.PI/180,l=(h=e,a=(u=r)[0],f=u[1],c=u[2],v=h[0],d=h[1],p=h[2],w=(m=Math.sqrt(a*a+f*f+c*c)*Math.sqrt(v*v+d*d+p*p))&&function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}(u,h)/m,Math.acos(Math.min(Math.max(w,-1),1)));var u,h,a,f,c,v,d,p,m,w;l>o?(function(t,n,i,s){var r=n[0],e=n[1],o=n[2];t[0]=r+s*(i[0]-r),t[1]=e+s*(i[1]-e),t[2]=o+s*(i[2]-o)}(t,r,e,(o+20)/l),xn(t,t),Mn(t,t,mn(i))):function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2]}(t,i)}(this.acceleration,this.velocity,u,o),this.acceleration[1]+=this.config.acceleration.gravity,yn(this.velocity,this.velocity,this.acceleration),mn(this.velocity)>l?(xn(this.velocity,this.velocity),Mn(this.velocity,this.velocity,l)):mn(this.velocity)<this.config.minSpeed&&(xn(this.velocity,this.velocity),Mn(this.velocity,this.velocity,this.config.minSpeed)),this.position=yn(this.position,this.position,this.velocity)}alignmentAcceleration(t){const n=pn();for(const i of t)yn(n,n,i.velocity);return xn(n,n),Mn(n,n,this.config.acceleration.alignment),n}cohesionAcceleration(t){const n=pn();for(const i of t)yn(n,n,gn(pn(),i.position,this.position));return xn(n,n),Mn(n,n,this.config.acceleration.cohesion),n}separationAcceleration(t,n){const i=pn();for(const s of t){const t=gn(pn(),this.position,s.position),r=mn(t);0!==r&&(Mn(t,t,n/r),yn(i,i,t))}return xn(i,i),Mn(i,i,this.config.acceleration.separation),i}}const Rn={maxDepth:250,visibleRange:500,grid:{cellSize:{x:10,y:10},neighborDistance:{min:1,max:5,limitCount:30},closeNeighborDistance:{min:0,max:0,limitCount:20}}};class On{simBox;config;maxBoidCount=0;boidConfig={};boids=[];spatialGrid;isRunning=0;nextDisplayId=0;constructor(t,n={}){this.simBox=t,this.config={...Rn,...n},this.spatialGrid=new En(this.config.grid.cellSize)}getConfig(){return this.config}resize(t,n){this.simBox=t,n&&(this.config.maxDepth=n)}start(t,n){t>this.maxBoidCount&&(this.maxBoidCount=t),this.boidConfig=n;for(let i=0;t>i;i++)this.spawnBoid(Math.random()*this.config.maxDepth);this.isRunning=1}boidCount(){return this.boids.length}addBoidsIfMissing(t){const n=this.maxBoidCount-this.boids.length;if(n>0){for(let i=0;Math.min(t,n)>i;i++)this.spawnBoid(this.config.maxDepth);return 1}return 0}removeBoids(t){if(this.boids.length<=t)return this.boids=[],void this.spatialGrid.clear();for(let n=0;t>n;n++){const t=this.boids.pop();t&&this.spatialGrid.remove(t)}}update(t,n){if(this.isRunning)for(const i of this.boids){const s=this.spatialGrid.getNeighbors(i,this.config.grid.neighborDistance),r=this.spatialGrid.getNeighbors(i,this.config.grid.closeNeighborDistance);i.update(s,r,this.spatialGrid.cellRadius,t,n,this.config.visibleRange),this.spatialGrid.update(i)}}spawnBoid(t){const n=wn(this.simBox.start.x+this.simBox.width*(1.4*Math.random()-.2),this.simBox.start.y+this.simBox.height*(1.2*Math.random()-.2)-20,t),i=new Fn(this.nextDisplayId,n,this.boidConfig);this.nextDisplayId++,this.boids.push(i),this.spatialGrid.update(i)}stop(){this.isRunning=0,this.boids=[],this.maxBoidCount=0}}class jn{renderer;flightZone;simulation;inputs;TARGET_FPS=30;TARGET_FRAME_TIME;fpsEstimator;debug=0;isRunning=0;animationId=null;resizeTimeoutId=null;constructor(t,n,i={}){this.renderer=new Pn(t,n,i),this.simulation=new On(this.renderer.screenBox),this.flightZone=new Cn(this.renderer.canvasBox,this.simulation.getConfig().maxDepth),this.inputs={mouseStatus:new _n(n)},this.TARGET_FRAME_TIME=1e3/this.TARGET_FPS,this.fpsEstimator=new vn}start(t,n,i={}){this.debug=n,this.simulation.boidConfig=i,this.simulation.maxBoidCount=t,this.isRunning?this.simulation.boidConfig=i:(this.isRunning=1,this.simulation.start(Math.floor(t/4),i),this.animationLoop(),this.resizeLoop())}async animationLoop(){if(!this.isRunning)return;this.flightZone.clearCentroids();const t=this.inputs.mouseStatus.getPositionOnCanvas();t&&this.flightZone.addCentroid(t);const n=this.fpsEstimator.getLastFrameTime(),i=this.fpsEstimator.getFps(),s=i-this.TARGET_FPS;if(s>1&&this.simulation.addBoidsIfMissing(100),s>2){const t=this.TARGET_FRAME_TIME-(performance.now()-n);t>0&&await new Promise(n=>setTimeout(n,t))}const r=this.renderer.maxHeight;this.simulation.update(this.flightZone,r),this.renderer.clearCanvas(),this.debug&&this.renderer.drawFlightZone(this.flightZone,this.simulation.getConfig().visibleRange),this.simulation.boids.forEach(t=>{this.renderer.drawBoid(t,this.simulation.getConfig().maxDepth)}),this.debug&&(this.renderer.drawStats(this.simulation.boidCount(),i,this.TARGET_FPS),this.renderer.drawHeight(r)),this.fpsEstimator.update(),this.animationId=requestAnimationFrame(this.animationLoop.bind(this))}async resizeLoop(){if(!this.isRunning)return;const t=this.renderer.checkResize();this.flightZone.resize(this.renderer.canvasBox),t&&this.simulation.resize(this.renderer.screenBox),this.resizeTimeoutId=setTimeout(this.resizeLoop.bind(this),10)}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.resizeTimeoutId&&(clearTimeout(this.resizeTimeoutId),this.resizeTimeoutId=null),this.renderer.clearCanvas(),this.simulation.stop(),this.isRunning=0}}var Bn=un('<main class="svelte-uxr442"><canvas class="svelte-uxr442"></canvas></main>');!function(t,{target:n,anchor:s,props:e={},events:o,context:l,intro:u=1}){!function(){if(void 0===ht){ht=window,at=/Firefox/.test(navigator.userAgent);var t=Element.prototype,n=Node.prototype,i=Text.prototype;ft=r(n,"firstChild").get,ct=r(n,"nextSibling").get,h(t)&&(t.i=void 0,t.o=void 0,t.h=null,t.M=void 0,t._=void 0),h(i)&&(i.S=void 0)}}();var a=new Set,f=t=>{for(var i=0;i<t.length;i++){var s=t[i];if(!a.has(s)){a.add(s);var r=rn(s);n.addEventListener(s,ln,{passive:r});var e=hn.get(s);void 0===e?(document.addEventListener(s,ln,{passive:r}),hn.set(s,1)):hn.set(s,e+1)}}};f(i(en)),on.add(f);var c=void 0,v=gt(()=>{var i=s??n.appendChild(function(t=""){return document.createTextNode(t)}());return function(t,n=1){mt(32,t,1,n)}(()=>{l&&(A({}),k.c=l),o&&(e.$$events=o),c=t(i,e)||{},l&&F()}),()=>{for(var t of a){n.removeEventListener(t,ln);var r=hn.get(t);0===--r?(document.removeEventListener(t,ln),hn.delete(t)):hn.set(t,r)}on.delete(f),i!==s&&i.parentNode?.removeChild(i)}});an.set(c,v)}(function(t,n){let i;A(n,0);let s=rt(null),r=0;var e,o,l;e=()=>{i=new URLSearchParams(window.location.search),i.has("debug")&&(r=1),Jt(s)&&new jn(window,Jt(s)).start(5200,r,{})},null===k&&function(){throw Error("https://svelte.dev/e/lifecycle_outside_component")}(),P&&null!==k.l?(o=k,l=o.l,l.u??={a:[],b:[],m:[]}).m.push(e):wt(()=>{const t=Xt(e);if("function"==typeof t)return t}),function(t=0){const n=k,i=n.l.u;if(!i)return;let s=()=>function(t){if("object"==typeof t&&t&&!(t instanceof EventTarget))if(x in t)nn(t);else if(!Array.isArray(t))for(let n in t){const i=t[n];"object"==typeof i&&i&&x in i&&nn(i)}}(n.s);if(t){let t=0,i={};const r=z(()=>{let s=0;const r=n.s;for(const t in r)r[t]!==i[t]&&(i[t]=r[t],s=1);return s&&t++,t});s=()=>Jt(r)}var r;i.b.length&&(r=()=>{cn(n,s),f(i.b)},pt(),mt(1048584,r,1)),wt(()=>{const t=Xt(()=>i.m.map(a));return()=>{for(const n of t)"function"==typeof n&&n()}}),i.a.length&&wt(()=>{cn(n,s),f(i.a)})}();var u,h,c=Bn();(function(t={},n,i){var s;s=()=>{var s,r;return function(t,n=0){mt(8|n,t,1)}(()=>{s=r,r=[],Xt(()=>{t!==i(...r)&&(n(t,...r),s&&fn(i(...s),t)&&n(null,...s))})}),()=>{var s;s=()=>{r&&fn(i(...r),t)&&n(null,...r)},0===D.length&&queueMicrotask(q),D.push(s)}},mt(4,s,0)})(vt(c),t=>et(s,t),()=>Jt(s)),h=c,null!==(u=t)&&u.before(h),F()},{target:document.getElementById("app")});
