var t,i,n,s,e,r,o,h,l,a,u,c,f,v,d,p,w,m,g,y=Object.defineProperty,M=t=>{throw TypeError(t)},b=(t,i,n)=>((t,i,n)=>i in t?y(t,i,{enumerable:1,configurable:1,writable:1,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n),x=(t,i,n)=>i.has(t)||M("Cannot "+n),k=(t,i,n)=>(x(t,i,"read from private field"),n?n.call(t):i.get(t)),C=(t,i,n)=>i.has(t)?M("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,n),T=(t,i,n,s)=>(x(t,i,"write to private field"),s?s.call(t,n):i.set(t,n),n),S=(t,i,n)=>(x(t,i,"access private method"),n);function P(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)}).observe(document,{childList:1,subtree:1})}function i(t){if(t.ep)return;t.ep=1;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?i.credentials="include":"anonymous"===t.crossOrigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();var _=Array.isArray,E=[].indexOf,O=Array.from,A=Object.defineProperty,R=Object.getOwnPropertyDescriptor,W=Object.getOwnPropertyDescriptors,F=Object.prototype,D=Array.prototype,I=Object.getPrototypeOf,j=Object.isExtensible;function B(t){return t()}function L(t){for(var i=0;i<t.length;i++)t[i]()}const q=256,N=1024,z=2048,H=4096,Z=8192,G=16384,K=32768,U=1<<19,X=1<<21,Y=1<<23,$=Symbol("$state"),V=new class extends Error{constructor(){super(...arguments),b(this,"name","StaleReactionError"),b(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}},J=Symbol();function Q(t){return t===this.v}function tt(t){return i=t,n=this.v,!(i!=i?n==n:i!==n||null!==i&&"object"==typeof i||"function"==typeof i);var i,n}let it=0,nt=null;function st(t){nt=t}function et(t,i=0,n){nt={p:nt,c:null,e:null,s:t,x:null,l:it&&!i?{s:null,u:null,$:[]}:null}}function rt(t){var i=nt,n=i.e;if(null!==n)for(var s of(i.e=null,n))Xt(s);return nt=i.p,{}}function ot(){return!it||null!==nt&&null===nt.l}const ht=new WeakMap;function lt(t,i){for(;null!==i;){if(128&i.f)try{return void i.b.error(t)}catch(n){t=n}i=i.parent}throw t instanceof Error&&at(t),t}function at(t){const i=ht.get(t);i&&(A(t,"message",{value:i.message}),A(t,"stack",{value:i.stack}))}let ut=[];function ct(){var t=ut;ut=[],L(t)}function ft(t){var i=2050,n=null!==ri&&2&ri.f?ri:null;return null===li||null!==n&&0!==(n.f&q)?i|=q:li.f|=U,{ctx:nt,deps:null,effects:null,equals:Q,f:i,fn:t,reactions:null,rv:0,v:J,wv:0,parent:null!=n?n:li,ac:null}}function vt(t){var i=t.effects;if(null!==i){t.effects=null;for(var n=0;n<i.length;n+=1)Jt(i[n])}}function dt(t){var i,n=li;ai(function(t){for(var i=t.parent;null!==i;){if(!(2&i.f))return i;i=i.parent}return null}(t));try{vt(t),i=xi(t)}finally{ai(n)}return i}function pt(t){var i=dt(t);t.equals(i)||(t.v=i,t.wv=yi()),si||(null!==gt?gt.set(t,t.v):Oi(t,!gi&&0===(t.f&q)||null===t.deps?N:H))}const wt=new Set;let mt=null,gt=null,yt=new Set,Mt=[];function bt(){const t=Mt.shift();Mt.length>0&&queueMicrotask(bt),t()}let xt=[],kt=null,Ct=0;t=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,e=new WeakMap,r=new WeakMap,o=new WeakMap,h=new WeakMap,l=new WeakMap,a=new WeakMap,u=new WeakMap,c=new WeakMap,f=new WeakSet,v=function(t){var i;t.f^=N;for(var n=t.first;null!==n;){var s=n.f,e=!!(96&s);if(!(e&&0!==(s&N)||0!==(s&Z)||this.skipped_effects.has(n))&&null!==n.fn){e?n.f^=N:4&s?k(this,l).push(n):0===(s&N)&&(4194304&s?((null==(i=n.b)?void 0:i.pending)?k(this,o):k(this,r)).push(n):Mi(n)&&(16&n.f&&k(this,a).push(n),Ti(n)));var h=n.first;if(null!==h){n=h;continue}}var u=n.parent;for(n=n.next;null===n&&null!==u;)n=u.next,u=u.parent}},d=function(t){for(const i of t)(0!==(i.f&z)?k(this,u):k(this,c)).push(i),Oi(i,N);t.length=0},p=function(){if(!k(this,e))for(const t of k(this,i))t();k(this,i).clear()};let Tt=class w{constructor(){C(this,f),b(this,"current",new Map),C(this,t,new Map),C(this,i,new Set),C(this,n,0),C(this,s,null),C(this,e,0),C(this,r,[]),C(this,o,[]),C(this,h,[]),C(this,l,[]),C(this,a,[]),C(this,u,[]),C(this,c,[]),b(this,"skipped_effects",new Set)}process(i){var e;xt=[];var u=null;if(wt.size>1){u=new Map,gt=new Map;for(const[t,i]of this.current)u.set(t,{v:t.v,wv:t.wv}),t.v=i;for(const i of wt)if(i!==this)for(const[n,s]of k(i,t))u.has(n)||(u.set(n,{v:n.v,wv:n.wv}),n.v=s)}for(const t of i)S(this,f,v).call(this,t);if(0===k(this,r).length&&0===k(this,n)){S(this,f,p).call(this);var c=k(this,h),w=k(this,l);T(this,h,[]),T(this,l,[]),T(this,a,[]),mt=null,_t(c),_t(w),null===mt?mt=this:wt.delete(this),null==(e=k(this,s))||e.resolve()}else S(this,f,d).call(this,k(this,h)),S(this,f,d).call(this,k(this,l)),S(this,f,d).call(this,k(this,a));if(u){for(const[t,{v:i,wv:n}]of u)t.wv>n||(t.v=i);gt=null}for(const t of k(this,r))Ti(t);for(const t of k(this,o))Ti(t);T(this,r,[]),T(this,o,[])}capture(i,n){k(this,t).has(i)||k(this,t).set(i,n),this.current.set(i,i.v)}activate(){mt=this}deactivate(){mt=null;for(const t of yt)if(yt.delete(t),t(),null!==mt)break}neuter(){T(this,e,1)}flush(){xt.length>0?function(){var t=ii;Ct=1;try{var i=0;for(ni(1);xt.length>0;){var n=Tt.ensure();i++>1e3&&St(),n.process(xt),Ot.clear()}}finally{Ct=0,ni(t),kt=null}}():S(this,f,p).call(this),mt===this&&(0===k(this,n)&&wt.delete(this),this.deactivate())}increment(){T(this,n,k(this,n)+1)}decrement(){if(T(this,n,k(this,n)-1),0===k(this,n)){for(const t of k(this,u))Oi(t,z),Et(t);for(const t of k(this,c))Oi(t,H),Et(t);T(this,h,[]),T(this,l,[]),this.flush()}else this.deactivate()}add_callback(t){k(this,i).add(t)}settled(){var t,i,n;return(null!=(t=k(this,s))?t:T(this,s,{promise:new Promise((t,s)=>{i=t,n=s}),resolve:i,reject:n})).promise}static ensure(){if(null===mt){const t=mt=new w;wt.add(mt),w.enqueue(()=>{mt===t&&t.flush()})}return mt}static enqueue(t){0===Mt.length&&queueMicrotask(bt),Mt.unshift(t)}};function St(){try{!function(){throw Error("https://svelte.dev/e/effect_update_depth_exceeded")}()}catch(t){lt(t,kt)}}let Pt=null;function _t(t){var i=t.length;if(0!==i){for(var n=0;i>n;){var s=t[n++];if(!(24576&s.f)&&Mi(s)&&(Pt=[],Ti(s),null===s.deps&&null===s.first&&null===s.nodes_start&&(null===s.teardown&&null===s.ac?Qt(s):s.fn=null),Pt.length>0)){Ot.clear();for(const t of Pt)Ti(t);Pt=[]}}Pt=null}}function Et(t){for(var i=kt=t;null!==i.parent;){var n=(i=i.parent).f;if(Ct&&i===li&&16&n)return;if(96&n){if(0===(n&N))return;i.f^=N}}xt.push(i)}const Ot=new Map;function At(t,i){return{f:0,v:t,reactions:null,equals:Q,rv:0,wv:0}}function Rt(t,i){const n=At(t);var s;return s=n,null!==ri&&(null===ui?ui=[s]:ui.push(s)),n}function Wt(t,i=0,n=1){var s,e;const r=At(t);return i||(r.equals=tt),it&&n&&null!==nt&&null!==nt.l&&(null!=(e=(s=nt.l).s)?e:s.s=[]).push(r),r}function Ft(t,i,n=0){return null!==ri&&(!oi||!!(131072&ri.f))&&ot()&&4325394&ri.f&&!(null==ui?void 0:ui.includes(t))&&function(){throw Error("https://svelte.dev/e/state_unsafe_mutation")}(),function(t,i){if(!t.equals(i)){var n=t.v;si?Ot.set(t,i):Ot.set(t,n),t.v=i,Tt.ensure().capture(t,n),2&t.f&&(0!==(t.f&z)&&dt(t),Oi(t,0===(t.f&q)?N:H)),t.wv=yi(),It(t,z),!ot()||null===li||0===(li.f&N)||96&li.f||(null===vi?function(t){vi=t}([t]):vi.push(t))}return i}(t,n?jt(i):i)}function Dt(t){Ft(t,t.v+1)}function It(t,i){var n=t.reactions;if(null!==n)for(var s=ot(),e=n.length,r=0;e>r;r++){var o=n[r],h=o.f;if(s||o!==li){var l=0===(h&z);l&&Oi(o,i),2&h?It(o,H):l&&(16&h&&null!==Pt&&Pt.push(o),Et(o))}}}function jt(t){if("object"!=typeof t||null===t||$ in t)return t;const i=I(t);if(i!==F&&i!==D)return t;var n=new Map,s=_(t),e=Rt(0),r=wi,o=t=>{if(wi===r)return t();var i=ri,n=wi;hi(null),mi(r);var s=t();return hi(i),mi(n),s};return s&&n.set("length",Rt(t.length)),new Proxy(t,{defineProperty(t,i,s){"value"in s&&0!=s.configurable&&0!=s.enumerable&&0!=s.writable||function(){throw Error("https://svelte.dev/e/state_descriptors_fixed")}();var e=n.get(i);return void 0===e?e=o(()=>{var t=Rt(s.value);return n.set(i,t),t}):Ft(e,s.value,1),1},deleteProperty(t,i){var s=n.get(i);if(void 0===s){if(i in t){const t=o(()=>Rt(J));n.set(i,t),Dt(e)}}else Ft(s,J),Dt(e);return 1},get(i,s,e){var r;if(s===$)return t;var h=n.get(s),l=s in i;if(void 0!==h||l&&!(null==(r=R(i,s))?void 0:r.writable)||(h=o(()=>Rt(jt(l?i[s]:J))),n.set(s,h)),void 0!==h){var a=Si(h);return a===J?void 0:a}return Reflect.get(i,s,e)},getOwnPropertyDescriptor(t,i){var s=Reflect.getOwnPropertyDescriptor(t,i);if(s&&"value"in s){var e=n.get(i);e&&(s.value=Si(e))}else if(void 0===s){var r=n.get(i),o=null==r?void 0:r.v;if(void 0!==r&&o!==J)return{enumerable:1,configurable:1,value:o,writable:1}}return s},has(t,i){var s;if(i===$)return 1;var e=n.get(i),r=void 0!==e&&e.v!==J||Reflect.has(t,i);return void 0===e&&(null===li||r&&!(null==(s=R(t,i))?void 0:s.writable))||(void 0===e&&(e=o(()=>Rt(r?jt(t[i]):J)),n.set(i,e)),Si(e)!==J)?r:0},set(t,i,r,h){var l,a=n.get(i),u=i in t;if(s&&"length"===i)for(var c=r;c<a.v;c+=1){var f=n.get(c+"");void 0!==f?Ft(f,J):c in t&&(f=o(()=>Rt(J)),n.set(c+"",f))}void 0===a?u&&!(null==(l=R(t,i))?void 0:l.writable)||(Ft(a=o(()=>Rt(void 0)),jt(r)),n.set(i,a)):(u=a.v!==J,Ft(a,o(()=>jt(r))));var v=Reflect.getOwnPropertyDescriptor(t,i);if((null==v?void 0:v.set)&&v.set.call(h,r),!u){if(s&&"string"==typeof i){var d=n.get("length"),p=+i;Number.isInteger(p)&&p>=d.v&&Ft(d,p+1)}Dt(e)}return 1},ownKeys(t){Si(e);var i=Reflect.ownKeys(t).filter(t=>{var i=n.get(t);return void 0===i||i.v!==J});for(var[s,r]of n)r.v===J||s in t||i.push(s);return i},setPrototypeOf(){!function(){throw Error("https://svelte.dev/e/state_prototype_fixed")}()}})}var Bt,Lt,qt,Nt;function zt(t){return qt.call(t)}function Ht(t){return Nt.call(t)}function Zt(t){var i=ri,n=li;hi(null),ai(null);try{return t()}finally{hi(i),ai(n)}}function Gt(t){null===li&&null===ri&&function(){throw Error("https://svelte.dev/e/effect_orphan")}(),null!==ri&&0!==(ri.f&q)&&null===li&&function(){throw Error("https://svelte.dev/e/effect_in_unowned_derived")}(),si&&function(){throw Error("https://svelte.dev/e/effect_in_teardown")}()}function Kt(t,i,n,s=1){var e,r=li;null!==r&&0!==(r.f&Z)&&(t|=Z);var o={ctx:nt,deps:null,nodes_start:null,nodes_end:null,f:t|z,first:null,fn:i,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{Ti(o),o.f|=K}catch(l){throw Jt(o),l}else null!==i&&Et(o);if((!n||null!==o.deps||null!==o.first||null!==o.nodes_start||null!==o.teardown||0!==(o.f&U))&&s&&(null!==r&&function(t,i){var n=i.last;null===n?i.last=i.first=t:(n.next=t,t.prev=n,i.last=t)}(o,r),null!==ri&&2&ri.f&&!(64&t))){var h=ri;(null!=(e=h.effects)?e:h.effects=[]).push(o)}return o}function Ut(t){var i;Gt();var n=li.f;if(ri||!(32&n)||0!==(n&K))return Xt(t);var s=nt;(null!=(i=s.e)?i:s.e=[]).push(t)}function Xt(t){return Kt(1048580,t,0)}function Yt(t){Tt.ensure();const i=Kt(64,t,1);return(t={})=>new Promise(n=>{t.outro?function(t,i){var n=[];ti(t,n,1),function(t,i){var n=t.length;if(n>0){var s=()=>--n||i();for(var e of t)e.out(s)}else i()}(n,()=>{Jt(t),i&&i()})}(i,()=>{Jt(i),n(void 0)}):(Jt(i),n(void 0))})}function $t(t){var i=t.teardown;if(null!==i){const t=si,n=ri;ei(1),hi(null);try{i.call(null)}finally{ei(t),hi(n)}}}function Vt(t,i=0){var n=t.first;for(t.first=t.last=null;null!==n;){const t=n.ac;null!==t&&Zt(()=>{t.abort(V)});var s=n.next;64&n.f?n.parent=null:Jt(n,i),n=s}}function Jt(t,i=1){var n=0;(i||262144&t.f)&&null!==t.nodes_start&&null!==t.nodes_end&&(function(t,i){for(;null!==t;){var n=t===i?null:Ht(t);t.remove(),t=n}}(t.nodes_start,t.nodes_end),n=1),Vt(t,i&&!n),Ci(t,0),Oi(t,G);var s=t.transitions;if(null!==s)for(const r of s)r.stop();$t(t);var e=t.parent;null!==e&&null!==e.first&&Qt(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function Qt(t){var i=t.parent,n=t.prev,s=t.next;null!==n&&(n.next=s),null!==s&&(s.prev=n),null!==i&&(i.first===t&&(i.first=s),i.last===t&&(i.last=n))}function ti(t,i,n){if(0===(t.f&Z)){if(t.f^=Z,null!==t.transitions)for(const s of t.transitions)(s.is_global||n)&&i.push(s);for(var s=t.first;null!==s;){var e=s.next;ti(s,i,65536&s.f||32&s.f?n:0),s=e}}}let ii=0;function ni(t){ii=t}let si=0;function ei(t){si=t}let ri=null,oi=0;function hi(t){ri=t}let li=null;function ai(t){li=t}let ui=null,ci=null,fi=0,vi=null,di=1,pi=0,wi=pi;function mi(t){wi=t}let gi=0;function yi(){return++di}function Mi(t){var i,n,s=t.f;if(0!==(s&z))return 1;if(0!==(s&H)){var e=t.deps,r=0!==(s&q);if(null!==e){var o,h,l=!!(512&s),a=r&&null!==li&&!gi,u=e.length;if((l||a)&&(null===li||0===(li.f&G))){var c=t,f=c.parent;for(o=0;u>o;o++)h=e[o],!l&&(null==(i=null==h?void 0:h.reactions)?void 0:i.includes(c))||(null!=(n=h.reactions)?n:h.reactions=[]).push(c);l&&(c.f^=512),a&&null!==f&&0===(f.f&q)&&(c.f^=q)}for(o=0;u>o;o++)if(Mi(h=e[o])&&pt(h),h.wv>t.wv)return 1}r&&(null===li||gi)||Oi(t,N)}return 0}function bi(t,i,n=1){var s=t.reactions;if(null!==s&&!(null==ui?void 0:ui.includes(t)))for(var e=0;e<s.length;e++){var r=s[e];2&r.f?bi(r,i,0):i===r&&(n?Oi(r,z):0!==(r.f&N)&&Oi(r,H),Et(r))}}function xi(t){var i,n,s=ci,e=fi,r=vi,o=ri,h=gi,l=ui,a=nt,u=oi,c=wi,f=t.f;ci=null,fi=0,vi=null,gi=0!==(f&q)&&(oi||!ii||null===ri),ri=96&f?null:t,ui=null,st(t.ctx),oi=0,wi=++pi,null!==t.ac&&(Zt(()=>{t.ac.abort(V)}),t.ac=null);try{t.f|=X;var v=(0,t.fn)(),d=t.deps;if(null!==ci){var p;if(Ci(t,fi),null!==d&&fi>0)for(d.length=fi+ci.length,p=0;p<ci.length;p++)d[fi+p]=ci[p];else t.deps=d=ci;if(!gi||2&f&&null!==t.reactions)for(p=fi;p<d.length;p++)(null!=(n=(i=d[p]).reactions)?n:i.reactions=[]).push(t)}else null!==d&&fi<d.length&&(Ci(t,fi),d.length=fi);if(ot()&&null!==vi&&!oi&&null!==d&&!(6146&t.f))for(p=0;p<vi.length;p++)bi(vi[p],t);return null!==o&&o!==t&&(pi++,null!==vi&&(null===r?r=vi:r.push(...vi))),0!==(t.f&Y)&&(t.f^=Y),v}catch(w){return function(t){var i=li;if(null===i)return ri.f|=Y,t;if(0===(i.f&K)){if(!(128&i.f))throw!i.parent&&t instanceof Error&&at(t),t;i.b.error(t)}else lt(t,i)}(w)}finally{t.f^=X,ci=s,fi=e,vi=r,ri=o,gi=h,ui=l,st(a),oi=u,wi=c}}function ki(t,i){let n=i.reactions;if(null!==n){var s=E.call(n,t);if(-1!==s){var e=n.length-1;0===e?n=i.reactions=null:(n[s]=n[e],n.pop())}}null===n&&2&i.f&&(null===ci||!ci.includes(i))&&(Oi(i,H),768&i.f||(i.f^=512),vt(i),Ci(i,0))}function Ci(t,i){var n=t.deps;if(null!==n)for(var s=i;s<n.length;s++)ki(t,n[s])}function Ti(t){var i=t.f;if(0===(i&G)){Oi(t,N);var n=li,s=ii;li=t,ii=1;try{16&i?function(t){for(var i=t.first;null!==i;){var n=i.next;!(32&i.f)&&Jt(i),i=n}}(t):Vt(t),$t(t);var e=xi(t);t.teardown="function"==typeof e?e:null,t.wv=di}finally{ii=s,li=n}}}function Si(t){var i,n=!!(2&t.f);if(null===ri||oi){if(n&&null===t.deps&&null===t.effects){var s=t,e=s.parent;null!==e&&0===(e.f&q)&&(s.f^=q)}}else if((null===li||0===(li.f&G))&&!(null==ui?void 0:ui.includes(t))){var r=ri.deps;if(0!==(ri.f&X))t.rv<pi&&(t.rv=pi,null===ci&&null!==r&&r[fi]===t?fi++:null===ci?ci=[t]:gi&&ci.includes(t)||ci.push(t));else{(null!=(i=ri.deps)?i:ri.deps=[]).push(t);var o=t.reactions;null===o?t.reactions=[ri]:o.includes(ri)||o.push(ri)}}if(si){if(Ot.has(t))return Ot.get(t);if(n){var h=(s=t).v;return(0===(s.f&N)&&null!==s.reactions||Pi(s))&&(h=dt(s)),Ot.set(s,h),h}}else if(n){if(s=t,null==gt?void 0:gt.has(s))return gt.get(s);Mi(s)&&pt(s)}if(0!==(t.f&Y))throw t.v;return t.v}function Pi(t){if(t.v===J)return 1;if(null===t.deps)return 0;for(const i of t.deps){if(Ot.has(i))return 1;if(2&i.f&&Pi(i))return 1}return 0}function _i(t){var i=oi;try{return oi=1,t()}finally{oi=i}}const Ei=-7169;function Oi(t,i){t.f=t.f&Ei|i}function Ai(t,i=new Set){if(!("object"!=typeof t||null===t||t instanceof EventTarget||i.has(t))){i.add(t),t instanceof Date&&t.getTime();for(let e in t)try{Ai(t[e],i)}catch(n){}const s=I(t);if(s!==Object.prototype&&s!==Array.prototype&&s!==Map.prototype&&s!==Set.prototype&&s!==Date.prototype){const i=W(s);for(let s in i){const e=i[s].get;if(e)try{e.call(t)}catch(n){}}}}}const Ri=["touchstart","touchmove"];function Wi(t){return Ri.includes(t)}const Fi=new Set,Di=new Set;let Ii=null;function ji(t){var i,n=this,s=n.ownerDocument,e=t.type,r=(null==(i=t.composedPath)?void 0:i.call(t))||[],o=r[0]||t.target;Ii=t;var h=0,l=Ii===t&&t.t;if(l){var a=r.indexOf(l);if(-1!==a&&(n===document||n===window))return void(t.t=n);var u=r.indexOf(n);if(-1===u)return;a>u||(h=a)}if((o=r[h]||t.target)!==n){A(t,"currentTarget",{configurable:1,get:()=>o||s});var c=ri,f=li;hi(null),ai(null);try{for(var v,d=[];null!==o;){var p=o.assignedSlot||o.parentNode||o.host||null;try{var w=o["__"+e];if(null!=w&&(!o.disabled||t.target===o))if(_(w)){var[m,...g]=w;m.call(o,t,...g)}else w.call(o,t)}catch(y){v?d.push(y):v=y}if(t.cancelBubble||p===n||null===p)break;o=p}if(v){for(let t of d)queueMicrotask(()=>{throw t});throw v}}finally{t.t=n,delete t.currentTarget,hi(c),ai(f)}}}function Bi(t,i){var n,s=!!(2&i),e=!t.startsWith("<!>");return()=>{var i,r;void 0===n&&(i=e?t:"<!>"+t,(r=document.createElement("template")).innerHTML=i.replaceAll("<!>","\x3c!----\x3e"),n=zt(n=r.content));var o,h,l,a=s||Lt?document.importNode(n,1):n.cloneNode(1);return o=a,h=a,null===(l=li).nodes_start&&(l.nodes_start=o,l.nodes_end=h),a}}const Li=new Map;let qi=new WeakMap;function Ni(t,i){return t===i||(null==t?void 0:t[$])===i}function zi(t,i){if(t.l.s)for(const n of t.l.s)Si(n);i()}"undefined"!=typeof window&&(null!=(g=(m=null!=(w=window.__svelte)?w:window.__svelte={}).v)?g:m.v=new Set).add("5"),it=1;class Hi{constructor(t){b(this,"prevFrequency"),b(this,"prevTime"),b(this,"alpha",.025),this.prevFrequency=t,this.prevTime=performance.now()}get(){return this.prevFrequency}getPrevTime(){return this.prevTime}update(){const t=performance.now(),i=1e3/(t-this.prevTime||1);this.prevFrequency=this.prevFrequency*(1-this.alpha)+this.alpha*i,this.prevTime=t}}var Zi,Gi="undefined"!=typeof Float32Array?Float32Array:Array,Ki=Math.random;function Ui(){var t=new Gi(3);return Gi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Xi(t){var i=t[0],n=t[1],s=t[2];return Math.sqrt(i*i+n*n+s*s)}function Yi(t,i,n){var s=new Gi(3);return s[0]=t,s[1]=i,s[2]=n,s}function $i(t,i){return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function Vi(t,i,n){return t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function Ji(t,i,n){return t[0]=i[0]-n[0],t[1]=i[1]-n[1],t[2]=i[2]-n[2],t}function Qi(t,i,n){return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t}function tn(t,i,n,s){return t[0]=i[0]+n[0]*s,t[1]=i[1]+n[1]*s,t[2]=i[2]+n[2]*s,t}function nn(t,i){var n=i[0],s=i[1],e=i[2],r=n*n+s*s+e*e;return r>0&&(r=1/Math.sqrt(r)),t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t}function sn(t,i){i=void 0===i?1:i;var n=2*Ki()*Math.PI,s=2*Ki()-1,e=Math.sqrt(1-s*s)*i;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t[2]=s*i,t}function en(t,i){var n=new Gi(2);return n[0]=t,n[1]=i,n}Ui(),Zi=new Gi(2),Gi!=Float32Array&&(Zi[0]=0,Zi[1]=0);class rn{constructor(t){b(this,"canvas"),b(this,"positionOnCanvas"),b(this,"isPressed",0),b(this,"isMouseOver",1),this.canvas=t,this.canvas.tabIndex=0,this.setupListeners(t)}isMousePressed(){return this.isPressed&&this.isMouseOver}isMouseFocused(){return this.isMouseOver}getPositionOnCanvas(){if(this.isMouseFocused()&&this.positionOnCanvas)return this.positionOnCanvas}setupListeners(t){t.addEventListener("focus",()=>{this.isMouseOver=1}),t.addEventListener("mouseenter",()=>{this.isMouseOver=1}),t.addEventListener("mouseover",()=>{this.isMouseOver=1}),t.addEventListener("mouseleave",()=>{this.isMouseOver=0,this.isPressed=0,this.positionOnCanvas=void 0}),t.addEventListener("mousemove",t=>{this.isMouseOver=1;const i=en(t.clientX,t.clientY);this.positionOnCanvas=i}),t.addEventListener("mousedown",()=>{this.isPressed=1}),t.addEventListener("mouseup",()=>{this.isPressed=0})}}function on(t,i){const n=i[0]-t[0],s=i[1]-t[1],e=Math.max(Math.abs(n),Math.abs(s));return[n/e,s/e]}const hn="none",ln="failed",an="drawing",un="closed";class cn{constructor(t){b(this,"canvas"),b(this,"CLOSING_RADIUS",10),b(this,"polygonOnCanvas"),b(this,"_state"),b(this,"_eTag"),this.canvas=t,this.canvas.tabIndex=0,this.polygonOnCanvas=[],this.i="none",this.o=0,this.setupListeners(t)}getState(){return this.i}updateState(t){switch(this.o++,this.i=t,t){case hn:{const t=function(t,i=10){const n=t.length;if(3>n)return;const s=[];let e=[-1/0,-1/0];for(let r=0;n>r;r++){const o=r===n-1?0:r+1,h=t[r],l=t[o];if(1.414*i>=Math.abs(h[0]-l[0])+Math.abs(h[1]-l[1]))continue;const a=on(h,l);e[0]===a[0]&&e[1]===a[1]||(e=a,s.push(h))}return 3>s.length?void 0:s}(this.polygonOnCanvas);if(t)return void(this.polygonOnCanvas=t);this.i="failed";break}}}getStateInfo(){return{state:this.i,eTag:this.o}}getPolygonOnCanvas(){return this.polygonOnCanvas}setupListeners(t){let i=0;t.addEventListener("click",t=>{if(!i){i=1;try{const i=en(t.clientX,t.clientY),n=this.getState();switch(n){case hn:case ln:case un:this.polygonOnCanvas=[i],this.updateState("drawing");break;case an:{const t=this.polygonOnCanvas[0];if(Math.abs(i[0]-t[0])+Math.abs(i[1]-t[1])<=this.CLOSING_RADIUS){this.updateState("closed");break}this.polygonOnCanvas.push(i);break}default:throw Error("Unexpected polygon state: ".concat(n))}}finally{i=0}}}),t.addEventListener("dblclick",()=>{const t=this.getState();switch(t){case hn:break;case ln:case un:this.polygonOnCanvas=[],this.updateState("none");break;case an:this.updateState("closed");break;default:throw Error("Unexpected polygon state: ".concat(t))}})}}class fn{constructor(t,i,n,s){b(this,"start"),b(this,"end"),b(this,"width"),b(this,"height"),this.start={x:t,y:i},this.end={x:t+n,y:i+s},this.width=n,this.height=s}equals(t){return this.start.x===t.start.x&&this.start.y===t.start.y&&this.width===t.width&&this.height===t.height}}class vn{constructor(t,i,n=.15){b(this,"canvasBox"),b(this,"paddingRatio"),b(this,"maxDepth"),b(this,"halfDepth"),b(this,"polygon"),b(this,"centroids"),this.canvasBox=t,this.paddingRatio=n,this.maxDepth=i,this.halfDepth=i/2,this.polygon=this.defaultPolygon(),this.centroids=[]}defaultPolygon(){const t=Math.min(this.canvasBox.width*this.paddingRatio,this.canvasBox.height*this.paddingRatio);return[Yi(this.canvasBox.start.x+t,this.canvasBox.start.y+t,this.halfDepth),Yi(this.canvasBox.end.x-t,this.canvasBox.start.y+t,this.halfDepth),Yi(this.canvasBox.end.x-t,this.canvasBox.end.y-t,this.halfDepth),Yi(this.canvasBox.start.x+t,this.canvasBox.end.y-t,this.halfDepth)]}getPolygon(){return this.polygon}setPolygon(t){this.polygon=t.map(t=>Yi(t[0]+this.canvasBox.start.x,t[1]+this.canvasBox.start.y,this.halfDepth))}resetPolygon(){this.polygon=this.defaultPolygon()}getCentroids(){return this.centroids}addCentroid(t){const i=Yi(t[0]+this.canvasBox.start.x,t[1]+this.canvasBox.start.y,this.halfDepth);this.centroids.push(i)}clearCentroids(){this.centroids.length=0}isOutside(t){const i=t[2];return i>this.maxDepth||0>i||!function(t,i){if(3>i.length)return 0;let n=0;const s=t[0],e=t[1];for(let r=0,o=i.length-1;r<i.length;o=r++){const t=i[r][0],h=i[r][1],l=i[o][0],a=i[o][1],u=a-h;if(0!==u){if(e>=h==a>e&&e!==a){const i=(l-t)*(e-h)/u+t;if(s===i)return 0;i>s&&(n=!n)}}else if(s>=t==l>s&&h===e)return 0}return n}(t,this.polygon)}resize(t){if(this.canvasBox.equals(t))return;const i=t.width===this.canvasBox.width?1:t.width/this.canvasBox.width,n=t.height===this.canvasBox.height?1:t.height/this.canvasBox.height;for(const s of this.polygon)s[0]=(s[0]-this.canvasBox.start.x)*i+t.start.x,s[1]=(s[1]-this.canvasBox.start.y)*n+t.start.y;for(const s of this.centroids)s[0]=(s[0]-this.canvasBox.start.x)*i+t.start.x,s[1]=(s[1]-this.canvasBox.start.y)*n+t.start.y;this.canvasBox=t}}const dn={clearCanvasIfResized:1,boids:{lineWidth:.1,sizeScreenHeightRatio:.003},flightZone:{polygonColor:"#888888"},debug:{flightZone:{polygonColor:"#888888",centroidsColor:"#0000ff"},centerOwMassColor:"#ffff00",maxHeightColor:"#ff0000"}};class pn{constructor(t,i,n={}){b(this,"window"),b(this,"canvas"),b(this,"renderingContext"),b(this,"config"),b(this,"screenBox"),b(this,"canvasBox"),b(this,"maxHeight"),b(this,"devicePixelRatio"),b(this,"screenHasTopLeft",0),b(this,"patternCache",{}),this.window=t,this.canvas=i;const s=i.getContext("2d");if(!s)throw Error("Canvas context not available");this.renderingContext=s,this.config={...dn,...n},this.screenBox=this.getScreenBox(),this.canvasBox=this.getCanvasBox(),this.devicePixelRatio=this.window.devicePixelRatio||1,this.maxHeight=this.getMaxHeight(),this.scaleCanvas()}getMaxHeight(){return this.screenHasTopLeft?this.screenBox.end.y-20:Math.max(this.canvasBox.end.y,this.screenBox.end.y)-20}checkResize(){this.screenBox=this.getScreenBox();const t=this.window.devicePixelRatio||1,i=this.getCanvasBox();return this.canvasBox.equals(i)&&this.devicePixelRatio===t?0:(this.config.clearCanvasIfResized&&this.clearCanvas(),this.devicePixelRatio=t,this.canvasBox=i,this.maxHeight=this.getMaxHeight(),this.scaleCanvas(),1)}getScreenBox(){let t=0,i=0;return"left"in this.window.screen&&"top"in this.window.screen&&"number"==typeof this.window.screen.left&&"number"==typeof this.window.screen.top?(this.screenHasTopLeft=1,t=this.window.screen.left,i=this.window.screen.top):this.screenHasTopLeft=0,new fn(t,i,this.window.screen.width,this.window.screen.height)}getCanvasBox(){const t=this.canvas.getBoundingClientRect();return new fn(this.window.screenX+(this.window.outerWidth-this.window.innerWidth)+t.left,this.window.screenY+(this.window.outerHeight-this.window.innerHeight)+t.top,t.width,t.height)}scaleCanvas(){const t=this.renderingContext,i=this.canvas.clientWidth,n=this.canvas.clientHeight;this.canvas.width=i*this.devicePixelRatio,this.canvas.height=n*this.devicePixelRatio,t.scale(this.devicePixelRatio,this.devicePixelRatio)}clearCanvas(){const t=this.renderingContext;t.canvas.width=t.canvas.width,t.scale(this.devicePixelRatio,this.devicePixelRatio)}drawStats(t,i,n){const s=this.renderingContext;s.save(),s.font="10px monospace",s.fillStyle="#888888",s.fillText("Boids: ".concat(t),16,24),s.fillText("TPS:   ".concat(Math.round(i)," ~ ").concat(n),16,40),s.restore()}drawHeight(t){const i=this.renderingContext;i.save();const n=t-this.canvasBox.start.y;i.strokeStyle=this.config.debug.maxHeightColor,i.lineWidth=1,i.beginPath(),i.moveTo(0,n),i.lineTo(this.canvasBox.width,n),i.stroke(),i.restore()}drawCenterOwMass(t){const i=this.renderingContext;i.save();const n=t[0]-this.canvasBox.start.x,s=t[1]-this.canvasBox.start.y;i.lineWidth=1,i.strokeStyle=this.config.debug.centerOwMassColor,i.setLineDash([]),i.beginPath(),i.moveTo(n-5,s-5),i.lineTo(n+5,s+5),i.moveTo(n+5,s-5),i.lineTo(n-5,s+5),i.stroke(),i.restore()}drawFlightZone(t,i,n){if(!n)return;const s=this.canvasBox.start.x,e=this.canvasBox.start.y,r=t.getPolygon(),o=t.getCentroids(),h=(n?this.config.debug.flightZone.polygonColor:this.config.flightZone.polygonColor)+"0d",l=this.renderingContext;l.save(),l.fillStyle=h,l.beginPath(),l.moveTo(r[0][0]-s,r[0][1]-e);for(let a=1;a<r.length;a++)l.lineTo(r[a][0]-s,r[a][1]-e);l.closePath(),l.fill("evenodd"),l.restore(),l.save(),l.strokeStyle=this.config.debug.flightZone.centroidsColor;for(const a of o){const t=a[0]-s,n=a[1]-e,r=10;l.setLineDash([]),l.beginPath(),l.moveTo(t-r,n),l.lineTo(t+r,n),l.moveTo(t,n-r),l.lineTo(t,n+r),l.stroke(),l.setLineDash([4,6]),l.beginPath(),l.arc(t,n,i,0,2*Math.PI),l.stroke()}l.restore()}drawDraftPolygon(t,i,n,s,e=1){const r=this.renderingContext;r.save();const o=n||"#888888";if(null!=s){const t=s/500*e%2;r.globalAlpha=t>1?2-t:t}r.lineWidth=1,r.strokeStyle=o;let h=t[0][0]-0,l=t[0][1]-0;r.beginPath(),r.arc(h,l,10,0,2*Math.PI),r.stroke(),r.beginPath(),r.moveTo(h-5,l),r.lineTo(h+5,l),r.moveTo(h,l-5),r.lineTo(h,l+5),r.stroke();let a=this.patternCache.DraftPolygonFillStyle;a||(a=function(t,i=8){const n=document.createElement("canvas");n.width=n.height=i;const s=n.getContext("2d");if(!s)throw Error("Canvas context not available");s.strokeStyle=t,s.lineWidth=1,s.beginPath(),s.moveTo(i,0),s.lineTo(0,i),s.stroke();const e=s.createPattern(n,"repeat");if(!e)throw Error("Failed to create pattern");return e}(o+"33",8),this.patternCache.DraftPolygonFillStyle=a),r.fillStyle=a,r.setLineDash([4,4]),r.beginPath(),r.moveTo(h,l);for(let u=1;u<t.length;u++)h=t[u][0]-0,l=t[u][1]-0,r.lineTo(h,l);i&&(r.closePath(),r.fill("evenodd")),r.stroke(),r.setLineDash([]),r.beginPath(),r.moveTo(h,l);for(let u=0;u<t.length;u++)h=t[u][0]-0,l=t[u][1]-0,r.moveTo(h-5,l),r.lineTo(h+5,l),r.moveTo(h,l-5),r.lineTo(h,l+5);r.stroke(),r.restore()}drawBoid(t,i){const n=t.getPosition(),s=t.getVelocity(),e=this.canvasBox.start.x,r=this.canvasBox.start.y,o=1.2-Math.max(.2,Math.min(1.2,n[2]/i)),h=this.config.boids.sizeScreenHeightRatio*this.screenBox.height+2*o-1,l=this.renderingContext;l.save(),l.lineWidth=this.config.boids.lineWidth,l.strokeStyle="hsl(10, 10%, ".concat(80*o+20,"%)"),l.beginPath(),l.translate(n[0]-e,n[1]-r),l.rotate(Math.atan2(s[1],s[0])),l.scale(h,h),l.moveTo(-.5,.3),l.lineTo(1,0),l.lineTo(-.5,-.3),l.moveTo(-.5,.3),l.lineTo(-.5,-.3),l.stroke(),l.restore()}}function wn(t,i){if(i>=t.length)return t.slice();const n=[];for(let s=0;i>s;s++)n[s]=t[s];for(let s=i;s<t.length;s++){const e=Math.floor(Math.random()*(s+1));i>e&&(n[e]=t[s])}return n}class mn{constructor(t,i){b(this,"cellSize"),b(this,"cellRadius"),b(this,"centerOwMass",Yi(500,500,100)),b(this,"centerOwMassAlpha"),b(this,"grid",new Map),b(this,"itemCellKeys",new Map),this.cellSize=Yi(t.x,t.y,0),this.cellRadius=Math.ceil(Math.sqrt((t.x*t.x+t.y*t.y)/2)),this.centerOwMassAlpha=2/(i+1)}setMaxItemCount(t){this.centerOwMassAlpha=2/(t+1)}getCellKey(t){return"".concat(Math.floor(t[0]/this.cellSize[0]),",").concat(Math.floor(t[1]/this.cellSize[1]))}remove(t){const i=this.itemCellKeys.get(t);i&&(this.removeFromGrid(t,i),this.itemCellKeys.delete(t))}update(t){const i=t.getPosition(),n=this.getCellKey(i),s=this.itemCellKeys.get(t);if(s===n)return;s&&this.removeFromGrid(t,s);const e=this.grid.get(n);e?e.push(t):this.grid.set(n,[t]),this.itemCellKeys.set(t,n),Qi(this.centerOwMass,this.centerOwMass,1-this.centerOwMassAlpha);const r=tn(Ui(),i,t.getVelocity(),2);tn(this.centerOwMass,this.centerOwMass,r,this.centerOwMassAlpha)}clear(){this.grid.clear(),this.itemCellKeys.clear()}getRandomCellCoords(){const t=Array.from(this.grid.keys());if(0===t.length)return;const i=Math.floor(Math.random()*t.length),[n,s]=t[i].split(",").map(Number);return{startX:n*this.cellSize[0],startY:s*this.cellSize[1],width:this.cellSize[0],height:this.cellSize[1]}}getNeighbors(t,i){const n=this.getCellKey(t.getPosition()),s=[];let e=i.limitCount||100,r=Math.max(0,i.min);if(0==r){const i=this.grid.get(n);if(i)for(const n of i)if(n!==t&&(s.push(n),e--,0>=e))return s;r++}const[o,h]=n.split(",").map(Number);for(let l=r;l<=i.max;l++){const t=[];for(const{dx:i,dy:n}of this.diamondSpiralIterator(l)){const s=this.grid.get("".concat(o+i,",").concat(h+n));s&&t.push(...s)}if(t.length>=e)return s.push(...wn(t,e)),s;s.push(...t),e-=t.length}return s}removeFromGrid(t,i){const n=this.grid.get(i);if(!n)return;const s=n.indexOf(t);-1!==s&&(1!=n.length?(n[s]=n[n.length-1],n.pop()):this.grid.delete(i))}*diamondSpiralIterator(t){let i=t,n=0;if(yield{dx:i,dy:n},0!==t){for(;i>0;)i--,n++,yield{dx:i,dy:n};for(;i>-t;)i--,n--,yield{dx:i,dy:n};for(;0>i;)i++,n--,yield{dx:i,dy:n};for(;t>i;)i++,n++,yield{dx:i,dy:n}}}}const gn={minSpeed:1,maxSpeed:4,maxTurnAngleDeg:140,acceleration:{backToFlightZone:1.2,stayCloseToCenterOwfMass:.1,followCentroids:-2,pullUpTerrain:1.8,cohesion:.4,alignment:1,separation:1.8}};class yn{constructor(t,i,n={}){b(this,"displayId"),b(this,"position"),b(this,"velocity"),b(this,"acceleration"),b(this,"config"),b(this,"lastPositionInside"),b(this,"isOutside",0),b(this,"backToFlightZone"),b(this,"followCentroids"),this.displayId=t,this.config={...n,...gn};const s=2*Math.random()*Math.PI;this.position=i,this.velocity=Yi(.5*Math.cos(s),.5*Math.sin(s),Math.random()-.5),Qi(this.velocity,this.velocity,this.config.maxSpeed),this.acceleration=Ui()}getPosition(){return this.position}getVelocity(){return this.velocity}getConfig(){return this.config}update(t,i,n,s,e,r,o,h,l,a){var u;let c=this.config.maxTurnAngleDeg,f=this.config.maxSpeed;const v=Ui();this.position[1]<r||(v[1]=-this.config.acceleration.pullUpTerrain,c+=20,f+=1);const d=e.getPolygon();if(!this.backToFlightZone){const t=this.isOutside;if(this.isOutside=e.isOutside(this.position),this.isOutside){const i=Ui();if(t)this.lastPositionInside&&e.isOutside(this.lastPositionInside)&&(this.lastPositionInside=void 0),Ji(i,null!=(u=this.lastPositionInside)?u:d[Math.floor(l*d.length)],this.position);else{const t=function(t,i){let n=1/0,s=Ui();const e=t.length;if(0===e)throw Error("Polygon must have at least one vertex");for(let r=0;e>r;r++){const o=t[r],h=t[r!==e-1?r+1:0],l=[h[0]-o[0],h[1]-o[1]],a=[-l[1],l[0]],u=l[0]*a[1]-l[1]*a[0];if(1e-6>u)continue;const c=i[0]-o[0],f=i[1]-o[1],v=(c*a[1]-f*a[0])/u,d=Yi(o[0]+v*l[0]-i[0],o[1]+v*l[1]-i[1],0),p=Math.abs(d[0])+Math.abs(d[1]);n>p&&(n=p,s=d)}return s}(d,this.position);$i(i,t)}nn(i,i),this.backToFlightZone={direction:i,remainingTicks:10}}else this.lastPositionInside=(p=this.position,(w=new Gi(3))[0]=p[0],w[1]=p[1],w[2]=p[2],w)}var p,w;this.backToFlightZone&&(tn(v,v,this.backToFlightZone.direction,this.config.acceleration.backToFlightZone),this.backToFlightZone.remainingTicks--,this.backToFlightZone.remainingTicks>0||(this.backToFlightZone=void 0));const m=e.getCentroids();if(!this.followCentroids&&m.length>0){const t=Ui();for(const i of m){const n=Ji(Ui(),i,this.position);n[2]=0;const s=Math.abs(n[0])+Math.abs(n[1]);o>s&&(Qi(n,n,(o-s)/s),Vi(t,t,n))}nn(t,t),this.followCentroids={direction:t,remainingTicks:5}}this.followCentroids&&(tn(v,v,this.followCentroids.direction,this.config.acceleration.followCentroids),this.followCentroids.remainingTicks--,this.followCentroids.remainingTicks>0||(this.followCentroids=void 0));const g=Ji(Ui(),s,this.position);nn(g,g),tn(v,v,g,this.config.acceleration.stayCloseToCenterOwfMass),Vi(v,v,this.cohesionAcceleration(t)),Vi(v,v,this.alignmentAcceleration(t,h)),Vi(v,v,this.separationAcceleration(i,n,h)),function(t,i,n,s){const e=nn(Ui(),i),r=nn(Ui(),n),o=s*Math.PI/180,h=(a=r,u=(l=e)[0],c=l[1],f=l[2],v=a[0],d=a[1],p=a[2],m=(w=Math.sqrt((u*u+c*c+f*f)*(v*v+d*d+p*p)))&&function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]}(l,a)/w,Math.acos(Math.min(Math.max(m,-1),1)));var l,a,u,c,f,v,d,p,w,m;h>o?(function(t,i,n,s){var e=i[0],r=i[1],o=i[2];t[0]=e+s*(n[0]-e),t[1]=r+s*(n[1]-r),t[2]=o+s*(n[2]-o)}(t,e,r,(o+20)/h),nn(t,t),Qi(t,t,Xi(n))):$i(t,n)}(this.acceleration,this.velocity,v,c),this.isOutside||Vi(this.acceleration,this.acceleration,a);const y=Ui();Vi(y,this.velocity,this.acceleration);const M=Xi(y);.1>M||(this.velocity=y,M>f?Qi(this.velocity,this.velocity,f/M):M<this.config.minSpeed&&Qi(this.velocity,this.velocity,this.config.minSpeed/M)),this.position=Vi(this.position,this.position,this.velocity)}alignmentAcceleration(t,i){const n=Ui();for(const s of t)i<Math.abs(s.getPosition()[2]-this.position[2])||Vi(n,n,s.getVelocity());return nn(n,n),Qi(n,n,this.config.acceleration.alignment),n}cohesionAcceleration(t){const i=Ui();for(const n of t)Vi(i,i,Ji(Ui(),n.getPosition(),this.position));return nn(i,i),Qi(i,i,this.config.acceleration.cohesion),i}separationAcceleration(t,i,n){const s=Math.max(i,n),e=Ui();for(const r of t){const t=Ji(Ui(),this.position,r.getPosition());if(Math.abs(t[2])>n)continue;let i=Xi(t);i>1e-6||(i=10,sn(t,i)),tn(e,e,t,s/i-1)}return nn(e,e),Qi(e,e,this.config.acceleration.separation),e}}const Mn={gravity:.05,maxDepth:250,visibleDistance:100,visibleDepth:30,grid:{cellSize:{x:10,y:10},neighborDistance:{min:1,max:6,limitCount:30},closeNeighborDistance:{min:0,max:0,limitCount:10}}};class bn{constructor(t,i={}){b(this,"simBox"),b(this,"config"),b(this,"maxBoidCount",0),b(this,"boidConfig",{}),b(this,"boids",[]),b(this,"spatialGrid"),b(this,"randomSeed",{value:1,remainingTicks:0}),b(this,"isRunning",0),b(this,"nextDisplayId",0),this.simBox=t,this.config={...Mn,...i},this.spatialGrid=new mn(this.config.grid.cellSize,this.maxBoidCount)}refreshRandomSeed(){this.randomSeed.remainingTicks--,this.randomSeed.remainingTicks>0||(this.randomSeed.value=Math.random(),this.randomSeed.remainingTicks=Math.floor(121*Math.random()))}getConfig(){return this.config}getCenterOwMass(){return this.spatialGrid.centerOwMass}resize(t,i){this.simBox=t,i&&(this.config.maxDepth=i)}start(t,i){t>this.maxBoidCount&&(this.maxBoidCount=t),this.boidConfig=i;for(let n=0;t>n;n++)this.spawnBoid(Math.random()*this.config.maxDepth);this.isRunning=1}boidCount(){return this.boids.length}addBoidsIfMissing(t){const i=this.maxBoidCount-this.boids.length;if(i>0){for(let n=0;Math.min(t,i)>n;n++)this.spawnBoid(this.config.maxDepth,1);return 1}return 0}removeBoids(t){if(this.boids.length<=t)return this.boids=[],void this.spatialGrid.clear();for(let i=0;t>i;i++){const t=this.boids.pop();t&&this.spatialGrid.remove(t)}}update(t,i){if(!this.isRunning)return;this.spatialGrid.setMaxItemCount(this.maxBoidCount),this.refreshRandomSeed();const n=.5>this.randomSeed.value?0:1,s=.25>this.randomSeed.value%.5?-1:1,e=Ui();e[n]=s*this.config.gravity;for(const r of this.boids){const n=this.spatialGrid.getNeighbors(r,this.config.grid.neighborDistance),s=this.spatialGrid.getNeighbors(r,this.config.grid.closeNeighborDistance);r.update(n,s,this.spatialGrid.cellRadius,this.spatialGrid.centerOwMass,t,i,this.config.visibleDistance,this.config.visibleDepth,this.randomSeed.value,e),this.spatialGrid.update(r)}}spawnBoid(t,i){let n;i&&(n=this.spatialGrid.getRandomCellCoords());const{startX:s,startY:e,width:r,height:o}=n||{startX:this.simBox.start.x-100,startY:this.simBox.start.y-20,width:this.simBox.width+100,height:this.simBox.height},h=Yi(s+r*(1.2*Math.random()-.1),e+o*(1.2*Math.random()-.1),t),l=new yn(this.nextDisplayId,h,this.boidConfig);this.nextDisplayId++,this.boids.push(l),this.spatialGrid.update(l)}stop(){this.isRunning=0,this.boids=[],this.maxBoidCount=0}}class xn{constructor(t,i,n={}){b(this,"renderer"),b(this,"flightZone"),b(this,"simulation"),b(this,"inputs"),b(this,"TARGET_TPS",30),b(this,"TARGET_TICK_TIME"),b(this,"tpsEstimator"),b(this,"debug",0),b(this,"isRunning",0),b(this,"simulationLoopId"),b(this,"renderingLoopId"),b(this,"renderingTasks",new Map),this.renderer=new pn(t,i,n),this.simulation=new bn(this.renderer.screenBox),this.flightZone=new vn(this.renderer.canvasBox,this.simulation.getConfig().maxDepth),this.inputs={mouseStatus:new rn(i),polygonDrawer:new cn(i)},this.TARGET_TICK_TIME=1e3/this.TARGET_TPS,this.tpsEstimator=new Hi(this.TARGET_TPS)}start(t,i,n={}){this.debug=i,this.simulation.boidConfig=n,this.simulation.maxBoidCount=t,this.isRunning?this.simulation.boidConfig=n:(this.isRunning=1,this.simulation.start(Math.floor(.7*t),n),this.simulationLoop(),this.renderingLoop())}async simulationLoop(){if(!this.isRunning)return;const t=this.tpsEstimator.getPrevTime(),i=this.tpsEstimator.get()-this.TARGET_TPS;if(i>0){this.simulation.addBoidsIfMissing(100);const i=this.TARGET_TICK_TIME-(performance.now()-t);i>0&&await new Promise(t=>setTimeout(t,i))}else i>-8||this.simulation.removeBoids(5);const n=this.renderer.maxHeight;this.simulation.update(this.flightZone,n),this.tpsEstimator.update(),this.simulationLoopId=requestAnimationFrame(this.simulationLoop.bind(this))}async renderingLoop(){if(!this.isRunning)return;const t=this.renderer.checkResize();this.flightZone.resize(this.renderer.canvasBox),t&&this.simulation.resize(this.renderer.screenBox),this.flightZone.clearCentroids();const i=this.inputs.mouseStatus.getPositionOnCanvas();i&&this.flightZone.addCentroid(i);const n=this.tpsEstimator.get(),s=this.renderer.maxHeight;this.renderer.clearCanvas(),this.renderer.drawFlightZone(this.flightZone,this.simulation.getConfig().visibleDistance,this.debug),this.simulation.boids.forEach(t=>{this.renderer.drawBoid(t,this.simulation.getConfig().maxDepth)}),this.debug&&(this.renderer.drawHeight(s),this.renderer.drawCenterOwMass(this.simulation.getCenterOwMass()),this.renderer.drawStats(this.simulation.boidCount(),n,this.TARGET_TPS)),this.refreshRenderingTasks(),this.renderingLoopId=requestAnimationFrame(this.renderingLoop.bind(this))}refreshRenderingTasks(){var t;const{state:i,eTag:n}=this.inputs.polygonDrawer.getStateInfo();if(n!==(null==(t=this.renderingTasks.get("draftPolygon"))?void 0:t.eTag)){const t=this.inputs.polygonDrawer.getPolygonOnCanvas();let s;switch(i){case hn:this.renderingTasks.set("draftPolygon",{eTag:n}),this.flightZone.resetPolygon();break;case an:this.renderingTasks.set("draftPolygon",{eTag:n,render:()=>this.renderer.drawDraftPolygon(t,0)});break;case ln:s=performance.now()+1510,this.renderingTasks.set("draftPolygon",{eTag:n,endTime:s,render:()=>this.renderer.drawDraftPolygon(t,0,"#ff0000",s-performance.now(),3)});break;case un:s=performance.now()+3010,this.renderingTasks.set("draftPolygon",{eTag:n,endTime:s,render:()=>this.renderer.drawDraftPolygon(t,1,void 0,s-performance.now()),endCallback:()=>{this.flightZone.setPolygon(t)}})}}this.renderingTasks.forEach((t,i)=>{var n;if(t.render)return t.endTime&&performance.now()>=t.endTime?(null==(n=t.endCallback)||n.call(t),void this.renderingTasks.set(i,{eTag:t.eTag})):void t.render()})}stop(){this.simulationLoopId&&(cancelAnimationFrame(this.simulationLoopId),this.simulationLoopId=void 0),this.renderingLoopId&&(cancelAnimationFrame(this.renderingLoopId),this.renderingLoopId=void 0),this.renderer.clearCanvas(),this.simulation.stop(),this.isRunning=0}}var kn=Bi('<main class="svelte-uxr442"><canvas class="svelte-uxr442"></canvas></main>');!function(t,{target:i,anchor:n,props:s={},events:e,context:r,intro:o=1}){!function(){if(void 0===Bt){Bt=window,Lt=/Firefox/.test(navigator.userAgent);var t=Element.prototype,i=Node.prototype,n=Text.prototype;qt=R(i,"firstChild").get,Nt=R(i,"nextSibling").get,j(t)&&(t.h=void 0,t.M=void 0,t.k=null,t.C=void 0,t.T=void 0),j(n)&&(n.S=void 0)}}();var h=new Set,l=t=>{for(var n=0;n<t.length;n++){var s=t[n];if(!h.has(s)){h.add(s);var e=Wi(s);i.addEventListener(s,ji,{passive:e});var r=Li.get(s);void 0===r?(document.addEventListener(s,ji,{passive:e}),Li.set(s,1)):Li.set(s,r+1)}}};l(O(Fi)),Di.add(l);var a=void 0,u=Yt(()=>{var o=null!=n?n:i.appendChild(function(t=""){return document.createTextNode(t)}());return function(t,i=1){Kt(32,t,1,i)}(()=>{r&&(et({}),nt.c=r),e&&(s.$$events=e),a=t(o,s)||{},r&&rt()}),()=>{var t;for(var s of h){i.removeEventListener(s,ji);var e=Li.get(s);0===--e?(document.removeEventListener(s,ji),Li.delete(s)):Li.set(s,e)}Di.delete(l),o!==n&&(null==(t=o.parentNode)||t.removeChild(o))}});qi.set(a,u)}(function(t,i){let n;et(i,0);let s=Wt(null),e=0;var r,o,h,l;r=()=>{n=new URLSearchParams(window.location.search),n.has("debug")&&(e=1),Si(s)&&new xn(window,Si(s)).start(5200,e,{})},null===nt&&function(){throw Error("https://svelte.dev/e/lifecycle_outside_component")}(),it&&null!==nt.l?(o=nt,l=o.l,null!=(h=l.u)?h:l.u={a:[],b:[],m:[]}).m.push(r):Ut(()=>{const t=_i(r);if("function"==typeof t)return t}),function(t=0){const i=nt,n=i.l.u;if(!n)return;let s=()=>function(t){if("object"==typeof t&&t&&!(t instanceof EventTarget))if($ in t)Ai(t);else if(!Array.isArray(t))for(let i in t){const n=t[i];"object"==typeof n&&n&&$ in n&&Ai(n)}}(i.s);if(t){let t=0,n={};const e=ft(()=>{let s=0;const e=i.s;for(const t in e)e[t]!==n[t]&&(n[t]=e[t],s=1);return s&&t++,t});s=()=>Si(e)}var e;n.b.length&&(e=()=>{zi(i,s),L(n.b)},Gt(),Kt(1048584,e,1)),Ut(()=>{const t=_i(()=>n.m.map(B));return()=>{for(const i of t)"function"==typeof i&&i()}}),n.a.length&&Ut(()=>{zi(i,s),L(n.a)})}();var a,u,c=kn();(function(t={},i,n){var s;s=()=>{var s,e;return function(t,i=0){Kt(8|i,t,1)}(()=>{s=e,e=[],_i(()=>{t!==n(...e)&&(i(t,...e),s&&Ni(n(...s),t)&&i(null,...s))})}),()=>{var s;s=()=>{e&&Ni(n(...e),t)&&i(null,...e)},0===ut.length&&queueMicrotask(ct),ut.push(s)}},Kt(4,s,0)})(zt(c),t=>Ft(s,t),()=>Si(s)),u=c,null!==(a=t)&&a.before(u),rt()},{target:document.getElementById("app")});export{P as __vite_legacy_guard};
