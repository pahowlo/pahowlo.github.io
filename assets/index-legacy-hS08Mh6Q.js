System.register([],function(t,i){"use strict";return{execute:function(){var t=document.createElement("style");t.textContent="main.svelte-uxr442{width:100vw;height:100vh;overflow:hidden;background-color:#212121}canvas.svelte-uxr442{display:block;width:100vw;height:100vh;position:absolute;top:0;left:0;background-color:transparent!important}\n/*$vite$:1*/",document.head.appendChild(t);var i=Array.isArray,n=[].indexOf,s=Array.from,e=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyDescriptors,h=Object.prototype,l=Array.prototype,a=Object.getPrototypeOf,u=Object.isExtensible;function c(t){return t()}function f(t){for(var i=0;i<t.length;i++)t[i]()}const v=256,d=1024,p=2048,w=4096,g=8192,y=16384,m=32768,M=1<<19,b=1<<21,x=1<<23,C=Symbol("$state"),_=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"},k=Symbol();function T(t){return t===this.v}function S(t){return i=t,n=this.v,!(i!=i?n==n:i!==n||null!==i&&"object"==typeof i||"function"==typeof i);var i,n}let P=0,E=null;function A(t){E=t}function O(t,i=0,n){E={p:E,c:null,e:null,s:t,x:null,l:P&&!i?{s:null,u:null,$:[]}:null}}function R(t){var i=E,n=i.e;if(null!==n)for(var s of(i.e=null,n))mt(s);return E=i.p,{}}function F(){return!P||null!==E&&null===E.l}const D=new WeakMap;function I(t,i){for(;null!==i;){if(128&i.f)try{return void i.b.error(t)}catch(n){t=n}i=i.parent}throw t instanceof Error&&j(t),t}function j(t){const i=D.get(t);i&&(e(t,"message",{value:i.message}),e(t,"stack",{value:i.stack}))}let B=[];function q(){var t=B;B=[],f(t)}function $(t){var i=t.effects;if(null!==i){t.effects=null;for(var n=0;n<i.length;n+=1)Ct(i[n])}}function L(t){var i,n=Ft;Dt(function(t){for(var i=t.parent;null!==i;){if(!(2&i.f))return i;i=i.parent}return null}(t));try{$(t),i=Kt(t)}finally{Dt(n)}return i}function z(t){var i=L(t);t.equals(i)||(t.v=i,t.wv=Zt()),Pt||(null!==Z?Z.set(t,t.v):ii(t,!Ht&&0===(t.f&v)||null===t.deps?d:w))}const N=new Set;let H=null,Z=null,G=new Set,U=[];function K(){const t=U.shift();U.length>0&&queueMicrotask(K),t()}let W=[],X=null,Y=0;class V{current=new Map;#t=new Map;#i=new Set;#n=0;#s=null;#e=0;#r=[];#o=[];#h=[];#l=[];#a=[];#u=[];#c=[];skipped_effects=new Set;process(t){W=[];var i=null;if(N.size>1){i=new Map,Z=new Map;for(const[t,n]of this.current)i.set(t,{v:t.v,wv:t.wv}),t.v=n;for(const t of N)if(t!==this)for(const[n,s]of t.#t)i.has(n)||(i.set(n,{v:n.v,wv:n.wv}),n.v=s)}for(const e of t)this.#f(e);if(0===this.#r.length&&0===this.#n){this.#v();var n=this.#h,s=this.#l;this.#h=[],this.#l=[],this.#a=[],H=null,tt(n),tt(s),null===H?H=this:N.delete(this),this.#s?.resolve()}else this.#d(this.#h),this.#d(this.#l),this.#d(this.#a);if(i){for(const[t,{v:n,wv:s}]of i)t.wv>s||(t.v=n);Z=null}for(const e of this.#r)Yt(e);for(const e of this.#o)Yt(e);this.#r=[],this.#o=[]}#f(t){t.f^=d;for(var i=t.first;null!==i;){var n=i.f,s=!!(96&n);if(!(s&&0!==(n&d)||0!==(n&g)||this.skipped_effects.has(i))&&null!==i.fn){s?i.f^=d:4&n?this.#l.push(i):0===(n&d)&&(4194304&n?(i.b?.pending?this.#o:this.#r).push(i):Gt(i)&&(16&i.f&&this.#a.push(i),Yt(i)));var e=i.first;if(null!==e){i=e;continue}}var r=i.parent;for(i=i.next;null===i&&null!==r;)i=r.next,r=r.parent}}#d(t){for(const i of t)(0!==(i.f&p)?this.#u:this.#c).push(i),ii(i,d);t.length=0}capture(t,i){this.#t.has(t)||this.#t.set(t,i),this.current.set(t,t.v)}activate(){H=this}deactivate(){H=null;for(const t of G)if(G.delete(t),t(),null!==H)break}neuter(){this.#e=1}flush(){W.length>0?function(){var t=Tt;Y=1;try{var i=0;for(St(1);W.length>0;){var n=V.ensure();i++>1e3&&J(),n.process(W),nt.clear()}}finally{Y=0,St(t),X=null}}():this.#v(),H===this&&(0===this.#n&&N.delete(this),this.deactivate())}#v(){if(!this.#e)for(const t of this.#i)t();this.#i.clear()}increment(){this.#n+=1}decrement(){if(this.#n-=1,0===this.#n){for(const t of this.#u)ii(t,p),it(t);for(const t of this.#c)ii(t,w),it(t);this.#h=[],this.#l=[],this.flush()}else this.deactivate()}add_callback(t){this.#i.add(t)}settled(){return(this.#s??={promise:new Promise((n,s)=>{t=n,i=s}),resolve:t,reject:i}).promise;var t,i}static ensure(){if(null===H){const t=H=new V;N.add(H),V.enqueue(()=>{H===t&&t.flush()})}return H}static enqueue(t){0===U.length&&queueMicrotask(K),U.unshift(t)}}function J(){try{!function(){throw Error("https://svelte.dev/e/effect_update_depth_exceeded")}()}catch(t){I(t,X)}}let Q=null;function tt(t){var i=t.length;if(0!==i){for(var n=0;i>n;){var s=t[n++];if(!(24576&s.f)&&Gt(s)&&(Q=[],Yt(s),null===s.deps&&null===s.first&&null===s.nodes_start&&(null===s.teardown&&null===s.ac?_t(s):s.fn=null),Q.length>0)){nt.clear();for(const t of Q)Yt(t);Q=[]}}Q=null}}function it(t){for(var i=X=t;null!==i.parent;){var n=(i=i.parent).f;if(Y&&i===Ft&&16&n)return;if(96&n){if(0===(n&d))return;i.f^=d}}W.push(i)}const nt=new Map;function st(t,i){return{f:0,v:t,reactions:null,equals:T,rv:0,wv:0}}function et(t,i){const n=st(t);var s;return s=n,null!==At&&(null===It?It=[s]:It.push(s)),n}function rt(t,i,n=0){return null!==At&&(!Ot||!!(131072&At.f))&&F()&&4325394&At.f&&!It?.includes(t)&&function(){throw Error("https://svelte.dev/e/state_unsafe_mutation")}(),function(t,i){if(!t.equals(i)){var n=t.v;Pt?nt.set(t,i):nt.set(t,n),t.v=i,V.ensure().capture(t,n),2&t.f&&(0!==(t.f&p)&&L(t),ii(t,0===(t.f&v)?d:w)),t.wv=Zt(),ht(t,p),!F()||null===Ft||0===(Ft.f&d)||96&Ft.f||(null===qt?function(t){qt=t}([t]):qt.push(t))}return i}(t,n?lt(i):i)}function ot(t){rt(t,t.v+1)}function ht(t,i){var n=t.reactions;if(null!==n)for(var s=F(),e=n.length,r=0;e>r;r++){var o=n[r],h=o.f;if(s||o!==Ft){var l=0===(h&p);l&&ii(o,i),2&h?ht(o,w):l&&(16&h&&null!==Q&&Q.push(o),it(o))}}}function lt(t){if("object"!=typeof t||null===t||C in t)return t;const n=a(t);if(n!==h&&n!==l)return t;var s=new Map,e=i(t),o=et(0),u=zt,c=t=>{if(zt===u)return t();var i=At,n=zt;Rt(null),Nt(u);var s=t();return Rt(i),Nt(n),s};return e&&s.set("length",et(t.length)),new Proxy(t,{defineProperty(t,i,n){"value"in n&&0!=n.configurable&&0!=n.enumerable&&0!=n.writable||function(){throw Error("https://svelte.dev/e/state_descriptors_fixed")}();var e=s.get(i);return void 0===e?e=c(()=>{var t=et(n.value);return s.set(i,t),t}):rt(e,n.value,1),1},deleteProperty(t,i){var n=s.get(i);if(void 0===n){if(i in t){const t=c(()=>et(k));s.set(i,t),ot(o)}}else rt(n,k),ot(o);return 1},get(i,n,e){if(n===C)return t;var o=s.get(n),h=n in i;if(void 0!==o||h&&!r(i,n)?.writable||(o=c(()=>et(lt(h?i[n]:k))),s.set(n,o)),void 0!==o){var l=Vt(o);return l===k?void 0:l}return Reflect.get(i,n,e)},getOwnPropertyDescriptor(t,i){var n=Reflect.getOwnPropertyDescriptor(t,i);if(n&&"value"in n){var e=s.get(i);e&&(n.value=Vt(e))}else if(void 0===n){var r=s.get(i),o=r?.v;if(void 0!==r&&o!==k)return{enumerable:1,configurable:1,value:o,writable:1}}return n},has(t,i){if(i===C)return 1;var n=s.get(i),e=void 0!==n&&n.v!==k||Reflect.has(t,i);return void 0===n&&(null===Ft||e&&!r(t,i)?.writable)||(void 0===n&&(n=c(()=>et(e?lt(t[i]):k)),s.set(i,n)),Vt(n)!==k)?e:0},set(t,i,n,h){var l=s.get(i),a=i in t;if(e&&"length"===i)for(var u=n;u<l.v;u+=1){var f=s.get(u+"");void 0!==f?rt(f,k):u in t&&(f=c(()=>et(k)),s.set(u+"",f))}void 0===l?a&&!r(t,i)?.writable||(rt(l=c(()=>et(void 0)),lt(n)),s.set(i,l)):(a=l.v!==k,rt(l,c(()=>lt(n))));var v=Reflect.getOwnPropertyDescriptor(t,i);if(v?.set&&v.set.call(h,n),!a){if(e&&"string"==typeof i){var d=s.get("length"),p=+i;Number.isInteger(p)&&p>=d.v&&rt(d,p+1)}ot(o)}return 1},ownKeys(t){Vt(o);var i=Reflect.ownKeys(t).filter(t=>{var i=s.get(t);return void 0===i||i.v!==k});for(var[n,e]of s)e.v===k||n in t||i.push(n);return i},setPrototypeOf(){!function(){throw Error("https://svelte.dev/e/state_prototype_fixed")}()}})}var at,ut,ct,ft;function vt(t){return ct.call(t)}function dt(t){return ft.call(t)}function pt(t){var i=At,n=Ft;Rt(null),Dt(null);try{return t()}finally{Rt(i),Dt(n)}}function wt(t){null===Ft&&null===At&&function(){throw Error("https://svelte.dev/e/effect_orphan")}(),null!==At&&0!==(At.f&v)&&null===Ft&&function(){throw Error("https://svelte.dev/e/effect_in_unowned_derived")}(),Pt&&function(){throw Error("https://svelte.dev/e/effect_in_teardown")}()}function gt(t,i,n,s=1){var e=Ft;null!==e&&0!==(e.f&g)&&(t|=g);var r={ctx:E,deps:null,nodes_start:null,nodes_end:null,f:t|p,first:null,fn:i,last:null,next:null,parent:e,b:e&&e.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{Yt(r),r.f|=m}catch(h){throw Ct(r),h}else null!==i&&it(r);if((!n||null!==r.deps||null!==r.first||null!==r.nodes_start||null!==r.teardown||0!==(r.f&M))&&s&&(null!==e&&function(t,i){var n=i.last;null===n?i.last=i.first=t:(n.next=t,t.prev=n,i.last=t)}(r,e),null!==At&&2&At.f&&!(64&t))){var o=At;(o.effects??=[]).push(r)}return r}function yt(t){wt();var i=Ft.f;if(At||!(32&i)||0!==(i&m))return mt(t);var n=E;(n.e??=[]).push(t)}function mt(t){return gt(1048580,t,0)}function Mt(t){V.ensure();const i=gt(64,t,1);return(t={})=>new Promise(n=>{t.outro?function(t,i){var n=[];kt(t,n,1),function(t,i){var n=t.length;if(n>0){var s=()=>--n||i();for(var e of t)e.out(s)}else i()}(n,()=>{Ct(t),i&&i()})}(i,()=>{Ct(i),n(void 0)}):(Ct(i),n(void 0))})}function bt(t){var i=t.teardown;if(null!==i){const t=Pt,n=At;Et(1),Rt(null);try{i.call(null)}finally{Et(t),Rt(n)}}}function xt(t,i=0){var n=t.first;for(t.first=t.last=null;null!==n;){const t=n.ac;null!==t&&pt(()=>{t.abort(_)});var s=n.next;64&n.f?n.parent=null:Ct(n,i),n=s}}function Ct(t,i=1){var n=0;(i||262144&t.f)&&null!==t.nodes_start&&null!==t.nodes_end&&(function(t,i){for(;null!==t;){var n=t===i?null:dt(t);t.remove(),t=n}}(t.nodes_start,t.nodes_end),n=1),xt(t,i&&!n),Xt(t,0),ii(t,y);var s=t.transitions;if(null!==s)for(const r of s)r.stop();bt(t);var e=t.parent;null!==e&&null!==e.first&&_t(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function _t(t){var i=t.parent,n=t.prev,s=t.next;null!==n&&(n.next=s),null!==s&&(s.prev=n),null!==i&&(i.first===t&&(i.first=s),i.last===t&&(i.last=n))}function kt(t,i,n){if(0===(t.f&g)){if(t.f^=g,null!==t.transitions)for(const s of t.transitions)(s.is_global||n)&&i.push(s);for(var s=t.first;null!==s;){var e=s.next;kt(s,i,65536&s.f||32&s.f?n:0),s=e}}}let Tt=0;function St(t){Tt=t}let Pt=0;function Et(t){Pt=t}let At=null,Ot=0;function Rt(t){At=t}let Ft=null;function Dt(t){Ft=t}let It=null,jt=null,Bt=0,qt=null,$t=1,Lt=0,zt=Lt;function Nt(t){zt=t}let Ht=0;function Zt(){return++$t}function Gt(t){var i=t.f;if(0!==(i&p))return 1;if(0!==(i&w)){var n=t.deps,s=0!==(i&v);if(null!==n){var e,r,o=!!(512&i),h=s&&null!==Ft&&!Ht,l=n.length;if((o||h)&&(null===Ft||0===(Ft.f&y))){var a=t,u=a.parent;for(e=0;l>e;e++)r=n[e],!o&&r?.reactions?.includes(a)||(r.reactions??=[]).push(a);o&&(a.f^=512),h&&null!==u&&0===(u.f&v)&&(a.f^=v)}for(e=0;l>e;e++)if(Gt(r=n[e])&&z(r),r.wv>t.wv)return 1}s&&(null===Ft||Ht)||ii(t,d)}return 0}function Ut(t,i,n=1){var s=t.reactions;if(null!==s&&!It?.includes(t))for(var e=0;e<s.length;e++){var r=s[e];2&r.f?Ut(r,i,0):i===r&&(n?ii(r,p):0!==(r.f&d)&&ii(r,w),it(r))}}function Kt(t){var i=jt,n=Bt,s=qt,e=At,r=Ht,o=It,h=E,l=Ot,a=zt,u=t.f;jt=null,Bt=0,qt=null,Ht=0!==(u&v)&&(Ot||!Tt||null===At),At=96&u?null:t,It=null,A(t.ctx),Ot=0,zt=++Lt,null!==t.ac&&(pt(()=>{t.ac.abort(_)}),t.ac=null);try{t.f|=b;var c=(0,t.fn)(),f=t.deps;if(null!==jt){var d;if(Xt(t,Bt),null!==f&&Bt>0)for(f.length=Bt+jt.length,d=0;d<jt.length;d++)f[Bt+d]=jt[d];else t.deps=f=jt;if(!Ht||2&u&&null!==t.reactions)for(d=Bt;d<f.length;d++)(f[d].reactions??=[]).push(t)}else null!==f&&Bt<f.length&&(Xt(t,Bt),f.length=Bt);if(F()&&null!==qt&&!Ot&&null!==f&&!(6146&t.f))for(d=0;d<qt.length;d++)Ut(qt[d],t);return null!==e&&e!==t&&(Lt++,null!==qt&&(null===s?s=qt:s.push(...qt))),0!==(t.f&x)&&(t.f^=x),c}catch(p){return function(t){var i=Ft;if(null===i)return At.f|=x,t;if(0===(i.f&m)){if(!(128&i.f))throw!i.parent&&t instanceof Error&&j(t),t;i.b.error(t)}else I(t,i)}(p)}finally{t.f^=b,jt=i,Bt=n,qt=s,At=e,Ht=r,It=o,A(h),Ot=l,zt=a}}function Wt(t,i){let s=i.reactions;if(null!==s){var e=n.call(s,t);if(-1!==e){var r=s.length-1;0===r?s=i.reactions=null:(s[e]=s[r],s.pop())}}null===s&&2&i.f&&(null===jt||!jt.includes(i))&&(ii(i,w),768&i.f||(i.f^=512),$(i),Xt(i,0))}function Xt(t,i){var n=t.deps;if(null!==n)for(var s=i;s<n.length;s++)Wt(t,n[s])}function Yt(t){var i=t.f;if(0===(i&y)){ii(t,d);var n=Ft,s=Tt;Ft=t,Tt=1;try{16&i?function(t){for(var i=t.first;null!==i;){var n=i.next;!(32&i.f)&&Ct(i),i=n}}(t):xt(t),bt(t);var e=Kt(t);t.teardown="function"==typeof e?e:null,t.wv=$t}finally{Tt=s,Ft=n}}}function Vt(t){var i=!!(2&t.f);if(null===At||Ot){if(i&&null===t.deps&&null===t.effects){var n=t,s=n.parent;null!==s&&0===(s.f&v)&&(n.f^=v)}}else if((null===Ft||0===(Ft.f&y))&&!It?.includes(t)){var e=At.deps;if(0!==(At.f&b))t.rv<Lt&&(t.rv=Lt,null===jt&&null!==e&&e[Bt]===t?Bt++:null===jt?jt=[t]:Ht&&jt.includes(t)||jt.push(t));else{(At.deps??=[]).push(t);var r=t.reactions;null===r?t.reactions=[At]:r.includes(At)||r.push(At)}}if(Pt){if(nt.has(t))return nt.get(t);if(i){var o=(n=t).v;return(0===(n.f&d)&&null!==n.reactions||Jt(n))&&(o=L(n)),nt.set(n,o),o}}else if(i){if(n=t,Z?.has(n))return Z.get(n);Gt(n)&&z(n)}if(0!==(t.f&x))throw t.v;return t.v}function Jt(t){if(t.v===k)return 1;if(null===t.deps)return 0;for(const i of t.deps){if(nt.has(i))return 1;if(2&i.f&&Jt(i))return 1}return 0}function Qt(t){var i=Ot;try{return Ot=1,t()}finally{Ot=i}}const ti=-7169;function ii(t,i){t.f=t.f&ti|i}function ni(t,i=new Set){if(!("object"!=typeof t||null===t||t instanceof EventTarget||i.has(t))){i.add(t),t instanceof Date&&t.getTime();for(let e in t)try{ni(t[e],i)}catch(n){}const s=a(t);if(s!==Object.prototype&&s!==Array.prototype&&s!==Map.prototype&&s!==Set.prototype&&s!==Date.prototype){const i=o(s);for(let s in i){const e=i[s].get;if(e)try{e.call(t)}catch(n){}}}}}const si=["touchstart","touchmove"];function ei(t){return si.includes(t)}const ri=new Set,oi=new Set;let hi=null;function li(t){var n=this,s=n.ownerDocument,r=t.type,o=t.composedPath?.()||[],h=o[0]||t.target;hi=t;var l=0,a=hi===t&&t.t;if(a){var u=o.indexOf(a);if(-1!==u&&(n===document||n===window))return void(t.t=n);var c=o.indexOf(n);if(-1===c)return;u>c||(l=u)}if((h=o[l]||t.target)!==n){e(t,"currentTarget",{configurable:1,get:()=>h||s});var f=At,v=Ft;Rt(null),Dt(null);try{for(var d,p=[];null!==h;){var w=h.assignedSlot||h.parentNode||h.host||null;try{var g=h["__"+r];if(null!=g&&(!h.disabled||t.target===h))if(i(g)){var[y,...m]=g;y.call(h,t,...m)}else g.call(h,t)}catch(M){d?p.push(M):d=M}if(t.cancelBubble||w===n||null===w)break;h=w}if(d){for(let t of p)queueMicrotask(()=>{throw t});throw d}}finally{t.t=n,delete t.currentTarget,Rt(f),Dt(v)}}}const ai=new Map;let ui=new WeakMap;function ci(t,i){return t===i||t?.[C]===i}function fi(t,i){if(t.l.s)for(const n of t.l.s)Vt(n);i()}"undefined"!=typeof window&&((window.__svelte??={}).v??=new Set).add("5"),P=1;class vi{prevFrequency;prevTime;alpha=.025;constructor(t){this.prevFrequency=t,this.prevTime=performance.now()}get(){return this.prevFrequency}getPrevTime(){return this.prevTime}update(){const t=performance.now(),i=1e3/(t-this.prevTime||1);this.prevFrequency=this.prevFrequency*(1-this.alpha)+this.alpha*i,this.prevTime=t}}var di,pi="undefined"!=typeof Float32Array?Float32Array:Array,wi=Math.random;function gi(){var t=new pi(3);return pi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function yi(t){var i=t[0],n=t[1],s=t[2];return Math.sqrt(i*i+n*n+s*s)}function mi(t,i,n){var s=new pi(3);return s[0]=t,s[1]=i,s[2]=n,s}function Mi(t,i){return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function bi(t,i,n){return t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function xi(t,i,n){return t[0]=i[0]-n[0],t[1]=i[1]-n[1],t[2]=i[2]-n[2],t}function Ci(t,i,n){return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t}function _i(t,i,n,s){return t[0]=i[0]+n[0]*s,t[1]=i[1]+n[1]*s,t[2]=i[2]+n[2]*s,t}function ki(t,i){var n=i[0],s=i[1],e=i[2],r=n*n+s*s+e*e;return r>0&&(r=1/Math.sqrt(r)),t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t}function Ti(t,i){i=void 0===i?1:i;var n=2*wi()*Math.PI,s=2*wi()-1,e=Math.sqrt(1-s*s)*i;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t[2]=s*i,t}function Si(t,i){var n=new pi(2);return n[0]=t,n[1]=i,n}gi(),di=new pi(2),pi!=Float32Array&&(di[0]=0,di[1]=0);class Pi{canvas;positionOnCanvas;isPressed=0;isMouseOver=1;constructor(t){this.canvas=t,this.canvas.tabIndex=0,this.setupListeners(t)}isMousePressed(){return this.isPressed&&this.isMouseOver}isMouseFocused(){return this.isMouseOver}getPositionOnCanvas(){if(this.isMouseFocused()&&this.positionOnCanvas)return this.positionOnCanvas}setupListeners(t){t.addEventListener("focus",()=>{this.isMouseOver=1}),t.addEventListener("mouseenter",()=>{this.isMouseOver=1}),t.addEventListener("mouseover",()=>{this.isMouseOver=1}),t.addEventListener("mouseleave",()=>{this.isMouseOver=0,this.isPressed=0,this.positionOnCanvas=void 0}),t.addEventListener("mousemove",t=>{this.isMouseOver=1;const i=Si(t.clientX,t.clientY);this.positionOnCanvas=i}),t.addEventListener("mousedown",()=>{this.isPressed=1}),t.addEventListener("mouseup",()=>{this.isPressed=0})}}function Ei(t,i){const n=i[0]-t[0],s=i[1]-t[1],e=Math.max(Math.abs(n),Math.abs(s));return[n/e,s/e]}const Ai="none",Oi="failed",Ri="drawing",Fi="closed";class Di{canvas;CLOSING_RADIUS=10;polygonOnCanvas;i;o;constructor(t){this.canvas=t,this.canvas.tabIndex=0,this.polygonOnCanvas=[],this.i="none",this.o=0,this.setupListeners(t)}getState(){return this.i}updateState(t){switch(this.o++,this.i=t,t){case Ai:{const t=function(t,i=10){const n=t.length;if(3>n)return;const s=[];let e=[-1/0,-1/0];for(let r=0;n>r;r++){const o=r===n-1?0:r+1,h=t[r],l=t[o];if(1.414*i>=Math.abs(h[0]-l[0])+Math.abs(h[1]-l[1]))continue;const a=Ei(h,l);e[0]===a[0]&&e[1]===a[1]||(e=a,s.push(h))}return 3>s.length?void 0:s}(this.polygonOnCanvas);if(t)return void(this.polygonOnCanvas=t);this.i="failed";break}}}getStateInfo(){return{state:this.i,eTag:this.o}}getPolygonOnCanvas(){return this.polygonOnCanvas}setupListeners(t){let i=0;t.addEventListener("click",t=>{if(!i){i=1;try{const i=Si(t.clientX,t.clientY),n=this.getState();switch(n){case Ai:case Oi:case Fi:this.polygonOnCanvas=[i],this.updateState("drawing");break;case Ri:{const t=this.polygonOnCanvas[0];if(Math.abs(i[0]-t[0])+Math.abs(i[1]-t[1])<=this.CLOSING_RADIUS){this.updateState("closed");break}this.polygonOnCanvas.push(i);break}default:throw Error("Unexpected polygon state: "+n)}}finally{i=0}}}),t.addEventListener("dblclick",()=>{const t=this.getState();switch(t){case Ai:break;case Oi:case Fi:this.polygonOnCanvas=[],this.updateState("none");break;case Ri:this.updateState("closed");break;default:throw Error("Unexpected polygon state: "+t)}})}}class Ii{start;end;width;height;constructor(t,i,n,s){this.start={x:t,y:i},this.end={x:t+n,y:i+s},this.width=n,this.height=s}equals(t){return this.start.x===t.start.x&&this.start.y===t.start.y&&this.width===t.width&&this.height===t.height}}class ji{canvasBox;paddingRatio;maxDepth;halfDepth;polygon;centroids;constructor(t,i,n=.15){this.canvasBox=t,this.paddingRatio=n,this.maxDepth=i,this.halfDepth=i/2,this.polygon=this.defaultPolygon(),this.centroids=[]}defaultPolygon(){const t=Math.min(this.canvasBox.width*this.paddingRatio,this.canvasBox.height*this.paddingRatio);return[mi(this.canvasBox.start.x+t,this.canvasBox.start.y+t,this.halfDepth),mi(this.canvasBox.end.x-t,this.canvasBox.start.y+t,this.halfDepth),mi(this.canvasBox.end.x-t,this.canvasBox.end.y-t,this.halfDepth),mi(this.canvasBox.start.x+t,this.canvasBox.end.y-t,this.halfDepth)]}getPolygon(){return this.polygon}setPolygon(t){this.polygon=t.map(t=>mi(t[0]+this.canvasBox.start.x,t[1]+this.canvasBox.start.y,this.halfDepth))}resetPolygon(){this.polygon=this.defaultPolygon()}getCentroids(){return this.centroids}addCentroid(t){const i=mi(t[0]+this.canvasBox.start.x,t[1]+this.canvasBox.start.y,this.halfDepth);this.centroids.push(i)}clearCentroids(){this.centroids.length=0}isOutside(t){const i=t[2];return i>this.maxDepth||0>i||!function(t,i){if(3>i.length)return 0;let n=0;const s=t[0],e=t[1];for(let r=0,o=i.length-1;r<i.length;o=r++){const t=i[r][0],h=i[r][1],l=i[o][0],a=i[o][1],u=a-h;if(0!==u){if(e>=h==a>e&&e!==a){const i=(l-t)*(e-h)/u+t;if(s===i)return 0;i>s&&(n=!n)}}else if(s>=t==l>s&&h===e)return 0}return n}(t,this.polygon)}resize(t){if(this.canvasBox.equals(t))return;const i=t.width===this.canvasBox.width?1:t.width/this.canvasBox.width,n=t.height===this.canvasBox.height?1:t.height/this.canvasBox.height;for(const s of this.polygon)s[0]=(s[0]-this.canvasBox.start.x)*i+t.start.x,s[1]=(s[1]-this.canvasBox.start.y)*n+t.start.y;for(const s of this.centroids)s[0]=(s[0]-this.canvasBox.start.x)*i+t.start.x,s[1]=(s[1]-this.canvasBox.start.y)*n+t.start.y;this.canvasBox=t}}const Bi={clearCanvasIfResized:1,boids:{lineWidth:.1,sizeScreenHeightRatio:.003},flightZone:{polygonColor:"#888888"},debug:{flightZone:{polygonColor:"#888888",centroidsColor:"#0000ff"},centerOwMassColor:"#ffff00",maxHeightColor:"#ff0000"}};class qi{window;canvas;renderingContext;config;screenBox;canvasBox;maxHeight;devicePixelRatio;screenHasTopLeft=0;patternCache={};constructor(t,i,n={}){this.window=t,this.canvas=i;const s=i.getContext("2d");if(!s)throw Error("Canvas context not available");this.renderingContext=s,this.config={...Bi,...n},this.screenBox=this.getScreenBox(),this.canvasBox=this.getCanvasBox(),this.devicePixelRatio=this.window.devicePixelRatio||1,this.maxHeight=this.getMaxHeight(),this.scaleCanvas()}getMaxHeight(){return this.screenHasTopLeft?this.screenBox.end.y-20:Math.max(this.canvasBox.end.y,this.screenBox.end.y)-20}checkResize(){this.screenBox=this.getScreenBox();const t=this.window.devicePixelRatio||1,i=this.getCanvasBox();return this.canvasBox.equals(i)&&this.devicePixelRatio===t?0:(this.config.clearCanvasIfResized&&this.clearCanvas(),this.devicePixelRatio=t,this.canvasBox=i,this.maxHeight=this.getMaxHeight(),this.scaleCanvas(),1)}getScreenBox(){let t=0,i=0;return"left"in this.window.screen&&"top"in this.window.screen&&"number"==typeof this.window.screen.left&&"number"==typeof this.window.screen.top?(this.screenHasTopLeft=1,t=this.window.screen.left,i=this.window.screen.top):this.screenHasTopLeft=0,new Ii(t,i,this.window.screen.width,this.window.screen.height)}getCanvasBox(){const t=this.canvas.getBoundingClientRect();return new Ii(this.window.screenX+(this.window.outerWidth-this.window.innerWidth)+t.left,this.window.screenY+(this.window.outerHeight-this.window.innerHeight)+t.top,t.width,t.height)}scaleCanvas(){const t=this.renderingContext,i=this.canvas.clientWidth,n=this.canvas.clientHeight;this.canvas.width=i*this.devicePixelRatio,this.canvas.height=n*this.devicePixelRatio,t.scale(this.devicePixelRatio,this.devicePixelRatio)}clearCanvas(){const t=this.renderingContext;t.canvas.width=t.canvas.width,t.scale(this.devicePixelRatio,this.devicePixelRatio)}drawStats(t,i,n){const s=this.renderingContext;s.save(),s.font="10px monospace",s.fillStyle="#888888",s.fillText("Boids: "+t,16,24),s.fillText(`TPS:   ${Math.round(i)} ~ ${n}`,16,40),s.restore()}drawHeight(t){const i=this.renderingContext;i.save();const n=t-this.canvasBox.start.y;i.strokeStyle=this.config.debug.maxHeightColor,i.lineWidth=1,i.beginPath(),i.moveTo(0,n),i.lineTo(this.canvasBox.width,n),i.stroke(),i.restore()}drawCenterOwMass(t){const i=this.renderingContext;i.save();const n=t[0]-this.canvasBox.start.x,s=t[1]-this.canvasBox.start.y;i.lineWidth=1,i.strokeStyle=this.config.debug.centerOwMassColor,i.setLineDash([]),i.beginPath(),i.moveTo(n-5,s-5),i.lineTo(n+5,s+5),i.moveTo(n+5,s-5),i.lineTo(n-5,s+5),i.stroke(),i.restore()}drawFlightZone(t,i,n){if(!n)return;const s=this.canvasBox.start.x,e=this.canvasBox.start.y,r=t.getPolygon(),o=t.getCentroids(),h=(n?this.config.debug.flightZone.polygonColor:this.config.flightZone.polygonColor)+"0d",l=this.renderingContext;l.save(),l.fillStyle=h,l.beginPath(),l.moveTo(r[0][0]-s,r[0][1]-e);for(let a=1;a<r.length;a++)l.lineTo(r[a][0]-s,r[a][1]-e);l.closePath(),l.fill("evenodd"),l.restore(),l.save(),l.strokeStyle=this.config.debug.flightZone.centroidsColor;for(const a of o){const t=a[0]-s,n=a[1]-e,r=10;l.setLineDash([]),l.beginPath(),l.moveTo(t-r,n),l.lineTo(t+r,n),l.moveTo(t,n-r),l.lineTo(t,n+r),l.stroke(),l.setLineDash([4,6]),l.beginPath(),l.arc(t,n,i,0,2*Math.PI),l.stroke()}l.restore()}drawDraftPolygon(t,i,n,s,e=1){const r=this.renderingContext;r.save();const o=n||"#888888";if(null!=s){const t=s/500*e%2;r.globalAlpha=t>1?2-t:t}r.lineWidth=1,r.strokeStyle=o;let h=t[0][0]-0,l=t[0][1]-0;r.beginPath(),r.arc(h,l,10,0,2*Math.PI),r.stroke(),r.beginPath(),r.moveTo(h-5,l),r.lineTo(h+5,l),r.moveTo(h,l-5),r.lineTo(h,l+5),r.stroke();let a=this.patternCache.DraftPolygonFillStyle;a||(a=function(t,i=8){const n=document.createElement("canvas");n.width=n.height=i;const s=n.getContext("2d");if(!s)throw Error("Canvas context not available");s.strokeStyle=t,s.lineWidth=1,s.beginPath(),s.moveTo(i,0),s.lineTo(0,i),s.stroke();const e=s.createPattern(n,"repeat");if(!e)throw Error("Failed to create pattern");return e}(o+"33",8),this.patternCache.DraftPolygonFillStyle=a),r.fillStyle=a,r.setLineDash([4,4]),r.beginPath(),r.moveTo(h,l);for(let u=1;u<t.length;u++)h=t[u][0]-0,l=t[u][1]-0,r.lineTo(h,l);i&&(r.closePath(),r.fill("evenodd")),r.stroke(),r.setLineDash([]),r.beginPath(),r.moveTo(h,l);for(let u=0;u<t.length;u++)h=t[u][0]-0,l=t[u][1]-0,r.moveTo(h-5,l),r.lineTo(h+5,l),r.moveTo(h,l-5),r.lineTo(h,l+5);r.stroke(),r.restore()}drawBoid(t,i){const n=t.getPosition(),s=t.getVelocity(),e=this.canvasBox.start.x,r=this.canvasBox.start.y,o=1.2-Math.max(.2,Math.min(1.2,n[2]/i)),h=this.config.boids.sizeScreenHeightRatio*this.screenBox.height+2*o-1,l=this.renderingContext;l.save(),l.lineWidth=this.config.boids.lineWidth,l.strokeStyle=`hsl(10, 10%, ${80*o+20}%)`,l.beginPath(),l.translate(n[0]-e,n[1]-r),l.rotate(Math.atan2(s[1],s[0])),l.scale(h,h),l.moveTo(-.5,.3),l.lineTo(1,0),l.lineTo(-.5,-.3),l.moveTo(-.5,.3),l.lineTo(-.5,-.3),l.stroke(),l.restore()}}function $i(t,i){if(i>=t.length)return t.slice();const n=[];for(let s=0;i>s;s++)n[s]=t[s];for(let s=i;s<t.length;s++){const e=Math.floor(Math.random()*(s+1));i>e&&(n[e]=t[s])}return n}class Li{cellSize;cellRadius;centerOwMass=mi(500,500,100);centerOwMassAlpha;grid=new Map;itemCellKeys=new Map;constructor(t,i){this.cellSize=mi(t.x,t.y,0),this.cellRadius=Math.ceil(Math.sqrt((t.x*t.x+t.y*t.y)/2)),this.centerOwMassAlpha=2/(i+1)}setMaxItemCount(t){this.centerOwMassAlpha=2/(t+1)}getCellKey(t){return`${Math.floor(t[0]/this.cellSize[0])},${Math.floor(t[1]/this.cellSize[1])}`}remove(t){const i=this.itemCellKeys.get(t);i&&(this.removeFromGrid(t,i),this.itemCellKeys.delete(t))}update(t){const i=t.getPosition(),n=this.getCellKey(i),s=this.itemCellKeys.get(t);if(s===n)return;s&&this.removeFromGrid(t,s);const e=this.grid.get(n);e?e.push(t):this.grid.set(n,[t]),this.itemCellKeys.set(t,n),Ci(this.centerOwMass,this.centerOwMass,1-this.centerOwMassAlpha);const r=_i(gi(),i,t.getVelocity(),2);_i(this.centerOwMass,this.centerOwMass,r,this.centerOwMassAlpha)}clear(){this.grid.clear(),this.itemCellKeys.clear()}getRandomCellCoords(){const t=Array.from(this.grid.keys());if(0===t.length)return;const i=Math.floor(Math.random()*t.length),[n,s]=t[i].split(",").map(Number);return{startX:n*this.cellSize[0],startY:s*this.cellSize[1],width:this.cellSize[0],height:this.cellSize[1]}}getNeighbors(t,i){const n=this.getCellKey(t.getPosition()),s=[];let e=i.limitCount||100,r=Math.max(0,i.min);if(0==r){const i=this.grid.get(n);if(i)for(const n of i)if(n!==t&&(s.push(n),e--,0>=e))return s;r++}const[o,h]=n.split(",").map(Number);for(let l=r;l<=i.max;l++){const t=[];for(const{dx:i,dy:n}of this.diamondSpiralIterator(l)){const s=this.grid.get(`${o+i},${h+n}`);s&&t.push(...s)}if(t.length>=e)return s.push(...$i(t,e)),s;s.push(...t),e-=t.length}return s}removeFromGrid(t,i){const n=this.grid.get(i);if(!n)return;const s=n.indexOf(t);-1!==s&&(1!=n.length?(n[s]=n[n.length-1],n.pop()):this.grid.delete(i))}*diamondSpiralIterator(t){let i=t,n=0;if(yield{dx:i,dy:n},0!==t){for(;i>0;)i--,n++,yield{dx:i,dy:n};for(;i>-t;)i--,n--,yield{dx:i,dy:n};for(;0>i;)i++,n--,yield{dx:i,dy:n};for(;t>i;)i++,n++,yield{dx:i,dy:n}}}}const zi={minSpeed:1,maxSpeed:4,maxTurnAngleDeg:140,acceleration:{backToFlightZone:1.2,stayCloseToCenterOwfMass:.1,followCentroids:-2,pullUpTerrain:1.8,cohesion:.4,alignment:1,separation:1.8}};class Ni{displayId;position;velocity;acceleration;config;lastPositionInside;isOutside=0;backToFlightZone;followCentroids;constructor(t,i,n={}){this.displayId=t,this.config={...n,...zi};const s=2*Math.random()*Math.PI;this.position=i,this.velocity=mi(.5*Math.cos(s),.5*Math.sin(s),Math.random()-.5),Ci(this.velocity,this.velocity,this.config.maxSpeed),this.acceleration=gi()}getPosition(){return this.position}getVelocity(){return this.velocity}getConfig(){return this.config}update(t,i,n,s,e,r,o,h,l,a){let u=this.config.maxTurnAngleDeg,c=this.config.maxSpeed;const f=gi();this.position[1]<r||(f[1]=-this.config.acceleration.pullUpTerrain,u+=20,c+=1);const v=e.getPolygon();if(!this.backToFlightZone){const t=this.isOutside;if(this.isOutside=e.isOutside(this.position),this.isOutside){const i=gi();if(t)this.lastPositionInside&&e.isOutside(this.lastPositionInside)&&(this.lastPositionInside=void 0),xi(i,this.lastPositionInside??v[Math.floor(l*v.length)],this.position);else{const t=function(t,i){let n=1/0,s=gi();const e=t.length;if(0===e)throw Error("Polygon must have at least one vertex");for(let r=0;e>r;r++){const o=t[r],h=t[r!==e-1?r+1:0],l=[h[0]-o[0],h[1]-o[1]],a=[-l[1],l[0]],u=l[0]*a[1]-l[1]*a[0];if(1e-6>u)continue;const c=i[0]-o[0],f=i[1]-o[1],v=(c*a[1]-f*a[0])/u,d=mi(o[0]+v*l[0]-i[0],o[1]+v*l[1]-i[1],0),p=Math.abs(d[0])+Math.abs(d[1]);n>p&&(n=p,s=d)}return s}(v,this.position);Mi(i,t)}ki(i,i),this.backToFlightZone={direction:i,remainingTicks:10}}else this.lastPositionInside=(d=this.position,(p=new pi(3))[0]=d[0],p[1]=d[1],p[2]=d[2],p)}var d,p;this.backToFlightZone&&(_i(f,f,this.backToFlightZone.direction,this.config.acceleration.backToFlightZone),this.backToFlightZone.remainingTicks--,this.backToFlightZone.remainingTicks>0||(this.backToFlightZone=void 0));const w=e.getCentroids();if(!this.followCentroids&&w.length>0){const t=gi();for(const i of w){const n=xi(gi(),i,this.position);n[2]=0;const s=Math.abs(n[0])+Math.abs(n[1]);o>s&&(Ci(n,n,(o-s)/s),bi(t,t,n))}ki(t,t),this.followCentroids={direction:t,remainingTicks:5}}this.followCentroids&&(_i(f,f,this.followCentroids.direction,this.config.acceleration.followCentroids),this.followCentroids.remainingTicks--,this.followCentroids.remainingTicks>0||(this.followCentroids=void 0));const g=xi(gi(),s,this.position);ki(g,g),_i(f,f,g,this.config.acceleration.stayCloseToCenterOwfMass),bi(f,f,this.cohesionAcceleration(t)),bi(f,f,this.alignmentAcceleration(t,h)),bi(f,f,this.separationAcceleration(i,n,h)),function(t,i,n,s){const e=ki(gi(),i),r=ki(gi(),n),o=s*Math.PI/180,h=(a=r,u=(l=e)[0],c=l[1],f=l[2],v=a[0],d=a[1],p=a[2],g=(w=Math.sqrt((u*u+c*c+f*f)*(v*v+d*d+p*p)))&&function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]}(l,a)/w,Math.acos(Math.min(Math.max(g,-1),1)));var l,a,u,c,f,v,d,p,w,g;h>o?(function(t,i,n,s){var e=i[0],r=i[1],o=i[2];t[0]=e+s*(n[0]-e),t[1]=r+s*(n[1]-r),t[2]=o+s*(n[2]-o)}(t,e,r,(o+20)/h),ki(t,t),Ci(t,t,yi(n))):Mi(t,n)}(this.acceleration,this.velocity,f,u),this.isOutside||bi(this.acceleration,this.acceleration,a);const y=gi();bi(y,this.velocity,this.acceleration);const m=yi(y);.1>m||(this.velocity=y,m>c?Ci(this.velocity,this.velocity,c/m):m<this.config.minSpeed&&Ci(this.velocity,this.velocity,this.config.minSpeed/m)),this.position=bi(this.position,this.position,this.velocity)}alignmentAcceleration(t,i){const n=gi();for(const s of t)i<Math.abs(s.getPosition()[2]-this.position[2])||bi(n,n,s.getVelocity());return ki(n,n),Ci(n,n,this.config.acceleration.alignment),n}cohesionAcceleration(t){const i=gi();for(const n of t)bi(i,i,xi(gi(),n.getPosition(),this.position));return ki(i,i),Ci(i,i,this.config.acceleration.cohesion),i}separationAcceleration(t,i,n){const s=Math.max(i,n),e=gi();for(const r of t){const t=xi(gi(),this.position,r.getPosition());if(Math.abs(t[2])>n)continue;let i=yi(t);i>1e-6||(i=10,Ti(t,i)),_i(e,e,t,s/i-1)}return ki(e,e),Ci(e,e,this.config.acceleration.separation),e}}const Hi={gravity:.05,maxDepth:250,visibleDistance:100,visibleDepth:30,grid:{cellSize:{x:10,y:10},neighborDistance:{min:1,max:6,limitCount:30},closeNeighborDistance:{min:0,max:0,limitCount:10}}};class Zi{simBox;config;maxBoidCount=0;boidConfig={};boids=[];spatialGrid;randomSeed={value:1,remainingTicks:0};isRunning=0;nextDisplayId=0;constructor(t,i={}){this.simBox=t,this.config={...Hi,...i},this.spatialGrid=new Li(this.config.grid.cellSize,this.maxBoidCount)}refreshRandomSeed(){this.randomSeed.remainingTicks--,this.randomSeed.remainingTicks>0||(this.randomSeed.value=Math.random(),this.randomSeed.remainingTicks=Math.floor(121*Math.random()))}getConfig(){return this.config}getCenterOwMass(){return this.spatialGrid.centerOwMass}resize(t,i){this.simBox=t,i&&(this.config.maxDepth=i)}start(t,i){t>this.maxBoidCount&&(this.maxBoidCount=t),this.boidConfig=i;for(let n=0;t>n;n++)this.spawnBoid(Math.random()*this.config.maxDepth);this.isRunning=1}boidCount(){return this.boids.length}addBoidsIfMissing(t){const i=this.maxBoidCount-this.boids.length;if(i>0){for(let n=0;Math.min(t,i)>n;n++)this.spawnBoid(this.config.maxDepth,1);return 1}return 0}removeBoids(t){if(this.boids.length<=t)return this.boids=[],void this.spatialGrid.clear();for(let i=0;t>i;i++){const t=this.boids.pop();t&&this.spatialGrid.remove(t)}}update(t,i){if(!this.isRunning)return;this.spatialGrid.setMaxItemCount(this.maxBoidCount),this.refreshRandomSeed();const n=.5>this.randomSeed.value?0:1,s=.25>this.randomSeed.value%.5?-1:1,e=gi();e[n]=s*this.config.gravity;for(const r of this.boids){const n=this.spatialGrid.getNeighbors(r,this.config.grid.neighborDistance),s=this.spatialGrid.getNeighbors(r,this.config.grid.closeNeighborDistance);r.update(n,s,this.spatialGrid.cellRadius,this.spatialGrid.centerOwMass,t,i,this.config.visibleDistance,this.config.visibleDepth,this.randomSeed.value,e),this.spatialGrid.update(r)}}spawnBoid(t,i){let n;i&&(n=this.spatialGrid.getRandomCellCoords());const{startX:s,startY:e,width:r,height:o}=n||{startX:this.simBox.start.x-100,startY:this.simBox.start.y-20,width:this.simBox.width+100,height:this.simBox.height},h=mi(s+r*(1.2*Math.random()-.1),e+o*(1.2*Math.random()-.1),t),l=new Ni(this.nextDisplayId,h,this.boidConfig);this.nextDisplayId++,this.boids.push(l),this.spatialGrid.update(l)}stop(){this.isRunning=0,this.boids=[],this.maxBoidCount=0}}class Gi{renderer;flightZone;simulation;inputs;TARGET_TPS=30;TARGET_TICK_TIME;tpsEstimator;debug=0;isRunning=0;simulationLoopId=void 0;renderingLoopId=void 0;renderingTasks=new Map;constructor(t,i,n={}){this.renderer=new qi(t,i,n),this.simulation=new Zi(this.renderer.screenBox),this.flightZone=new ji(this.renderer.canvasBox,this.simulation.getConfig().maxDepth),this.inputs={mouseStatus:new Pi(i),polygonDrawer:new Di(i)},this.TARGET_TICK_TIME=1e3/this.TARGET_TPS,this.tpsEstimator=new vi(this.TARGET_TPS)}start(t,i,n={}){this.debug=i,this.simulation.boidConfig=n,this.simulation.maxBoidCount=t,this.isRunning?this.simulation.boidConfig=n:(this.isRunning=1,this.simulation.start(Math.floor(.7*t),n),this.simulationLoop(),this.renderingLoop())}async simulationLoop(){if(!this.isRunning)return;const t=this.tpsEstimator.getPrevTime(),i=this.tpsEstimator.get()-this.TARGET_TPS;if(i>0){this.simulation.addBoidsIfMissing(100);const i=this.TARGET_TICK_TIME-(performance.now()-t);i>0&&await new Promise(t=>setTimeout(t,i))}else i>-8||this.simulation.removeBoids(5);const n=this.renderer.maxHeight;this.simulation.update(this.flightZone,n),this.tpsEstimator.update(),this.simulationLoopId=requestAnimationFrame(this.simulationLoop.bind(this))}async renderingLoop(){if(!this.isRunning)return;const t=this.renderer.checkResize();this.flightZone.resize(this.renderer.canvasBox),t&&this.simulation.resize(this.renderer.screenBox),this.flightZone.clearCentroids();const i=this.inputs.mouseStatus.getPositionOnCanvas();i&&this.flightZone.addCentroid(i);const n=this.tpsEstimator.get(),s=this.renderer.maxHeight;this.renderer.clearCanvas(),this.renderer.drawFlightZone(this.flightZone,this.simulation.getConfig().visibleDistance,this.debug),this.simulation.boids.forEach(t=>{this.renderer.drawBoid(t,this.simulation.getConfig().maxDepth)}),this.debug&&(this.renderer.drawHeight(s),this.renderer.drawCenterOwMass(this.simulation.getCenterOwMass()),this.renderer.drawStats(this.simulation.boidCount(),n,this.TARGET_TPS)),this.refreshRenderingTasks(),this.renderingLoopId=requestAnimationFrame(this.renderingLoop.bind(this))}refreshRenderingTasks(){const{state:t,eTag:i}=this.inputs.polygonDrawer.getStateInfo(),n=this.renderingTasks.get("draftPolygon")?.eTag;if(i!==n){const n=this.inputs.polygonDrawer.getPolygonOnCanvas();let s;switch(t){case Ai:this.renderingTasks.set("draftPolygon",{eTag:i}),this.flightZone.resetPolygon();break;case Ri:this.renderingTasks.set("draftPolygon",{eTag:i,render:()=>this.renderer.drawDraftPolygon(n,0)});break;case Oi:s=performance.now()+1510,this.renderingTasks.set("draftPolygon",{eTag:i,endTime:s,render:()=>this.renderer.drawDraftPolygon(n,0,"#ff0000",s-performance.now(),3)});break;case Fi:s=performance.now()+3010,this.renderingTasks.set("draftPolygon",{eTag:i,endTime:s,render:()=>this.renderer.drawDraftPolygon(n,1,void 0,s-performance.now()),endCallback:()=>{this.flightZone.setPolygon(n)}})}}this.renderingTasks.forEach((t,i)=>{if(t.render)return t.endTime&&performance.now()>=t.endTime?(t.endCallback?.(),void this.renderingTasks.set(i,{eTag:t.eTag})):void t.render()})}stop(){this.simulationLoopId&&(cancelAnimationFrame(this.simulationLoopId),this.simulationLoopId=void 0),this.renderingLoopId&&(cancelAnimationFrame(this.renderingLoopId),this.renderingLoopId=void 0),this.renderer.clearCanvas(),this.simulation.stop(),this.isRunning=0}}var Ui,Ki,Wi,Xi,Yi=(Wi=!(Ui='<main class="svelte-uxr442"><canvas class="svelte-uxr442"></canvas></main>').startsWith("<!>"),()=>{var t,i;void 0===Ki&&(t=Wi?Ui:"<!>"+Ui,(i=document.createElement("template")).innerHTML=t.replaceAll("<!>","\x3c!----\x3e"),Ki=vt(Ki=i.content));var n,s,e,r=ut?document.importNode(Ki,1):Ki.cloneNode(1);return n=r,s=r,null===(e=Ft).nodes_start&&(e.nodes_start=n,e.nodes_end=s),r});Xi=function(t,i){let n;O(i,0);let s=function(t,i=0,n=1){const s=st(null);return i||(s.equals=S),P&&n&&null!==E&&null!==E.l&&(E.l.s??=[]).push(s),s}(),e=0;var r,o,h;r=()=>{n=new URLSearchParams(window.location.search),n.has("debug")&&(e=1),Vt(s)&&new Gi(window,Vt(s)).start(5200,e,{})},null===E&&function(){throw Error("https://svelte.dev/e/lifecycle_outside_component")}(),P&&null!==E.l?(o=E,h=o.l,h.u??={a:[],b:[],m:[]}).m.push(r):yt(()=>{const t=Qt(r);if("function"==typeof t)return t}),function(t=0){const i=E,n=i.l.u;if(!n)return;let s=()=>function(t){if("object"==typeof t&&t&&!(t instanceof EventTarget))if(C in t)ni(t);else if(!Array.isArray(t))for(let i in t){const n=t[i];"object"==typeof n&&n&&C in n&&ni(n)}}(i.s);if(t){let t=0,n={};const h=(e=()=>{let s=0;const e=i.s;for(const t in e)e[t]!==n[t]&&(n[t]=e[t],s=1);return s&&t++,t},r=2050,o=null!==At&&2&At.f?At:null,null===Ft||null!==o&&0!==(o.f&v)?r|=v:Ft.f|=M,{ctx:E,deps:null,effects:null,equals:T,f:r,fn:e,reactions:null,rv:0,v:k,wv:0,parent:o??Ft,ac:null});s=()=>Vt(h)}var e,r,o;n.b.length&&(wt(),gt(1048584,()=>{fi(i,s),f(n.b)},1)),yt(()=>{const t=Qt(()=>n.m.map(c));return()=>{for(const i of t)"function"==typeof i&&i()}}),n.a.length&&yt(()=>{fi(i,s),f(n.a)})}();var l,a,u=Yi(),d=function(t){return vt(t)}(u);(function(t={},i,n){var s;s=()=>{var s,e;return function(t,i=0){gt(8|i,t,1)}(()=>{s=e,e=[],Qt(()=>{t!==n(...e)&&(i(t,...e),s&&ci(n(...s),t)&&i(null,...s))})}),()=>{var s;s=()=>{e&&ci(n(...e),t)&&i(null,...e)},0===B.length&&queueMicrotask(q),B.push(s)}},gt(4,s,0)})(d,t=>rt(s,t),()=>Vt(s)),a=u,null!==(l=t)&&l.before(a),R()},function(t,{target:i,anchor:n,props:e={},events:o,context:h,intro:l=1}){!function(){if(void 0===at){at=window,ut=/Firefox/.test(navigator.userAgent);var t=Element.prototype,i=Node.prototype,n=Text.prototype;ct=r(i,"firstChild").get,ft=r(i,"nextSibling").get,u(t)&&(t.h=void 0,t.M=void 0,t.C=null,t._=void 0,t.k=void 0),u(n)&&(n.T=void 0)}}();var a=new Set,c=t=>{for(var n=0;n<t.length;n++){var s=t[n];if(!a.has(s)){a.add(s);var e=ei(s);i.addEventListener(s,li,{passive:e});var r=ai.get(s);void 0===r?(document.addEventListener(s,li,{passive:e}),ai.set(s,1)):ai.set(s,r+1)}}};c(s(ri)),oi.add(c);var f=void 0,v=Mt(()=>{var s=n??i.appendChild(function(t=""){return document.createTextNode(t)}());return function(t,i=1){gt(32,t,1,i)}(()=>{h&&(O({}),E.c=h),o&&(e.$$events=o),f=t(s,e)||{},h&&R()}),()=>{for(var t of a){i.removeEventListener(t,li);var e=ai.get(t);0===--e?(document.removeEventListener(t,li),ai.delete(t)):ai.set(t,e)}oi.delete(c),s!==n&&s.parentNode?.removeChild(s)}});ui.set(f,v)}(Xi,{target:document.getElementById("app")})}}});
